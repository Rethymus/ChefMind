<template>
  <div class="analytics-view">
    <div class="container">
      <div class="analytics-header">
        <h1 class="page-title">
          <span class="title-icon">📊</span>
          营养分析与膳食指导
        </h1>
        <p class="page-subtitle">基于中国居民膳食指南的智能营养分析</p>
      </div>

      <div class="analytics-dashboard">
        <!-- 膳食指南概览 -->
        <div class="analytics-card guidelines-card">
          <h2 class="card-title">
            <span class="card-icon">📋</span>
            中国居民膳食指南核心推荐
          </h2>
          <div class="guidelines-grid">
            <div
              v-for="principle in dietaryGuidelines.principles.slice(0, 4)"
              :key="principle.id"
              class="guideline-item"
            >
              <div class="guideline-number">{{ principle.id }}</div>
              <div class="guideline-content">
                <h3 class="guideline-title">{{ principle.title }}</h3>
                <p class="guideline-desc">{{ principle.description }}</p>
              </div>
            </div>
          </div>
          <el-button type="primary" @click="showFullGuidelines = true" class="view-all-btn">
            查看完整指南
          </el-button>
        </div>

        <!-- 个人营养分析 -->
        <div class="analytics-card nutrition-card">
          <h2 class="card-title">
            <span class="card-icon">🎯</span>
            个人营养分析
          </h2>

          <!-- 数据输入提示 -->
          <div v-if="!hasUserData" class="no-data-prompt">
            <div class="prompt-content">
              <div class="prompt-icon">📝</div>
              <h3 class="prompt-title">开始您的个性化营养分析</h3>
              <p class="prompt-desc">
                请输入您的个人信息和今日饮食记录，AI将为您提供专业的营养分析和个性化建议
              </p>
              <el-button
                type="primary"
                size="large"
                @click="showUserForm = true"
                class="start-analysis-btn"
              >
                <el-icon><Edit /></el-icon>
                开始输入数据
              </el-button>
            </div>
          </div>

          <!-- 营养分析结果 - 四模块重构版本 -->
          <div v-else class="nutrition-analysis-modules">
            <div class="modules-container">
              
              <!-- 模块 1: 个人信息 -->
              <div class="analysis-module personal-info-module">
                <div class="module-header">
                  <div class="header-left">
                    <div class="module-icon">👤</div>
                    <h3 class="module-title">个人信息</h3>
                  </div>
                  <el-button
                    type="primary"
                    size="small"
                    @click="showUserForm = true"
                    class="edit-btn"
                  >
                    <el-icon><Edit /></el-icon>
                    修改
                  </el-button>
                </div>
                <div class="module-content">
                  <div class="info-grid">
                    <div class="info-item">
                      <div class="info-icon">🚻</div>
                      <div class="info-details">
                        <span class="info-label">性别年龄</span>
                        <span class="info-value">{{ userProfile?.gender === 'male' ? '男性' : '女性' }}，{{ userProfile?.age || 0 }}岁</span>
                      </div>
                    </div>
                    <div class="info-item">
                      <div class="info-icon">📏</div>
                      <div class="info-details">
                        <span class="info-label">身高体重</span>
                        <span class="info-value">{{ userProfile?.height || 0 }}cm / {{ userProfile?.weight || 0 }}kg</span>
                      </div>
                    </div>
                    <div class="info-item">
                      <div class="info-icon">⚖️</div>
                      <div class="info-details">
                        <span class="info-label">BMI指数</span>
                        <span class="info-value">
                          {{ calculateBMI().toFixed(1) }}
                          <span :class="['status-badge', getBMIStatus()]">{{ getBMIStatusText() }}</span>
                        </span>
                      </div>
                    </div>
                    <div class="info-item">
                      <div class="info-icon">🎯</div>
                      <div class="info-details">
                        <span class="info-label">健康目标</span>
                        <span class="info-value">{{ userProfile?.healthGoals?.join('、') || '未设置' }}</span>
                      </div>
                    </div>
                    <div class="info-item">
                      <div class="info-icon">🏃</div>
                      <div class="info-details">
                        <span class="info-label">活动水平</span>
                        <span class="info-value">{{ getActivityLevelText(userProfile?.activityLevel || 'moderate') }}</span>
                      </div>
                    </div>
                    <div class="info-item">
                      <div class="info-icon">🍎</div>
                      <div class="info-details">
                        <span class="info-label">饮食偏好</span>
                        <span class="info-value">{{ userProfile?.dietaryRestrictions?.join('、') || '无特殊限制' }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 模块 2: 营养概览 -->
              <div class="analysis-module nutrition-overview-module">
                <div class="module-header">
                  <div class="header-left">
                    <div class="module-icon">📊</div>
                    <h3 class="module-title">营养概览</h3>
                  </div>
                  <div class="confidence-score">
                    <div class="score-circle">
                      <span class="score-number">{{ aiAnalysisResult?.confidenceScore?.toFixed(0) || '85' }}</span>
                      <span class="score-unit">分</span>
                    </div>
                    <span class="score-label">可信度</span>
                  </div>
                </div>
                <div class="module-content">
                  <div class="nutrition-overview-grid">
                    <!-- 热量对比 -->
                    <div class="nutrition-category">
                      <h4 class="category-title">🔥 热量摄入</h4>
                      <div class="nutrition-comparison">
                        <div class="comparison-item needs">
                          <span class="item-label">每日所需</span>
                          <span class="item-value">{{ personalNutrition.dailyNeeds.calories.toFixed(0) }}</span>
                          <span class="item-unit">kcal</span>
                        </div>
                        <div class="comparison-arrow">→</div>
                        <div class="comparison-item current">
                          <span class="item-label">当前摄入</span>
                          <span class="item-value">{{ formatNumber(personalNutrition.currentIntake.calories, 0) }}</span>
                          <span class="item-unit">kcal</span>
                        </div>
                        <div class="comparison-status">
                          <span :class="['status-indicator', getCalorieStatus()]">
                            {{ getCalorieStatusText() }}
                          </span>
                        </div>
                      </div>
                    </div>

                    <!-- 三大营养素 -->
                    <div class="nutrition-category">
                      <h4 class="category-title">🥗 三大营养素</h4>
                      <div class="macronutrients-grid">
                        <div class="macro-item protein">
                          <div class="macro-icon">🥩</div>
                          <div class="macro-details">
                            <span class="macro-name">蛋白质</span>
                            <div class="macro-values">
                              <span class="current">{{ formatNumber(personalNutrition.currentIntake.protein, 1) }}g</span>
                              <span class="divider">/</span>
                              <span class="needed">{{ personalNutrition.dailyNeeds.protein.toFixed(1) }}g</span>
                            </div>
                            <div class="macro-progress">
                              <div class="progress-bar">
                                <div class="progress-fill" :style="{ width: getProteinProgress() + '%' }"></div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="macro-item carbs">
                          <div class="macro-icon">🍞</div>
                          <div class="macro-details">
                            <span class="macro-name">碳水化合物</span>
                            <div class="macro-values">
                              <span class="current">{{ formatNumber(personalNutrition.currentIntake.carbs, 1) }}g</span>
                              <span class="divider">/</span>
                              <span class="needed">{{ personalNutrition.dailyNeeds.carbs.toFixed(1) }}g</span>
                            </div>
                            <div class="macro-progress">
                              <div class="progress-bar">
                                <div class="progress-fill" :style="{ width: getCarbsProgress() + '%' }"></div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="macro-item fat">
                          <div class="macro-icon">🥑</div>
                          <div class="macro-details">
                            <span class="macro-name">脂肪</span>
                            <div class="macro-values">
                              <span class="current">{{ formatNumber(personalNutrition.currentIntake.fat, 1) }}g</span>
                              <span class="divider">/</span>
                              <span class="needed">{{ personalNutrition.dailyNeeds.fat.toFixed(1) }}g</span>
                            </div>
                            <div class="macro-progress">
                              <div class="progress-bar">
                                <div class="progress-fill" :style="{ width: getFatProgress() + '%' }"></div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- 维生素和矿物质 -->
                    <div class="nutrition-category">
                      <h4 class="category-title">💊 维生素矿物质</h4>
                      <div class="vitamins-grid">
                        <div class="vitamin-item">
                          <span class="vitamin-icon">🍊</span>
                          <span class="vitamin-name">维生素C</span>
                          <span class="vitamin-value">{{ personalNutrition.currentIntake.vitaminC?.toFixed(1) || '65.2' }}mg</span>
                        </div>
                        <div class="vitamin-item">
                          <span class="vitamin-icon">🥛</span>
                          <span class="vitamin-name">钙</span>
                          <span class="vitamin-value">{{ personalNutrition.currentIntake.calcium?.toFixed(1) || '420.8' }}mg</span>
                        </div>
                        <div class="vitamin-item">
                          <span class="vitamin-icon">🥩</span>
                          <span class="vitamin-name">铁</span>
                          <span class="vitamin-value">{{ personalNutrition.currentIntake.iron?.toFixed(1) || '12.5' }}mg</span>
                        </div>
                        <div class="vitamin-item">
                          <span class="vitamin-icon">🥬</span>
                          <span class="vitamin-name">膳食纤维</span>
                          <span class="vitamin-value">{{ personalNutrition.currentIntake.fiber?.toFixed(1) || '18.6' }}g</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 模块 3: 营养平衡分析 -->
              <div class="analysis-module nutrition-balance-module">
                <div class="module-header">
                  <div class="header-left">
                    <div class="module-icon">🎯</div>
                    <h3 class="module-title">营养平衡分析</h3>
                  </div>
                  <div class="balance-score">
                    <span class="score-label">平衡度</span>
                    <span class="score-value">{{ getNutritionBalanceScore() }}%</span>
                  </div>
                </div>
                <div class="module-content">
                  <div class="balance-analysis-grid">
                    <!-- 雷达图 -->
                    <div class="chart-section">
                      <div class="chart-container">
                        <canvas ref="nutrientsChart" class="nutrition-chart"></canvas>
                      </div>
                      <div class="chart-legend">
                        <div class="legend-item">
                          <div class="legend-color current"></div>
                          <span class="legend-text">当前摄入</span>
                        </div>
                        <div class="legend-item">
                          <div class="legend-color recommended"></div>
                          <span class="legend-text">推荐摄入</span>
                        </div>
                      </div>
                    </div>
                    
                    <!-- 营养素详细分析 -->
                    <div class="nutrients-analysis">
                      <h4 class="analysis-title">营养素分析</h4>
                      <div class="nutrients-list">
                        <div class="nutrient-item excellent">
                          <div class="nutrient-status">✅</div>
                          <div class="nutrient-info">
                            <span class="nutrient-name">蛋白质</span>
                            <span class="nutrient-desc">摄入充足，有助于肌肉维护</span>
                          </div>
                        </div>
                        <div class="nutrient-item good">
                          <div class="nutrient-status">⚡</div>
                          <div class="nutrient-info">
                            <span class="nutrient-name">碳水化合物</span>
                            <span class="nutrient-desc">能量供应良好</span>
                          </div>
                        </div>
                        <div class="nutrient-item attention">
                          <div class="nutrient-status">⚠️</div>
                          <div class="nutrient-info">
                            <span class="nutrient-name">膳食纤维</span>
                            <span class="nutrient-desc">略显不足，建议增加蔬果摄入</span>
                          </div>
                        </div>
                        <div class="nutrient-item warning">
                          <div class="nutrient-status">❗</div>
                          <div class="nutrient-info">
                            <span class="nutrient-name">维生素D</span>
                            <span class="nutrient-desc">明显不足，建议适当补充</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 模块 4: AI智能分析 -->
              <div class="analysis-module ai-analysis-module">
                <div class="module-header">
                  <div class="header-left">
                    <div class="module-icon">🤖</div>
                    <h3 class="module-title">AI智能分析</h3>
                  </div>
                  <div class="ai-badge">
                    <span class="badge-text">GPT分析</span>
                  </div>
                </div>
                <div class="module-content">
                  <div class="ai-analysis-grid">
                    <!-- AI个性化建议 -->
                    <div class="ai-section recommendations">
                      <h4 class="section-title">
                        <span class="title-icon">💡</span>
                        个性化建议
                      </h4>
                      <div class="recommendations-list">
                        <div
                          v-for="(recommendation, index) in aiAnalysisResult?.personalizedRecommendations || defaultRecommendations"
                          :key="index"
                          class="recommendation-item"
                        >
                          <div class="item-marker">{{ index + 1 }}</div>
                          <div class="item-content">{{ recommendation }}</div>
                        </div>
                      </div>
                    </div>

                    <!-- 健康风险评估 -->
                    <div class="ai-section risks">
                      <h4 class="section-title">
                        <span class="title-icon">⚠️</span>
                        健康风险评估
                      </h4>
                      <div class="risks-list">
                        <div
                          v-for="(risk, index) in aiAnalysisResult?.riskAssessments || defaultRisks"
                          :key="index"
                          :class="['risk-item', risk.level]"
                        >
                          <div class="risk-level">{{ risk.icon }}</div>
                          <div class="risk-content">
                            <span class="risk-title">{{ risk.title }}</span>
                            <span class="risk-desc">{{ risk.description }}</span>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- 改进建议 -->
                    <div class="ai-section improvements">
                      <h4 class="section-title">
                        <span class="title-icon">📈</span>
                        膳食改进建议
                      </h4>
                      <div class="improvements-list">
                        <div
                          v-for="(improvement, index) in aiAnalysisResult?.improvementSuggestions || defaultImprovements"
                          :key="index"
                          class="improvement-item"
                        >
                          <div class="improvement-category">{{ improvement.category }}</div>
                          <div class="improvement-content">{{ improvement.suggestion }}</div>
                        </div>
                      </div>
                    </div>

                    <!-- 健康洞察 -->
                    <div class="ai-section insights">
                      <h4 class="section-title">
                        <span class="title-icon">🔍</span>
                        健康洞察
                      </h4>
                      <div class="insights-list">
                        <div
                          v-for="(insight, index) in aiAnalysisResult?.healthInsights || defaultInsights"
                          :key="index"
                          class="insight-item"
                        >
                          <div class="insight-icon">📊</div>
                          <div class="insight-content">{{ insight }}</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- 食物分组摄入建议 -->
        <div class="analytics-card food-groups-card">
          <h2 class="card-title">
            <span class="card-icon">🥗</span>
            食物分组每日摄入建议
          </h2>

          <div class="food-groups-grid">
            <div
              v-for="group in dietaryGuidelines.foodGroups"
              :key="group.group"
              class="food-group-item"
            >
              <div class="group-header">
                <h3 class="group-name">{{ group.group }}</h3>
                <div class="group-amount">
                  {{ group.dailyIntake.amount }}{{ group.dailyIntake.unit }}
                  <span v-if="group.dailyIntake.range" class="amount-range">
                    ({{ group.dailyIntake.range.min }}-{{ group.dailyIntake.range.max
                    }}{{ group.dailyIntake.unit }})
                  </span>
                </div>
              </div>

              <div class="group-examples">
                <div class="examples-label">主要食物：</div>
                <div class="examples-list">
                  <span
                    v-for="example in group.examples.slice(0, 6)"
                    :key="example"
                    class="example-tag"
                  >
                    {{ example }}
                  </span>
                </div>
              </div>

              <div class="nutrition-focus">
                <div class="focus-label">营养重点：</div>
                <div class="focus-list">
                  {{ group.nutritionFocus.join('、') }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 季节性推荐 -->
        <div class="analytics-card seasonal-card">
          <h2 class="card-title">
            <span class="card-icon">🌱</span>
            当季营养推荐
          </h2>

          <div class="seasonal-content">
            <div class="season-info">
              <div class="season-badge">{{ getSeasonName(seasonalRecommendation.season) }}</div>
              <div class="season-benefit">{{ seasonalRecommendation.seasonalBenefits[0] }}</div>
            </div>

            <div class="seasonal-foods">
              <h3 class="section-title">推荐食材</h3>
              <div class="foods-grid">
                <div
                  v-for="food in seasonalRecommendation.recommendedFoods.slice(0, 12)"
                  :key="food"
                  class="food-item"
                >
                  {{ food }}
                </div>
              </div>
            </div>

            <div class="seasonal-recipes">
              <h3 class="section-title">时令食谱</h3>
              <div class="recipes-list">
                <div
                  v-for="recipe in seasonalRecommendation.recipes"
                  :key="recipe"
                  class="recipe-item"
                >
                  <span class="recipe-icon">🍳</span>
                  <span class="recipe-name">{{ recipe }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 中医体质分析与个人营养联动 -->
        <div class="analytics-card tcm-card tcm-constitution-card">
          <h2 class="card-title">
            <span class="card-icon">🏥</span>
            中医体质分析与膳食调理
          </h2>

          <div v-if="!hasUserData" class="no-data-prompt tcm-prompt">
            <div class="prompt-content">
              <div class="prompt-icon">🏥</div>
              <h3 class="prompt-title">开始您的中医体质分析</h3>
              <p class="prompt-desc">
                基于传统中医理论，结合您的个人信息进行体质分析，提供个性化膳食调理建议
              </p>
              <el-button
                type="primary"
                size="large"
                @click="showUserForm = true"
                class="start-analysis-btn"
              >
                <el-icon><Edit /></el-icon>
                开始体质分析
              </el-button>
            </div>
          </div>

          <div v-else class="tcm-analysis-content">
            <!-- 体质分析结果 -->
            <div v-if="tcmAnalysisResult" class="constitution-analysis">
              <div class="constitution-header">
                <div class="constitution-main">
                  <div class="constitution-type">
                    <span class="constitution-name">{{
                      tcmAnalysisResult.primaryConstitution.name
                    }}</span>
                    <span class="constitution-confidence"
                      >置信度：{{ tcmAnalysisResult.primaryConstitution.confidence }}%</span
                    >
                  </div>
                  <div
                    v-if="tcmAnalysisResult.secondaryConstitution"
                    class="secondary-constitution"
                  >
                    兼有：{{ tcmAnalysisResult.secondaryConstitution.name }}
                  </div>
                </div>
                <div class="health-score">
                  <div class="score-circle">
                    <div class="score-value">{{ tcmAnalysisResult.overallHealthScore }}</div>
                    <div class="score-label">健康评分</div>
                  </div>
                </div>
              </div>

              <!-- 体质特征 -->
              <div class="constitution-characteristics">
                <h4 class="subsection-title">体质特征</h4>
                <div class="characteristics-grid">
                  <div
                    v-for="(characteristic, index) in tcmAnalysisResult.primaryConstitution
                      .characteristics"
                    :key="index"
                    class="characteristic-item"
                  >
                    <span class="characteristic-icon">✓</span>
                    <span class="characteristic-text">{{ characteristic }}</span>
                  </div>
                </div>
              </div>

              <!-- 膳食调理建议（结合营养分析） -->
              <div class="dietary-guidance">
                <h4 class="subsection-title">个性化膳食调理</h4>
                <div class="guidance-sections">
                  <!-- 基于体质的营养建议 -->
                  <div class="guidance-section">
                    <h5 class="guidance-title">🍽️ 营养搭配建议</h5>
                    <div class="guidance-list">
                      <div
                        v-for="(advice, index) in combinedNutritionAdvice"
                        :key="index"
                        class="guidance-item"
                      >
                        <span class="guidance-icon">💡</span>
                        <span class="guidance-text">{{ advice }}</span>
                      </div>
                    </div>
                  </div>

                  <!-- 季节性调理 -->
                  <div class="guidance-section">
                    <h5 class="guidance-title">
                      🌸 {{ tcmAnalysisResult.seasonalDietPlan.currentSeason }}调理
                    </h5>
                    <div class="guidance-list">
                      <div
                        v-for="(rec, index) in tcmAnalysisResult.seasonalDietPlan.recommendations"
                        :key="index"
                        class="guidance-item"
                      >
                        <span class="guidance-icon">🌱</span>
                        <span class="guidance-text">{{ rec }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- AI 体质洞察 -->
              <div v-if="tcmAnalysisResult.aiInsights?.length" class="tcm-ai-insights">
                <h4 class="subsection-title">🤖 AI 中医洞察</h4>
                <div class="insights-list">
                  <div
                    v-for="(insight, index) in tcmAnalysisResult.aiInsights"
                    :key="index"
                    class="insight-item"
                  >
                    <span class="insight-icon">🔍</span>
                    <span class="insight-text">{{ insight }}</span>
                  </div>
                </div>
              </div>

              <!-- 易患疾病提醒 -->
              <div
                v-if="tcmAnalysisResult.primaryConstitution.susceptibleDiseases?.length"
                class="health-warnings"
              >
                <h4 class="subsection-title warning">⚠️ 健康提醒</h4>
                <div class="warnings-grid">
                  <div
                    v-for="(disease, index) in tcmAnalysisResult.primaryConstitution
                      .susceptibleDiseases"
                    :key="index"
                    class="warning-item"
                  >
                    <span class="warning-icon">⚠️</span>
                    <span class="warning-text">注意预防：{{ disease }}</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- 加载状态 -->
            <div v-else-if="analyzingTCM" class="tcm-loading">
              <div class="loading-content">
                <div class="loading-spinner"></div>
                <p class="loading-text">AI正在分析您的中医体质...</p>
              </div>
            </div>

            <!-- 分析操作 -->
            <div class="tcm-analysis-actions">
              <el-button @click="regenerateTCMAnalysis" :loading="analyzingTCM" type="primary">
                <el-icon><Refresh /></el-icon>
                {{ analyzingTCM ? '重新分析中...' : '重新AI体质分析' }}
              </el-button>
              <el-button @click="showUserForm = true" type="default">
                <el-icon><Edit /></el-icon>
                修改个人信息
              </el-button>
            </div>
          </div>
        </div>
      </div>

      <!-- 膳食指南详情弹窗 -->
      <el-dialog
        v-model="showFullGuidelines"
        title="中国居民膳食指南 (2022版)"
        width="80%"
        class="guidelines-dialog"
      >
        <div class="full-guidelines">
          <div
            v-for="principle in dietaryGuidelines.principles"
            :key="principle.id"
            class="guideline-detail"
          >
            <h3 class="detail-title">{{ principle.id }}. {{ principle.title }}</h3>
            <p class="detail-description">{{ principle.description }}</p>
            <ul class="detail-recommendations">
              <li v-for="rec in principle.recommendations" :key="rec">{{ rec }}</li>
            </ul>
          </div>
        </div>
      </el-dialog>

      <!-- 用户信息输入弹窗 -->
      <el-dialog
        v-model="showUserForm"
        title="个人信息与饮食记录"
        width="90%"
        :close-on-click-modal="false"
        class="user-form-dialog"
      >
        <UserProfileForm @submit="handleUserFormSubmit" @cancel="showUserForm = false" />
      </el-dialog>
    </div>
  </div>
</template>

<script setup lang="ts">
  import { ref, onMounted, onUnmounted, computed } from 'vue'
  import { ElMessage } from 'element-plus'
  import { Edit, Refresh } from '@element-plus/icons-vue'
  import Chart from 'chart.js/auto'
  import { nutritionAnalysisService } from '@/services/nutritionAnalysisService'
  import { aiPersonalizedNutritionService } from '@/services/aiPersonalizedNutritionService'
  import { tcmConstitutionService } from '@/services/tcmConstitutionService'
  import UserProfileForm from '@/components/analytics/UserProfileForm.vue'
  import type { NutrientAnalysis } from '@/services/nutritionAnalysisService'
  import type {
    ExtendedUserProfile,
    AIAnalysisResult,
  } from '@/services/aiPersonalizedNutritionService'
  import type { TCMAnalysisResult } from '@/services/tcmConstitutionService'

  // 图表引用
  const nutrientsChart = ref<HTMLCanvasElement | null>(null)
  const constitutionChart = ref<HTMLCanvasElement | null>(null)

  // 图表实例存储
  let nutrientsChartInstance: Chart | null = null
  let constitutionChartInstance: Chart | null = null

  // 响应式数据
  const showFullGuidelines = ref(false)
  const showUserForm = ref(false)
  const analyzingData = ref(false)
  const analyzingTCM = ref(false)

  // 用户数据和分析结果
  const userProfile = ref<ExtendedUserProfile | null>({
    age: 28,
    gender: 'female',
    weight: 58,
    height: 165,
    activityLevel: 'moderate',
    healthGoals: ['减脂', '健康饮食', '增强体质'],
    dietaryRestrictions: ['素食主义'],
    meals: [
      {
        name: '早餐',
        foods: ['燕麦粥', '牛奶', '香蕉', '坚果'],
        time: '08:00'
      },
      {
        name: '午餐', 
        foods: ['糙米饭', '蒸蛋羹', '西兰花', '胡萝卜'],
        time: '12:30'
      },
      {
        name: '晚餐',
        foods: ['蔬菜沙拉', '烤鸡胸肉', '红薯'],
        time: '18:30'
      }
    ],
    medicalConditions: [],
    allergies: [],
    dietaryPreferences: ['低盐', '少油', '高蛋白']
  })
  const aiAnalysisResult = ref<AIAnalysisResult | null>(null)
  const tcmAnalysisResult = ref<TCMAnalysisResult | null>(null)

  // 获取膳食指南数据
  const dietaryGuidelines = computed(() => nutritionAnalysisService.getChineseDietaryGuidelines())

  // 检查是否有用户数据
  const hasUserData = computed(() => !!userProfile.value)

  // 辅助函数：安全地格式化数值
  const formatNumber = (value: any, decimals: number = 1): string => {
    if (typeof value === 'number') {
      return value.toFixed(decimals)
    } else if (typeof value === 'string' && /^\d+(\.\d+)?$/.test(value)) {
      return parseFloat(value).toFixed(decimals)
    }
    return value || '0'
  }

  // 模拟当前营养摄入（如果没有AI分析结果，使用默认值）
  const currentIntake = computed<NutrientAnalysis>(() => {
    if (aiAnalysisResult.value?.nutritionAnalysis) {
      return aiAnalysisResult.value.nutritionAnalysis
    }

    // 默认值
    return {
      calories: 1800,
      protein: 50,
      carbs: 200,
      fat: 60,
      fiber: 18,
      sodium: 2200,
      calcium: 600,
      iron: 15,
      vitaminC: 80,
      sugar: 40,
    }
  })

  // 个人营养分析
  const personalNutrition = computed(() => {
    if (!userProfile.value) {
      // 返回默认分析结果
      return {
        dailyNeeds: {
          calories: 2000,
          protein: 60,
          carbs: 250,
          fat: 67,
          fiber: 25,
          sodium: 2000,
          calcium: 800,
          iron: 12,
          vitaminC: 100,
          sugar: 50,
        },
        currentIntake: currentIntake.value,
        balanceScore: 85,
        recommendations: ['开始输入您的个人信息以获取个性化建议'],
        deficiencies: [],
        excesses: [],
      }
    }

    const basicProfile = {
      age: userProfile.value.age,
      gender: userProfile.value.gender,
      weight: userProfile.value.weight,
      height: userProfile.value.height,
      activityLevel: userProfile.value.activityLevel,
      healthGoals: userProfile.value.healthGoals,
    }

    return nutritionAnalysisService.generatePersonalizedRecommendations(
      basicProfile,
      currentIntake.value
    )
  })

  // 季节性推荐
  const seasonalRecommendation = computed(() =>
    nutritionAnalysisService.getSeasonalRecommendations()
  )

  // 中医体质分析和营养建议的联合推荐
  const combinedNutritionAdvice = computed(() => {
    const advice: string[] = []

    // 基础营养建议
    if (personalNutrition.value.recommendations) {
      advice.push(...personalNutrition.value.recommendations)
    }

    // 基于中医体质的营养建议
    if (tcmAnalysisResult.value?.nutritionalGuidance) {
      advice.push(...tcmAnalysisResult.value.nutritionalGuidance)
    }

    // 基于体质的特殊营养建议
    if (tcmAnalysisResult.value?.primaryConstitution) {
      const constitutionAdvice = tcmConstitutionService.getConstitutionBasedNutritionAdvice(
        tcmAnalysisResult.value.primaryConstitution
      )
      advice.push(...constitutionAdvice)
    }

    // 去重并限制数量
    return [...new Set(advice)].slice(0, 6)
  })

  // 中医体质分析（保留兼容性）
  const tcmAnalysis = computed(() =>
    nutritionAnalysisService.analyzeTCMConstitution(['正常'], ['清淡'])
  )

  // 计算BMI
  const calculateBMI = () => {
    if (!userProfile.value) return 0
    const heightInMeters = userProfile.value.height / 100
    return userProfile.value.weight / (heightInMeters * heightInMeters)
  }

  // 获取BMI状态
  const getBMIStatus = () => {
    const bmi = calculateBMI()
    if (bmi < 18.5) return 'underweight'
    if (bmi < 24) return 'normal'
    if (bmi < 28) return 'overweight'
    return 'obese'
  }

  // 获取BMI状态文本
  const getBMIStatusText = () => {
    const status = getBMIStatus()
    const statusTexts = {
      underweight: '偏瘦',
      normal: '正常',
      overweight: '超重',
      obese: '肥胖',
    }
    return statusTexts[status as keyof typeof statusTexts] || '未知'
  }

  // 获取活动水平文本
  const getActivityLevelText = (level: string) => {
    const levelTexts = {
      sedentary: '久坐少动',
      light: '轻度活动',
      moderate: '中度活动',
      active: '高度活动',
      very_active: '极高活动'
    }
    return levelTexts[level as keyof typeof levelTexts] || level
  }

  // 获取热量状态
  const getCalorieStatus = () => {
    const current = personalNutrition.value.currentIntake.calories
    const needed = personalNutrition.value.dailyNeeds.calories
    const ratio = current / needed
    
    if (ratio < 0.8) return 'low'
    if (ratio > 1.2) return 'high'
    return 'normal'
  }

  // 获取热量状态文本
  const getCalorieStatusText = () => {
    const status = getCalorieStatus()
    const statusTexts = {
      low: '摄入不足',
      normal: '摄入适中',
      high: '摄入过量'
    }
    return statusTexts[status as keyof typeof statusTexts] || '正常'
  }

  // 获取蛋白质摄入进度
  const getProteinProgress = () => {
    const current = personalNutrition.value.currentIntake.protein
    const needed = personalNutrition.value.dailyNeeds.protein
    return Math.min((current / needed) * 100, 100)
  }

  // 获取碳水化合物摄入进度
  const getCarbsProgress = () => {
    const current = personalNutrition.value.currentIntake.carbs
    const needed = personalNutrition.value.dailyNeeds.carbs
    return Math.min((current / needed) * 100, 100)
  }

  // 获取脂肪摄入进度
  const getFatProgress = () => {
    const current = personalNutrition.value.currentIntake.fat
    const needed = personalNutrition.value.dailyNeeds.fat
    return Math.min((current / needed) * 100, 100)
  }

  // 获取营养平衡评分
  const getNutritionBalanceScore = () => {
    const proteinScore = Math.min(getProteinProgress(), 100)
    const carbsScore = Math.min(getCarbsProgress(), 100)
    const fatScore = Math.min(getFatProgress(), 100)
    
    return Math.round((proteinScore + carbsScore + fatScore) / 3)
  }

  // 默认推荐数据
  const defaultRecommendations = [
    '增加深色蔬菜摄入，建议每日300-500克，提供丰富的维生素和矿物质',
    '适量补充优质蛋白质，如鱼类、瘦肉、豆制品，每日1.2g/kg体重',
    '控制精制糖和高盐食物，选择低钠食品，每日盐摄入不超过6克',
    '保持规律用餐时间，避免暴饮暴食，少食多餐有益消化',
    '增加膳食纤维摄入，全谷物、果蔬能改善肠道健康'
  ]

  // 默认风险数据
  const defaultRisks = [
    { 
      icon: '🟢', 
      level: 'low', 
      title: '心血管风险', 
      description: '当前饮食结构对心血管健康较为友好' 
    },
    { 
      icon: '🟡', 
      level: 'medium', 
      title: '营养不均衡', 
      description: '部分营养素摄入可能不足，需要调整饮食结构' 
    },
    { 
      icon: '🟠', 
      level: 'high', 
      title: '膳食纤维不足', 
      description: '膳食纤维摄入偏低，可能影响肠道健康' 
    }
  ]

  // 默认改进建议
  const defaultImprovements = [
    { category: '蔬果类', suggestion: '每日至少5种不同颜色的蔬果，保证维生素多样性' },
    { category: '蛋白质', suggestion: '适当增加鱼类和豆制品比例，减少红肉摄入' },
    { category: '主食类', suggestion: '用粗粮替代部分精制米面，增加B族维生素' },
    { category: '油脂类', suggestion: '选择富含不饱和脂肪酸的植物油，控制总量' }
  ]

  // 默认健康洞察
  const defaultInsights = [
    '您的蛋白质摄入比例合理，有助于维持肌肉量和基础代谢',
    '建议增加ω-3脂肪酸摄入，可通过深海鱼类或亚麻籽油补充',
    '当前钙质摄入略显不足，建议适量增加奶制品或深绿色蔬菜',
    '膳食纤维摄入有待提高，有助于改善肠道微生态平衡'
  ]

  // 方法
  const getSeasonName = (season: string) => {
    const seasonNames = {
      spring: '春季',
      summer: '夏季',
      autumn: '秋季',
      winter: '冬季',
    }
    return seasonNames[season as keyof typeof seasonNames] || season
  }

  // 处理用户表单提交
  const handleUserFormSubmit = async (formData: any) => {
    analyzingData.value = true
    analyzingTCM.value = true
    showUserForm.value = false

    try {
      // 转换表单数据为ExtendedUserProfile格式
      const extendedProfile: ExtendedUserProfile = {
        age: formData.age,
        gender: formData.gender,
        weight: formData.weight,
        height: formData.height,
        activityLevel: formData.activityLevel,
        healthGoals: formData.healthGoals,
        meals: formData.meals,
        medicalConditions: formData.medicalConditions,
        allergies: formData.allergies,
        dietaryPreferences: formData.dietaryPreferences,
      }

      userProfile.value = extendedProfile

      // 并行执行营养分析和中医体质分析
      const [nutritionResult, tcmResult] = await Promise.allSettled([
        aiPersonalizedNutritionService.analyzeUserNutrition({
          userProfile: extendedProfile,
          analysisType: 'comprehensive' as const,
          includeSeasonalRecommendations: true,
          includeTCMAnalysis: true,
        }),
        tcmConstitutionService.analyzeConstitution(extendedProfile),
      ])

      // 处理营养分析结果
      if (nutritionResult.status === 'fulfilled') {
        aiAnalysisResult.value = nutritionResult.value
      } else {
        console.error('营养分析失败:', nutritionResult.reason)
        ElMessage.warning('营养分析部分失败，请稍后重试')
      }

      // 处理中医体质分析结果
      if (tcmResult.status === 'fulfilled') {
        tcmAnalysisResult.value = tcmResult.value
      } else {
        console.error('中医体质分析失败:', tcmResult.reason)
        ElMessage.warning('中医体质分析部分失败，请稍后重试')
      }

      ElMessage.success('个人分析已完成！')

      // 延迟更新图表
      setTimeout(() => {
        destroyCharts()
        initCharts()
      }, 500)
    } catch (error) {
      console.error('分析失败:', error)
      ElMessage.error('分析失败，请稍后重试')
    } finally {
      analyzingData.value = false
      analyzingTCM.value = false
    }
  }

  // 重新生成分析
  const regenerateAnalysis = async () => {
    if (!userProfile.value) return

    analyzingData.value = true

    try {
      const analysisRequest = {
        userProfile: userProfile.value,
        analysisType: 'comprehensive' as const,
        includeSeasonalRecommendations: true,
        includeTCMAnalysis: true,
      }

      const result = await aiPersonalizedNutritionService.analyzeUserNutrition(analysisRequest)
      aiAnalysisResult.value = result

      ElMessage.success('AI分析已更新！')

      // 重新初始化图表
      setTimeout(() => {
        destroyCharts()
        initCharts()
      }, 300)
    } catch (error) {
      console.error('重新分析失败:', error)
      ElMessage.error('重新分析失败，请稍后重试')
    } finally {
      analyzingData.value = false
    }
  }

  // 重新生成中医体质分析
  const regenerateTCMAnalysis = async () => {
    if (!userProfile.value) {
      ElMessage.warning('请先输入个人信息')
      return
    }

    try {
      analyzingTCM.value = true

      const result = await tcmConstitutionService.analyzeConstitution(userProfile.value)
      tcmAnalysisResult.value = result

      ElMessage.success('中医体质分析已更新！')
    } catch (error) {
      console.error('重新生成中医体质分析失败:', error)
      ElMessage.error('体质分析失败，请稍后重试')
    } finally {
      analyzingTCM.value = false
    }
  }

  // 初始化默认分析数据
  const initializeDefaultData = () => {
    // 设置默认用户配置文件
    userProfile.value = {
      age: 28,
      gender: 'female',
      weight: 55,
      height: 165,
      activityLevel: 'moderate',
      healthGoals: ['减重', '增强免疫'],
      meals: [
        {
          name: '早餐',
          items: ['燕麦粥', '香蕉', '酸奶'],
          calories: 450
        },
        {
          name: '午餐',
          items: ['鸡胸肉沙拉', '糙米饭', '蔬菜汤'],
          calories: 650
        },
        {
          name: '晚餐',
          items: ['蒸鱼', '西兰花', '红薯'],
          calories: 550
        }
      ],
      medicalConditions: [],
      allergies: [],
      dietaryPreferences: ['少盐', '少糖']
    }

    // 设置默认AI分析结果
    aiAnalysisResult.value = {
      confidenceScore: 87,
      personalizedRecommendations: [
        '建议增加蛋白质摄入，每餐保证优质蛋白质来源',
        '多摄入富含维生素C的水果，如橙子、猕猴桃等',
        '适量增加健康脂肪摄入，如坚果、牛油果',
        '保持规律的三餐时间，避免暴饮暴食',
        '睡前3小时避免进食，有助于消化和减重'
      ],
      healthInsights: [
        '您的整体营养搭配较为均衡，蛋白质摄入符合需求',
        '维生素C摄入略显不足，建议增加新鲜水果摄入',
        '膳食纤维摄入良好，有助于消化系统健康',
        '钙质摄入需要关注，建议适量补充乳制品'
      ],
      riskAssessments: [
        '当前体重处于健康范围，但需注意维持',
        '长期缺乏维生素D可能影响钙吸收',
        '工作压力可能影响饮食规律性',
        '缺乏运动可能影响整体健康水平'
      ],
      improvementSuggestions: [
        '制定周期性的营养评估计划，每月检查一次',
        '增加户外活动时间，促进维生素D合成',
        '学习健康烹饪方法，减少营养流失',
        '建立饮水提醒，保证每日充足水分摄入'
      ],
      nutritionAnalysis: {
        calories: 1650,
        protein: 52,
        carbs: 180,
        fat: 58,
        fiber: 22,
        sodium: 1800,
        calcium: 650,
        iron: 14,
        vitaminC: 75,
        sugar: 35
      }
    }

    // 设置默认中医体质分析结果
    tcmAnalysisResult.value = {
      primaryConstitution: {
        name: '平和质',
        confidence: 85,
        characteristics: [
          '体形匀称健壮',
          '面色润泽',
          '精力充沛',
          '睡眠良好',
          '食欲正常'
        ],
        susceptibleDiseases: []
      },
      secondaryConstitution: {
        name: '气虚质',
        confidence: 25,
        characteristics: [
          '偶有疲倦感',
          '运动后易出汗'
        ],
        susceptibleDiseases: ['感冒']
      },
      overallHealthScore: 88,
      seasonalDietPlan: {
        currentSeason: '春季',
        recommendations: [
          '多食用绿叶蔬菜，如菠菜、韭菜等',
          '适量进食温性食物，如生姜、大枣',
          '减少寒凉食物摄入，避免损伤脾胃',
          '保持饮食清淡，避免过于油腻'
        ]
      },
      aiInsights: [
        '您的体质整体偏向平和，是较为理想的体质类型',
        '略有气虚倾向，建议适当进补益气食物',
        '春季养生重在养肝，宜食用青色食物',
        '保持良好的作息习惯，有助于体质调理'
      ]
    }
  }

  // 初始化图表
  const initCharts = () => {
    // 营养素雷达图
    if (nutrientsChart.value && hasUserData.value) {
      const ctx = nutrientsChart.value.getContext('2d')
      if (ctx) {
        const daily = personalNutrition.value.dailyNeeds
        const current = personalNutrition.value.currentIntake

        nutrientsChartInstance = new Chart(ctx, {
          type: 'radar',
          data: {
            labels: ['蛋白质', '钙', '铁', '维生素C', '膳食纤维'],
            datasets: [
              {
                label: '当前摄入',
                data: [
                  (current.protein / daily.protein) * 100,
                  (current.calcium / daily.calcium) * 100,
                  (current.iron / daily.iron) * 100,
                  (current.vitaminC / daily.vitaminC) * 100,
                  (current.fiber / daily.fiber) * 100,
                ],
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2,
              },
              {
                label: '推荐摄入',
                data: [100, 100, 100, 100, 100],
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              r: {
                min: 0,
                max: 150,
                ticks: {
                  stepSize: 25,
                },
              },
            },
          },
        })
      }
    }

    // 体质分析饼图
    if (constitutionChart.value) {
      const ctx = constitutionChart.value.getContext('2d')
      if (ctx) {
        const balance = tcmAnalysis.value.foodNatureBalance

        constitutionChartInstance = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: ['热性', '温性', '平性', '凉性', '寒性'],
            datasets: [
              {
                data: [balance.hot, balance.warm, balance.neutral, balance.cool, balance.cold],
                backgroundColor: ['#ff6b6b', '#ffa726', '#66bb6a', '#42a5f5', '#7e57c2'],
                borderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
              },
            },
          },
        })
      }
    }
  }

  // 清理图表
  const destroyCharts = () => {
    if (nutrientsChartInstance) {
      nutrientsChartInstance.destroy()
      nutrientsChartInstance = null
    }
    if (constitutionChartInstance) {
      constitutionChartInstance.destroy()
      constitutionChartInstance = null
    }
  }

  // 生命周期
  onMounted(() => {
    // 初始化默认数据
    initializeDefaultData()
    
    setTimeout(() => {
      initCharts()
    }, 100)
  })

  // 在组件卸载时清理图表
  onUnmounted(() => {
    destroyCharts()
  })
</script>

<style lang="scss" scoped>
  @import '@/styles/variables.scss';

  .analytics-view {
    min-height: 100vh;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    padding: 2rem 0;

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    .analytics-header {
      text-align: center;
      margin-bottom: 3rem;

      .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;

        .title-icon {
          font-size: 3rem;
        }
      }

      .page-subtitle {
        font-size: 1.2rem;
        color: #7f8c8d;
        margin: 0;
      }
    }

    .analytics-dashboard {
      display: grid;
      grid-template-columns: 1fr;
      gap: 2rem;
      
      // 确保所有模块都有一致的布局宽度
      @media (min-width: 768px) {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }
    }

    .analytics-card {
      background: white;
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;

      &:hover {
        transform: translateY(-5px);
      }

      // 所有模块都采用统一的布局宽度，确保一致性
      &.nutrition-card {
        min-width: 100%;
        max-width: 100%;
      }

        // 内部布局优化：重新设计为左右两栏式
        .analysis-main-layout {
          display: flex;
          flex-direction: column;
          gap: 2rem;
        }

        // 主网格布局：采用更均衡的空间分配
        .analysis-main-grid {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 1.5rem;
          align-items: start;
          
          // 移动端单列布局
          @media (max-width: 768px) {
            grid-template-columns: 1fr;
            gap: 1.5rem;
          }
        }

        // 左侧区域：营养图表和下方AI模块
        .analysis-left-section {
          display: flex;
          flex-direction: column;
          gap: 1.5rem;
        }

        // 营养图表区域
        .nutrition-chart-section {
          background: white;
          border-radius: 12px;
          padding: 1.5rem;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        // 左侧下方AI模块：使用flex布局优化空间利用
        .analysis-left-bottom {
          display: flex;
          gap: 1rem;
          margin-top: 1.5rem;
          
          // 子模块自适应宽度
          > .analysis-module {
            flex: 1;
            min-width: 0;
          }
          
          // 移动端单列布局
          @media (max-width: 768px) {
            grid-template-columns: 1fr;
            gap: 1rem;
          }
        }

        // 右侧AI模块容器：使用flex布局自适应空间
        .analysis-right-section {
          display: flex;
          gap: 1rem;
          height: fit-content;
          width: 100%;
          
          // 子模块自适应宽度，确保充分利用空间
          > .analysis-module {
            flex: 1;
            min-width: 0; // 允许收缩
            max-width: none; // 移除最大宽度限制
          }
          
          // 移动端单列布局
          @media (max-width: 768px) {
            flex-direction: column;
            gap: 1rem;
          }
        }

        // 分析操作按钮区域：位于左侧AI模块下方
        .analysis-actions {
          display: flex;
          justify-content: center;
          align-items: center;
          margin-top: 1.5rem;
          padding-top: 1rem;
          border-top: 1px solid #ebeef5;
          width: 100%;
          
          .el-button {
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: 25px;
            font-weight: 600;
            
            &:hover {
              transform: translateY(-2px);
              box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            }
          }
        }

        // 分析模块统一样式 - 优化空间利用
        .analysis-module {
          background: #f8f9fa;
          border-radius: 12px;
          padding: 1rem;
          border-left: 4px solid #3498db;
          width: 100%;
          box-sizing: border-box;
          
          .section-title {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.6rem;
            color: #2c3e50;
            
            &.warning {
              color: #e74c3c;
            }
          }
          
          // 左侧下方模块和右侧模块样式优化（更紧凑）
          .analysis-left-bottom &,
          .analysis-right-section & {
            min-height: auto;
            padding: 0.8rem;
            
            .section-title {
              font-size: 0.9rem;
              margin-bottom: 0.5rem;
            }
          }
          
          // AI个性化建议模块
          &.nutrition-recommendations {
            border-left-color: #28a745;
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
            
            .recommendation-item {
              display: flex;
              align-items: flex-start;
              gap: 0.4rem;
              padding: 0.4rem;
              margin-bottom: 0.4rem;
              background: rgba(255, 255, 255, 0.7);
              border-radius: 6px;
              font-size: 0.8rem;
              line-height: 1.3;
              
              .recommendation-icon {
                font-size: 0.9rem;
                flex-shrink: 0;
              }
              
              // 在左侧下方和右侧模块时更紧凑
              .analysis-left-bottom &,
              .analysis-right-section & {
                padding: 0.5rem;
                margin-bottom: 0.5rem;
                font-size: 0.8rem;
              }
            }
          }
          
          // 健康洞察模块
          &.health-insights {
            border-left-color: #17a2b8;
            background: linear-gradient(135deg, #e3f2fd 0%, #f0f8ff 100%);
            
            .insight-item {
              display: flex;
              align-items: flex-start;
              gap: 0.4rem;
              padding: 0.4rem;
              margin-bottom: 0.4rem;
              background: rgba(255, 255, 255, 0.7);
              border-radius: 6px;
              font-size: 0.8rem;
              line-height: 1.3;
              
              .insight-icon {
                font-size: 0.9rem;
                flex-shrink: 0;
              }
              
              // 在左侧下方和右侧模块时更紧凑
              .analysis-left-bottom &,
              .analysis-right-section & {
                padding: 0.5rem;
                margin-bottom: 0.5rem;
                font-size: 0.8rem;
              }
            }
          }
          
          // 风险评估模块
          &.risk-assessments {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            
            .risk-item {
              display: flex;
              align-items: flex-start;
              gap: 0.4rem;
              padding: 0.4rem;
              margin-bottom: 0.4rem;
              background: rgba(255, 255, 255, 0.7);
              border-radius: 6px;
              font-size: 0.8rem;
              line-height: 1.3;
              
              .risk-icon {
                font-size: 0.9rem;
                flex-shrink: 0;
              }
            }
          }
          
          // 改善建议模块
          &.improvement-suggestions {
            border-left-color: #ffc107;
            background: linear-gradient(135deg, #fff3cd 0%, #fefefe 100%);
            
            .improvement-item {
              display: flex;
              align-items: flex-start;
              gap: 0.4rem;
              padding: 0.4rem;
              margin-bottom: 0.4rem;
              background: rgba(255, 255, 255, 0.7);
              border-radius: 6px;
              font-size: 0.8rem;
              line-height: 1.3;
              
              .improvement-icon {
                font-size: 0.9rem;
                flex-shrink: 0;
              }
            }
          }
        }

        .analysis-left {
          min-height: 500px;
        }

        // 营养雷达图容器
        .nutrients-chart {
          min-height: 400px;
          width: 100%;
        }
      }

      // 所有模块都采用统一的布局宽度，确保一致性
      &.tcm-card {
        min-width: 100%;
        max-width: 100%;
      }

      // 所有模块都采用统一的布局宽度，确保一致性  
      &.seasonal-card {
        min-width: 100%;
        max-width: 100%;
      }

      .card-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;

        .card-icon {
          font-size: 1.8rem;
        }
      }

      .section-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #34495e;
        margin-bottom: 1rem;

        &.warning {
          color: #f39c12;
        }

        &.danger {
          color: #e74c3c;
        }
      }
    }

    .guidelines-card {
      // 所有模块都采用统一的布局宽度，确保一致性
      min-width: 100%;
      max-width: 100%;

      .guidelines-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.2rem;
        margin-bottom: 1.5rem;
      }

      .guideline-item {
        display: flex;
        gap: 0.8rem;
        padding: 1.2rem;
        background: #f8f9fa;
        border-radius: 15px;
        border-left: 4px solid #3498db;

        .guideline-number {
          width: 36px;
          height: 36px;
          background: #3498db;
          color: white;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: 600;
          font-size: 1.1rem;
          flex-shrink: 0;
        }

        .guideline-content {
          flex: 1;

          .guideline-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.5rem;
          }

          .guideline-desc {
            color: #7f8c8d;
            line-height: 1.5;
            margin: 0;
          }
        }
      }

      .view-all-btn {
        border-radius: 25px;
        padding: 0.8rem 2rem;
      }
    }

    .nutrition-card {
      .no-data-prompt {
        text-align: center;
        padding: 3rem 2rem;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 20px;
        border: 2px dashed #dee2e6;

        .prompt-content {
          max-width: 500px;
          margin: 0 auto;

          .prompt-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.8;
          }

          .prompt-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1rem;
          }

          .prompt-desc {
            color: #7f8c8d;
            line-height: 1.6;
            margin-bottom: 2rem;
          }

          .start-analysis-btn {
            padding: 1rem 2rem;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
          }
        }
      }

      .nutrition-analysis {
        margin-bottom: 2rem;

        .analysis-main-layout {
          display: grid;
          grid-template-columns: 1.2fr 0.8fr;
          gap: 2rem;
          margin-bottom: 2rem;

          @media (max-width: 1200px) {
            grid-template-columns: 1fr;
            gap: 1.5rem;
          }
        }

        .analysis-left {
          .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 4px solid #3498db;

            .user-info-summary {
              flex: 1;

              .info-item {
                display: flex;
                align-items: center;
                margin-bottom: 0.8rem;

                .info-label {
                  color: #7f8c8d;
                  margin-right: 0.5rem;
                  font-weight: 500;
                }

                .info-value {
                  color: #2c3e50;
                  font-weight: 600;
                  margin-right: 0.5rem;
                }

                .bmi-status {
                  padding: 0.2rem 0.8rem;
                  border-radius: 12px;
                  font-size: 0.8rem;
                  font-weight: 600;

                  &.normal {
                    background: #d4edda;
                    color: #155724;
                  }

                  &.underweight {
                    background: #fff3cd;
                    color: #856404;
                  }

                  &.overweight {
                    background: #f8d7da;
                    color: #721c24;
                  }

                  &.obese {
                    background: #f5c6cb;
                    color: #721c24;
                  }
                }
              }
            }

            .edit-data-btn {
              border-radius: 20px;
              padding: 0.5rem 1rem;
            }
          }

          .analysis-summary {
            display: flex;
            gap: 2rem;
            align-items: center;
            margin-bottom: 2rem;

            .score-circle {
              width: 120px;
              height: 120px;
              border-radius: 50%;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              flex-shrink: 0;

              .score-value {
                font-size: 2rem;
                font-weight: 700;
              }

              .score-label {
                font-size: 0.9rem;
                margin-top: 0.5rem;
              }
            }

            .analysis-details {
              flex: 1;

              .detail-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.8rem 0;
                border-bottom: 1px solid #ecf0f1;

                &:last-child {
                  border-bottom: none;
                }

                .detail-label {
                  color: #7f8c8d;
                  font-size: 0.9rem;
                }

                .detail-value {
                  font-weight: 600;
                  color: #2c3e50;
                }
              }
            }
          }

          .nutrients-chart {
            height: 350px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 1.2rem;
          }
        }

        .analysis-right {
          // 右侧内容更紧凑
          padding: 0;
          
          .section-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.8rem;
            padding-bottom: 0.3rem;
            border-bottom: 2px solid #e9ecef;

            &.warning {
              color: #e74c3c;
            }
          }

          .nutrition-recommendations,
          .health-insights,
          .risk-assessments,
          .improvement-suggestions {
            margin-bottom: 1.5rem;

            .recommendations-list,
            .insights-list,
            .risks-list,
            .improvements-list {
              .recommendation-item,
              .insight-item,
              .risk-item,
              .improvement-item {
                display: flex;
                align-items: flex-start;
                gap: 0.6rem;
                padding: 0.8rem;
                margin-bottom: 0.6rem;
                border-radius: 8px;
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                transition: all 0.3s ease;
                font-size: 0.9rem;
                line-height: 1.4;

                &:hover {
                  background: #e9ecef;
                  transform: translateY(-1px);
                  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                }

                .recommendation-icon,
                .insight-icon,
                .risk-icon,
                .improvement-icon {
                  font-size: 1rem;
                  margin-top: 0.05rem;
                  flex-shrink: 0;
                }

                .recommendation-text,
                .insight-text,
                .risk-text,
                .improvement-text {
                  color: #2c3e50;
                  line-height: 1.4;
                  font-size: 0.85rem;
                }
              }

              .ai-recommendation {
                background: linear-gradient(135deg, #e3f2fd 0%, #e8f5e8 100%);
                border: 1px solid #81c784;
              }

              .risk-item {
                background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
                border: 1px solid #e57373;
              }
            }
          }
        }

        .analysis-actions {
          text-align: center;
          padding-top: 2rem;
          border-top: 1px solid #e9ecef;
        }
      }

      // BMI状态样式
      .bmi-status {
        margin-left: 0.5rem;
        padding: 0.3rem 0.8rem;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;

        &.normal {
        background: #d4edda;
        color: #155724;
      }

      &.underweight {
        background: #fff3cd;
        color: #856404;
      }

      &.overweight {
        background: #f8d7da;
        color: #721c24;
      }

      &.obese {
        background: #f5c6cb;
        color: #721c24;
      }
    }
  }

  .edit-data-btn {
    border-radius: 20px;
    padding: 0.5rem 1rem;
  }

  .analysis-summary {
    display: flex;
    gap: 2rem;
    align-items: center;
    margin-bottom: 2rem;

    .score-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;

      .score-value {
        font-size: 2rem;
        font-weight: 700;
      }

      .score-label {
        font-size: 0.9rem;
        margin-top: 0.5rem;
      }
    }

    .analysis-details {
      flex: 1;

      .detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.8rem 0;
        border-bottom: 1px solid #ecf0f1;

        &:last-child {
          border-bottom: none;
        }

        .detail-label {
          color: #7f8c8d;
        }

        .detail-value {
          font-weight: 600;
          color: #2c3e50;
        }
      }
    }
  }

  .nutrients-chart {
    height: 300px;
    background: #f8f9fa;
    border-radius: 15px;
    padding: 1rem;
  }

  .nutrition-recommendations {
    margin-bottom: 2rem;

    .recommendations-list {
      .recommendation-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 0.8rem;

        &.ai-recommendation {
          background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
          border-left: 4px solid #2196f3;
        }

        .recommendation-icon {
          font-size: 1.2rem;
        }

        .recommendation-text {
          flex: 1;
          color: #2c3e50;
          line-height: 1.5;
        }
      }
    }
  }

  .health-insights,
  .risk-assessments,
  .improvement-suggestions {
    margin-bottom: 2rem;

    .insights-list,
    .risks-list,
    .improvements-list {
      .insight-item,
      .risk-item,
      .improvement-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 0.8rem;

        .insight-icon,
        .risk-icon,
        .improvement-icon {
          font-size: 1.2rem;
        }

        .insight-text,
        .risk-text,
        .improvement-text {
          flex: 1;
          color: #2c3e50;
          line-height: 1.5;
        }
      }

      .risk-item {
        background: #fff3cd;
        border-left: 4px solid #ffc107;

        .risk-text {
          color: #856404;
        }
      }

      .improvement-item {
        background: #d1ecf1;
        border-left: 4px solid #17a2b8;

        .improvement-text {
          color: #0c5460;
        }
      }
    }
  }

  .analysis-actions {
    text-align: center;
    padding-top: 2rem;
    border-top: 1px solid #e9ecef;

    .el-button {
      border-radius: 25px;
      padding: 0.8rem 2rem;
      font-weight: 600;
    }
  }

  .deficiencies-section,
  .excesses-section {
    margin-top: 2rem;

    .deficiencies-tags,
    .excesses-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      margin-top: 1rem;

      .deficiency-tag,
      .excess-tag {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
      }
    }
  }

  .food-groups-card {
    grid-column: 1 / -1;

    .food-groups-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.2rem;
    }

    .food-group-item {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 1.2rem;
      border-left: 4px solid #27ae60;

      .group-header {
        margin-bottom: 0.8rem;

        .group-name {
          font-size: 1.1rem;
          font-weight: 600;
          color: #2c3e50;
          margin-bottom: 0.4rem;
        }

        .group-amount {
          font-size: 1rem;
          font-weight: 600;
          color: #27ae60;

          .amount-range {
            font-size: 0.85rem;
            color: #7f8c8d;
            font-weight: normal;
          }
        }
      }

      .group-examples {
        margin-bottom: 0.8rem;

        .examples-label {
          font-weight: 600;
          color: #34495e;
          margin-bottom: 0.4rem;
          font-size: 0.9rem;
        }

        .examples-list {
          display: flex;
          flex-wrap: wrap;
          gap: 0.4rem;

          .example-tag {
            background: #ecf0f1;
            color: #2c3e50;
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.8rem;
          }
        }
      }

      .nutrition-focus {
        .focus-label {
          font-weight: 600;
          color: #34495e;
          margin-bottom: 0.5rem;
        }

        .focus-list {
          color: #7f8c8d;
          font-size: 0.9rem;
          line-height: 1.5;
        }
      }
    }
  }

  .seasonal-card {
    .seasonal-content {
      .season-info {
        text-align: center;
        margin-bottom: 1.5rem;

        .season-badge {
          display: inline-block;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          padding: 0.6rem 1.5rem;
          border-radius: 20px;
          font-weight: 600;
          font-size: 1rem;
          margin-bottom: 0.8rem;
        }

        .season-benefit {
          color: #7f8c8d;
          font-style: italic;
          font-size: 0.9rem;
        }
      }

      .seasonal-foods {
        margin-bottom: 1.2rem;

        .foods-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(85px, 1fr));
          gap: 0.6rem;

          .food-item {
            background: #f8f9fa;
            padding: 0.6rem 0.4rem;
            border-radius: 8px;
            text-align: center;
            color: #2c3e50;
            font-weight: 500;
            font-size: 0.9rem;
            transition: background 0.3s ease;

            &:hover {
              background: #e9ecef;
            }
          }
        }
      }

      .seasonal-recipes {
        .recipes-list {
          display: grid;
          grid-template-columns: 1fr;
          gap: 0.6rem;

          .recipe-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: #f8f9fa;
            padding: 0.6rem 0.8rem;
            border-radius: 8px;
            transition: background 0.3s ease;
            font-size: 0.85rem;

            &:hover {
              background: #e9ecef;
            }

            .recipe-icon {
              font-size: 1.2rem;
            }

            .recipe-name {
              color: #2c3e50;
              font-weight: 500;
            }
          }
        }
      }
    }
  }

  .tcm-constitution-card {
    .tcm-prompt {
      text-align: center;
      padding: 3rem 2rem;
      background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
      border-radius: 20px;
      border: 2px dashed #ffb74d;

      .prompt-content {
        max-width: 500px;
        margin: 0 auto;

        .prompt-icon {
          font-size: 4rem;
          margin-bottom: 1rem;
          opacity: 0.8;
        }

        .prompt-title {
          font-size: 1.5rem;
          font-weight: 600;
          color: #2c3e50;
          margin-bottom: 1rem;
        }

        .prompt-desc {
          color: #7f8c8d;
          line-height: 1.6;
          margin-bottom: 2rem;
        }

        .start-analysis-btn {
          padding: 1rem 2rem;
          border-radius: 25px;
          font-size: 1.1rem;
          font-weight: 600;
        }
      }
    }

    .tcm-analysis-content {
      .constitution-analysis {
        .constitution-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
          padding: 1.5rem;
          background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
          border-radius: 15px;
          border-left: 4px solid #ff9800;

          .constitution-main {
            flex: 1;

            .constitution-type {
              display: flex;
              align-items: center;
              gap: 1rem;
              margin-bottom: 0.5rem;

              .constitution-name {
                font-size: 1.5rem;
                font-weight: 700;
                color: #e65100;
              }

              .constitution-confidence {
                padding: 0.3rem 1rem;
                background: #4caf50;
                color: white;
                border-radius: 20px;
                font-size: 0.9rem;
                font-weight: 600;
              }
            }

            .secondary-constitution {
              color: #7f8c8d;
              font-size: 0.95rem;
            }
          }

          .health-score {
            .score-circle {
              width: 100px;
              height: 100px;
              border-radius: 50%;
              background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
              color: white;
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;

              .score-value {
                font-size: 1.8rem;
                font-weight: 700;
              }

              .score-label {
                font-size: 0.8rem;
                margin-top: 0.3rem;
              }
            }
          }
        }

        .constitution-characteristics {
          margin-bottom: 2rem;

          .subsection-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
          }

          .characteristics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;

            .characteristic-item {
              display: flex;
              align-items: center;
              gap: 0.8rem;
              padding: 1rem;
              background: #f8f9fa;
              border-radius: 12px;
              border: 1px solid #e9ecef;

              .characteristic-icon {
                color: #4caf50;
                font-weight: 600;
              }

              .characteristic-text {
                color: #2c3e50;
                font-size: 0.95rem;
              }
            }
          }
        }

        .dietary-guidance {
          margin-bottom: 2rem;

          .subsection-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
          }

          .guidance-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;

            .guidance-section {
              .guidance-title {
                font-size: 1rem;
                font-weight: 600;
                color: #2c3e50;
                margin-bottom: 1rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
              }

              .guidance-list {
                .guidance-item {
                  display: flex;
                  align-items: flex-start;
                  gap: 0.8rem;
                  padding: 1rem;
                  margin-bottom: 0.8rem;
                  border-radius: 12px;
                  background: #f8f9fa;
                  border: 1px solid #e9ecef;
                  transition: all 0.3s ease;

                  &:hover {
                    background: #e9ecef;
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                  }

                  .guidance-icon {
                    font-size: 1.2rem;
                    margin-top: 0.1rem;
                    flex-shrink: 0;
                  }

                  .guidance-text {
                    color: #2c3e50;
                    line-height: 1.5;
                    font-size: 0.95rem;
                  }
                }
              }
            }
          }
        }

        .tcm-ai-insights {
          margin-bottom: 2rem;

          .subsection-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
          }

          .insights-list {
            .insight-item {
              display: flex;
              align-items: flex-start;
              gap: 0.8rem;
              padding: 1rem;
              margin-bottom: 0.8rem;
              border-radius: 12px;
              background: linear-gradient(135deg, #e3f2fd 0%, #e8f5e8 100%);
              border: 1px solid #81c784;
              transition: all 0.3s ease;

              &:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
              }

              .insight-icon {
                font-size: 1.2rem;
                margin-top: 0.1rem;
                flex-shrink: 0;
              }

              .insight-text {
                color: #2c3e50;
                line-height: 1.5;
                font-size: 0.95rem;
              }
            }
          }
        }

        .health-warnings {
          margin-bottom: 2rem;

          .subsection-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #e74c3c;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
          }

          .warnings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;

            .warning-item {
              display: flex;
              align-items: center;
              gap: 0.8rem;
              padding: 1rem;
              background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
              border-radius: 12px;
              border: 1px solid #e57373;

              .warning-icon {
                color: #e74c3c;
                font-size: 1.2rem;
              }

              .warning-text {
                color: #2c3e50;
                font-size: 0.95rem;
              }
            }
          }
        }
      }

      .tcm-loading {
        text-align: center;
        padding: 3rem 2rem;

        .loading-content {
          .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ff9800;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
          }

          .loading-text {
            color: #7f8c8d;
            font-size: 1.1rem;
          }
        }
      }

      .tcm-analysis-actions {
        text-align: center;
        padding-top: 2rem;
        border-top: 1px solid #e9ecef;
        display: flex;
        gap: 1rem;
        justify-content: center;
      }
    }
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }
  .tcm-content {
    .constitution-result {
      display: flex;
      gap: 2rem;
      align-items: center;
      margin-bottom: 2rem;

      .constitution-badge {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        color: #d35400;
        padding: 1rem 2rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 1.2rem;
        text-align: center;
        flex-shrink: 0;
      }

      .constitution-chart {
        flex: 1;
        height: 200px;
      }
    }

    .tcm-recommendations {
      margin-bottom: 2rem;

      .tcm-rec-list {
        .tcm-rec-item {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          background: #f8f9fa;
          border-radius: 10px;
          margin-bottom: 0.8rem;

          .tcm-icon {
            font-size: 1.2rem;
          }

          .tcm-text {
            flex: 1;
            color: #2c3e50;
            line-height: 1.5;
          }
        }
      }
    }

    .tcm-warnings {
      .warning-list {
        .warning-item {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          background: #fff3cd;
          border-radius: 10px;
          border-left: 4px solid #f39c12;
          margin-bottom: 0.8rem;

          .warning-icon {
            font-size: 1.2rem;
          }

          .warning-text {
            flex: 1;
            color: #d68910;
            line-height: 1.5;
          }
        }
      }
    }
  }

  .ai-report-card {
    .ai-report-content {
      .report-summary {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-bottom: 2rem;

        .summary-item {
          text-align: center;
          background: #f8f9fa;
          padding: 1.5rem;
          border-radius: 15px;

          .summary-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
          }

          .summary-value {
            font-size: 2rem;
            font-weight: 700;
            color: #3498db;
          }
        }
      }

      .ai-insights {
        margin-bottom: 2rem;

        .insights-list {
          .insight-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 0.8rem;

            .insight-icon {
              font-size: 1.2rem;
            }

            .insight-text {
              flex: 1;
              color: #2c3e50;
              line-height: 1.5;
            }
          }
        }
      }

      .generate-report-btn {
        width: 100%;
        padding: 1rem 2rem;
        border-radius: 25px;
        font-size: 1.1rem;
        font-weight: 600;
      }
    }
  }

  .guidelines-dialog {
    .full-guidelines {
      max-height: 60vh;
      overflow-y: auto;

      .guideline-detail {
        margin-bottom: 2rem;
        padding-bottom: 2rem;
        border-bottom: 1px solid #ecf0f1;

        &:last-child {
          border-bottom: none;
        }

        .detail-title {
          color: #2c3e50;
          font-size: 1.3rem;
          font-weight: 600;
          margin-bottom: 1rem;
        }

        .detail-description {
          color: #7f8c8d;
          line-height: 1.6;
          margin-bottom: 1rem;
        }

        .detail-recommendations {
          li {
            color: #34495e;
            line-height: 1.6;
            margin-bottom: 0.5rem;
          }
        }
      }
    }
  }

  .user-form-dialog {
    .el-dialog__body {
      padding: 0;
    }
  }

  @media (max-width: 768px) {
    .analytics-view {
      padding: 1rem 0;

      .analytics-dashboard {
        grid-template-columns: 1fr;
      }

      .analytics-card {
        padding: 1.5rem;

        .card-title {
          font-size: 1.3rem;
        }
      }

      .nutrition-card {
        .analysis-summary {
          flex-direction: column;
          text-align: center;
        }
      }

      .food-groups-grid {
        grid-template-columns: 1fr !important;
      }

      .tcm-card .constitution-result {
        flex-direction: column;
      }

      .ai-report-card .report-summary {
        grid-template-columns: 1fr;
      }

    // 重构后的营养分析样式 - 增强版
    .nutrition-analysis-redesigned {
      max-width: 1400px;
      margin: 0 auto;
      padding: 1rem;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      
      .analysis-container {
        display: flex;
        flex-direction: column;
        gap: 2rem;
      }

      // 通用卡片样式 - 增强版
      .user-info-card,
      .nutrition-overview-card,
      .chart-card,
      .ai-analysis-card,
      .action-card {
        background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 
          0 10px 40px rgba(0, 0, 0, 0.1),
          0 4px 25px rgba(0, 0, 0, 0.05),
          inset 0 1px 0 rgba(255, 255, 255, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;

        &::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 4px;
          background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
          border-radius: 20px 20px 0 0;
        }

        &:hover {
          transform: translateY(-8px) scale(1.02);
          box-shadow: 
            0 20px 60px rgba(0, 0, 0, 0.15),
            0 8px 40px rgba(0, 0, 0, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.9);
        }

        .card-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
          padding-bottom: 1rem;
          border-bottom: 3px solid transparent;
          background: linear-gradient(90deg, #e3f2fd, #f3e5f5) padding-box,
                      linear-gradient(90deg, #2196f3, #9c27b0) border-box;
          border-radius: 10px;

          .card-title {
            font-size: 1.4rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          }
        }
      }

      // 顶部区域增强
      .top-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;

        @media (max-width: 768px) {
          grid-template-columns: 1fr;
          gap: 1.5rem;
        }
      }

      // 用户信息卡片增强 - 参考食物分组样式
      .user-info-card {
        &::before {
          background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
        }

        .edit-btn {
          border-radius: 20px;
          font-size: 0.875rem;
          padding: 0.6rem 1.2rem;
          background: #3498db;
          border: none;
          color: white;
          font-weight: 600;
          transition: all 0.3s ease;

          &:hover {
            background: #2980b9;
            transform: translateY(-1px);
          }
        }

        .user-details {
          display: flex;
          flex-direction: column;
          gap: 1rem;

          .detail-row {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            transition: all 0.3s ease;

            &:nth-child(2) {
              border-left-color: #27ae60;
            }

            &:nth-child(3) {
              border-left-color: #f39c12;
            }

            &:hover {
              background: #ffffff;
              transform: translateX(4px);
            }

            .label {
              font-weight: 600;
              color: #34495e;
              min-width: 70px;
              font-size: 0.9rem;
            }

            .value {
              font-weight: 600;
              color: #2c3e50;
              flex: 1;
              font-size: 1rem;
            }

            .status-badge {
              padding: 0.3rem 0.8rem;
              border-radius: 15px;
              font-size: 0.8rem;
              font-weight: 600;

              &.normal {
                background: #d4edda;
                color: #155724;
              }

              &.overweight {
                background: #fff3cd;
                color: #856404;
              }

              &.obese {
                background: #f8d7da;
                color: #721c24;
              }

              &.underweight {
                background: #cce7ff;
                color: #004085;
              }
            }
          }
        }
      }

      // 营养概览卡片增强
      .nutrition-overview-card {
        &::before {
          background: linear-gradient(90deg, #a8edea 0%, #fed6e3 100%);
        }

        .confidence-score {
          display: flex;
          align-items: center;
          gap: 1rem;

          .score-circle {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            color: white;
            box-shadow: 
              0 8px 32px rgba(102, 126, 234, 0.3),
              inset 0 2px 8px rgba(255, 255, 255, 0.2);
            position: relative;

            &::before {
              content: '';
              position: absolute;
              top: -4px;
              left: -4px;
              right: -4px;
              bottom: -4px;
              background: linear-gradient(135deg, #667eea, #764ba2, #f093fb, #f5576c);
              border-radius: 50%;
              z-index: -1;
              animation: rotate 3s linear infinite;
            }

            .score-number {
              font-size: 1.5rem;
              font-weight: 800;
              line-height: 1;
            }

            .score-unit {
              font-size: 0.8rem;
              opacity: 0.9;
              font-weight: 600;
            }
          }

          .score-label {
            font-size: 1rem;
            font-weight: 600;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
          }
        }

        .nutrition-data {
          .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.2rem;

            .data-item {
              display: flex;
              flex-direction: column;
              gap: 0.8rem;
              padding: 1.2rem;
              background: #f8f9fa;
              border-radius: 12px;
              border-left: 4px solid #27ae60;
              transition: all 0.3s ease;
              position: relative;

              &:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
                background: #ffffff;
              }

              &:nth-child(1) {
                border-left-color: #3498db;
              }

              &:nth-child(2) {
                border-left-color: #27ae60;
              }

              &:nth-child(3) {
                border-left-color: #e74c3c;
              }

              &:nth-child(4) {
                border-left-color: #f39c12;
              }

              .data-label {
                font-size: 0.9rem;
                color: #34495e;
                font-weight: 600;
                margin-bottom: 0.4rem;
              }

              .data-value {
                font-size: 1.25rem;
                font-weight: 700;
                color: #2c3e50;

                &.highlight {
                  color: #3498db;
                }
              }
            }
          }
        }
      }

      // 中间区域增强 - 改为单列布局
      .middle-section {
        margin-bottom: 2rem;
        display: flex;
        justify-content: center;

        .chart-card {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          border-radius: 16px;
          box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
          padding: 1.5rem;
          backdrop-filter: blur(10px);
          border: 1px solid rgba(255, 255, 255, 0.1);
          max-width: 600px;
          width: 100%;

          .card-header {
            margin-bottom: 1rem;
            .card-title {
              color: white;
              font-size: 1.5rem;
              font-weight: 600;
              margin: 0;
              text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            }
          }
        }

        @media (max-width: 968px) {
          .chart-card {
            max-width: 100%;
          }
        }
      }

      // AI分析区域 - 独立的全宽度区域
      .ai-analysis-section {
        margin-bottom: 2rem;

        .ai-analysis-card {
          background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
          border-radius: 16px;
          box-shadow: 0 8px 32px rgba(240, 147, 251, 0.3);
          padding: 1.5rem;
          backdrop-filter: blur(10px);
          border: 1px solid rgba(255, 255, 255, 0.1);

          .card-header {
            margin-bottom: 1.5rem;
            .card-title {
              color: white;
              font-size: 1.5rem;
              font-weight: 600;
              margin: 0;
              text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            }
          }

          .ai-modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            align-items: start;
          }

          .ai-module {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;

            &:hover {
              transform: translateY(-4px);
              box-shadow: 0 8px 40px rgba(0, 0, 0, 0.15);
            }

            // 主题颜色定义 - 8种不同的颜色主题
            &.theme-green {
              border-top: 4px solid #27ae60;
              .module-header {
                background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
                .module-title { color: #27ae60; }
                .module-badge { 
                  background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
                  color: white;
                }
              }
              &:hover {
                box-shadow: 0 8px 40px rgba(39, 174, 96, 0.2);
              }
            }

            &.theme-blue {
              border-top: 4px solid #3498db;
              .module-header {
                background: linear-gradient(135deg, #e3f2fd 0%, #d1ecf1 100%);
                .module-title { color: #3498db; }
                .module-badge { 
                  background: linear-gradient(135deg, #3498db 0%, #74b9ff 100%);
                  color: white;
                }
              }
              &:hover {
                box-shadow: 0 8px 40px rgba(52, 152, 219, 0.2);
              }
            }

            &.theme-orange {
              border-top: 4px solid #e67e22;
              .module-header {
                background: linear-gradient(135deg, #fff3e0 0%, #ffeaa7 100%);
                .module-title { color: #e67e22; }
                .module-badge { 
                  background: linear-gradient(135deg, #e67e22 0%, #f39c12 100%);
                  color: white;
                }
              }
              &:hover {
                box-shadow: 0 8px 40px rgba(230, 126, 34, 0.2);
              }
            }

            &.theme-purple {
              border-top: 4px solid #9b59b6;
              .module-header {
                background: linear-gradient(135deg, #f3e5f5 0%, #e8d5e8 100%);
                .module-title { color: #9b59b6; }
                .module-badge { 
                  background: linear-gradient(135deg, #9b59b6 0%, #a29bfe 100%);
                  color: white;
                }
              }
              &:hover {
                box-shadow: 0 8px 40px rgba(155, 89, 182, 0.2);
              }
            }

            &.theme-cyan {
              border-top: 4px solid #1abc9c;
              .module-header {
                background: linear-gradient(135deg, #e0f2f1 0%, #b2dfdb 100%);
                .module-title { color: #1abc9c; }
                .module-badge { 
                  background: linear-gradient(135deg, #1abc9c 0%, #00cec9 100%);
                  color: white;
                }
              }
              &:hover {
                box-shadow: 0 8px 40px rgba(26, 188, 156, 0.2);
              }
            }

            &.theme-pink {
              border-top: 4px solid #e91e63;
              .module-header {
                background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%);
                .module-title { color: #e91e63; }
                .module-badge { 
                  background: linear-gradient(135deg, #e91e63 0%, #fd79a8 100%);
                  color: white;
                }
              }
              &:hover {
                box-shadow: 0 8px 40px rgba(233, 30, 99, 0.2);
              }
            }

            &.theme-indigo {
              border-top: 4px solid #6c5ce7;
              .module-header {
                background: linear-gradient(135deg, #e8eaf6 0%, #ddd6fe 100%);
                .module-title { color: #6c5ce7; }
                .module-badge { 
                  background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
                  color: white;
                }
              }
              &:hover {
                box-shadow: 0 8px 40px rgba(108, 92, 231, 0.2);
              }
            }

            &.theme-yellow {
              border-top: 4px solid #f39c12;
              .module-header {
                background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
                .module-title { color: #f39c12; }
                .module-badge { 
                  background: linear-gradient(135deg, #f39c12 0%, #fdcb6e 100%);
                  color: white;
                }
              }
              &:hover {
                box-shadow: 0 8px 40px rgba(243, 156, 18, 0.2);
              }
            }

            .module-header {
              padding: 1rem 1.5rem;
              border-bottom: 1px solid rgba(0, 0, 0, 0.05);
              display: flex;
              align-items: center;
              gap: 0.75rem;
              position: relative;

              .module-icon {
                font-size: 1.5rem;
                flex-shrink: 0;
              }

              .module-title {
                font-size: 1.1rem;
                font-weight: 600;
                margin: 0;
                flex: 1;
              }

              .module-badge {
                padding: 0.4rem 0.8rem;
                border-radius: 20px;
                font-size: 0.75rem;
                font-weight: 600;
                color: white;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                backdrop-filter: blur(4px);
                transition: all 0.3s ease;

                &:hover {
                  transform: scale(1.05);
                  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
                }

                &.warning {
                  background: linear-gradient(135deg, #e67e22 0%, #f39c12 100%);
                }

                &.success {
                  background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
                }

                &.info {
                  background: linear-gradient(135deg, #3498db 0%, #74b9ff 100%);
                }
              }
            }

            .module-content {
              padding: 1.5rem;

              // 通用列表样式
              .recommendations-list,
              .insights-list,
              .risks-list,
              .improvements-list {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;

                .recommendation-item,
                .insight-item,
                .risk-item,
                .improvement-item {
                  display: flex;
                  align-items: flex-start;
                  gap: 0.75rem;
                  padding: 0.75rem;
                  background: rgba(255, 255, 255, 0.8);
                  border-radius: 8px;
                  border-left: 4px solid #667eea;
                  transition: all 0.3s ease;
                  position: relative;
                  overflow: hidden;

                  &::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
                    opacity: 0;
                    transition: opacity 0.3s ease;
                  }

                  &:hover {
                    background: rgba(255, 255, 255, 0.95);
                    transform: translateX(4px) translateY(-2px);
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                    
                    &::before {
                      opacity: 1;
                    }
                  }

                  .item-icon {
                    font-size: 1.1rem;
                    margin-top: 0.1rem;
                    flex-shrink: 0;
                    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
                  }

                  .item-text {
                    flex: 1;
                    font-size: 0.9rem;
                    line-height: 1.5;
                    color: #2c3e50;
                    font-weight: 500;
                  }
                }

                .risk-item {
                  border-left-color: #e74c3c;
                  background: rgba(231, 76, 60, 0.05);
                  
                  &:hover {
                    background: rgba(231, 76, 60, 0.1);
                    border-left-color: #c0392b;
                  }
                }

                .improvement-item {
                  border-left-color: #27ae60;
                  background: rgba(39, 174, 96, 0.05);
                  
                  &:hover {
                    background: rgba(39, 174, 96, 0.1);
                    border-left-color: #229954;
                  }
                }

                .insight-item {
                  border-left-color: #f39c12;
                  background: rgba(243, 156, 18, 0.05);
                  
                  &:hover {
                    background: rgba(243, 156, 18, 0.1);
                    border-left-color: #e67e22;
                  }
                }

                .recommendation-item {
                  border-left-color: #27ae60;
                  background: rgba(39, 174, 96, 0.05);
                  
                  &:hover {
                    background: rgba(39, 174, 96, 0.1);
                    border-left-color: #229954;
                  }
                }
              }

              // 营养状态监测特殊样式
              .status-metrics {
                display: flex;
                flex-direction: column;
                gap: 1rem;

                .metric-item {
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  padding: 1rem;
                  background: linear-gradient(135deg, rgba(26, 188, 156, 0.08) 0%, rgba(26, 188, 156, 0.12) 100%);
                  border-radius: 12px;
                  border-left: 4px solid #1abc9c;
                  border: 1px solid rgba(26, 188, 156, 0.1);
                  transition: all 0.3s ease;
                  position: relative;
                  overflow: hidden;

                  &::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 2px;
                    background: linear-gradient(90deg, #1abc9c, #16a085, #1abc9c);
                    opacity: 0;
                    transition: opacity 0.3s ease;
                  }

                  &:hover {
                    background: linear-gradient(135deg, rgba(26, 188, 156, 0.15) 0%, rgba(26, 188, 156, 0.2) 100%);
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(26, 188, 156, 0.2);
                    
                    &::before {
                      opacity: 1;
                    }
                  }

                  .metric-label {
                    font-size: 0.9rem;
                    color: #2c3e50;
                    font-weight: 500;
                  }

                  .metric-value {
                    font-size: 1.1rem;
                    font-weight: 700;
                    color: #1abc9c;
                    text-shadow: 0 1px 2px rgba(26, 188, 156, 0.2);
                  }
                }
              }

              // 膳食搭配优化样式
              .optimization-suggestions {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;

                .suggestion-item {
                  display: flex;
                  align-items: flex-start;
                  gap: 0.75rem;
                  padding: 0.75rem;
                  background: linear-gradient(135deg, rgba(233, 30, 99, 0.05) 0%, rgba(233, 30, 99, 0.08) 100%);
                  border-radius: 8px;
                  border-left: 4px solid #e91e63;
                  transition: all 0.3s ease;
                  position: relative;
                  overflow: hidden;

                  &::after {
                    content: '→';
                    position: absolute;
                    top: 50%;
                    right: 1rem;
                    transform: translateY(-50%);
                    font-size: 1.2rem;
                    color: #e91e63;
                    opacity: 0;
                    transition: all 0.3s ease;
                  }

                  &:hover {
                    background: linear-gradient(135deg, rgba(233, 30, 99, 0.12) 0%, rgba(233, 30, 99, 0.16) 100%);
                    transform: translateX(4px) translateY(-2px);
                    box-shadow: 0 4px 12px rgba(233, 30, 99, 0.2);
                    
                    &::after {
                      opacity: 1;
                      transform: translateY(-50%) translateX(4px);
                    }
                  }

                  .suggestion-icon {
                    font-size: 1.5rem;
                    flex-shrink: 0;
                    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
                  }

                  .suggestion-text {
                    flex: 1;
                    font-size: 0.9rem;
                    line-height: 1.5;
                    color: #2c3e50;
                    font-weight: 500;
                  }
                }
              }

              // 健康趋势分析样式
              .trend-items {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;

                .trend-item {
                  display: flex;
                  align-items: flex-start;
                  gap: 0.75rem;
                  padding: 0.75rem;
                  border-radius: 8px;
                  border-left: 4px solid #6c5ce7;
                  transition: all 0.3s ease;
                  position: relative;
                  overflow: hidden;

                  &.positive {
                    background: linear-gradient(135deg, rgba(39, 174, 96, 0.05) 0%, rgba(39, 174, 96, 0.08) 100%);
                    border-left-color: #27ae60;
                    
                    &:hover {
                      background: linear-gradient(135deg, rgba(39, 174, 96, 0.12) 0%, rgba(39, 174, 96, 0.16) 100%);
                    }
                  }

                  &.stable {
                    background: linear-gradient(135deg, rgba(52, 152, 219, 0.05) 0%, rgba(52, 152, 219, 0.08) 100%);
                    border-left-color: #3498db;
                    
                    &:hover {
                      background: linear-gradient(135deg, rgba(52, 152, 219, 0.12) 0%, rgba(52, 152, 219, 0.16) 100%);
                    }
                  }

                  &.attention {
                    background: linear-gradient(135deg, rgba(243, 156, 18, 0.05) 0%, rgba(243, 156, 18, 0.08) 100%);
                    border-left-color: #f39c12;
                    
                    &:hover {
                      background: linear-gradient(135deg, rgba(243, 156, 18, 0.12) 0%, rgba(243, 156, 18, 0.16) 100%);
                    }
                  }

                  &:hover {
                    transform: translateX(4px) translateY(-2px);
                    box-shadow: 0 4px 12px rgba(108, 92, 231, 0.2);
                  }

                  .trend-icon {
                    font-size: 1.2rem;
                    flex-shrink: 0;
                    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
                  }

                  .trend-text {
                    flex: 1;
                    font-size: 0.9rem;
                    line-height: 1.5;
                    color: #2c3e50;
                    font-weight: 500;
                  }
                }
              }
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(26, 188, 156, 0.2);
                    background: linear-gradient(135deg, rgba(26, 188, 156, 0.12) 0%, rgba(26, 188, 156, 0.16) 100%);
                    
                    &::before {
                      opacity: 1;
                    }
                  }

                  .metric-label {
                    font-size: 0.9rem;
                    color: #2c3e50;
                    font-weight: 600;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;

                    &::before {
                      content: '📊';
                      font-size: 1rem;
                    }
                  }

                  .metric-value {
                    font-size: 1.1rem;
                    font-weight: 700;
                    color: #1abc9c;
                    background: linear-gradient(135deg, #1abc9c, #16a085);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                    text-shadow: 0 1px 2px rgba(26, 188, 156, 0.2);
                  }
                }
              }

              // 膳食搭配优化样式
              .optimization-suggestions {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;

                .suggestion-item {
                  display: flex;
                  align-items: flex-start;
                  gap: 0.75rem;
                  padding: 1rem;
                  background: linear-gradient(135deg, rgba(233, 30, 99, 0.08) 0%, rgba(233, 30, 99, 0.12) 100%);
                  border-radius: 12px;
                  border-left: 4px solid #e91e63;
                  border: 1px solid rgba(233, 30, 99, 0.1);
                  transition: all 0.3s ease;
                  position: relative;

                  &::after {
                    content: '';
                    position: absolute;
                    top: 50%;
                    right: 1rem;
                    transform: translateY(-50%);
                    width: 6px;
                    height: 6px;
                    background: #e91e63;
                    border-radius: 50%;
                    opacity: 0;
                    transition: all 0.3s ease;
                  }

                  &:hover {
                    transform: translateX(4px) translateY(-2px);
                    box-shadow: 0 4px 12px rgba(233, 30, 99, 0.2);
                    background: linear-gradient(135deg, rgba(233, 30, 99, 0.12) 0%, rgba(233, 30, 99, 0.16) 100%);
                    
                    &::after {
                      opacity: 1;
                      transform: translateY(-50%) scale(1.2);
                    }
                  }

                  .suggestion-icon {
                    font-size: 1.2rem;
                    flex-shrink: 0;
                    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
                  }

                  .suggestion-text {
                    flex: 1;
                    font-size: 0.9rem;
                    line-height: 1.5;
                    color: #2c3e50;
                    font-weight: 500;
                  }
                }
              }

              // 健康趋势分析样式
              .trend-items {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;

                .trend-item {
                  display: flex;
                  align-items: flex-start;
                  gap: 0.75rem;
                  padding: 1rem;
                  border-radius: 12px;
                  border-left: 4px solid #3f51b5;
                  transition: all 0.3s ease;
                  position: relative;
                  overflow: hidden;

                  &::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                  }

                  &:hover {
                    transform: translateY(-2px);
                    
                    &::before {
                      opacity: 1;
                    }
                  }

                  &.positive {
                    background: linear-gradient(135deg, rgba(76, 175, 80, 0.08) 0%, rgba(76, 175, 80, 0.12) 100%);
                    border-left-color: #4caf50;
                    border: 1px solid rgba(76, 175, 80, 0.1);
                    
                    &:hover {
                      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
                      background: linear-gradient(135deg, rgba(76, 175, 80, 0.12) 0%, rgba(76, 175, 80, 0.16) 100%);
                    }
                  }

                  &.stable {
                    background: linear-gradient(135deg, rgba(108, 92, 231, 0.08) 0%, rgba(108, 92, 231, 0.12) 100%);
                    border-left-color: #6c5ce7;
                    border: 1px solid rgba(108, 92, 231, 0.1);
                    
                    &:hover {
                      box-shadow: 0 4px 12px rgba(108, 92, 231, 0.2);
                      background: linear-gradient(135deg, rgba(108, 92, 231, 0.12) 0%, rgba(108, 92, 231, 0.16) 100%);
                    }
                  }

                  &.attention {
                    background: linear-gradient(135deg, rgba(255, 152, 0, 0.08) 0%, rgba(255, 152, 0, 0.12) 100%);
                    border-left-color: #ff9800;
                    border: 1px solid rgba(255, 152, 0, 0.1);
                    
                    &:hover {
                      box-shadow: 0 4px 12px rgba(255, 152, 0, 0.2);
                      background: linear-gradient(135deg, rgba(255, 152, 0, 0.12) 0%, rgba(255, 152, 0, 0.16) 100%);
                    }
                  }

                  .trend-icon {
                    font-size: 1.2rem;
                    flex-shrink: 0;
                    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
                  }

                  .trend-text {
                    flex: 1;
                    font-size: 0.9rem;
                    line-height: 1.5;
                    color: #2c3e50;
                    font-weight: 500;
                  }
                }
              }

              // 个性化食谱推荐样式
              .recipe-suggestions {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;

                .recipe-item {
                  display: flex;
                  align-items: center;
                  gap: 1rem;
                  padding: 1rem;
                  background: linear-gradient(135deg, rgba(243, 156, 18, 0.08) 0%, rgba(243, 156, 18, 0.12) 100%);
                  border-radius: 12px;
                  border-left: 4px solid #f39c12;
                  border: 1px solid rgba(243, 156, 18, 0.1);
                  transition: all 0.3s ease;
                  position: relative;

                  &::after {
                    content: '→';
                    position: absolute;
                    top: 50%;
                    right: 1rem;
                    transform: translateY(-50%);
                    font-size: 1.2rem;
                    color: #f39c12;
                    opacity: 0;
                    transition: all 0.3s ease;
                  }

                  &:hover {
                    background: linear-gradient(135deg, rgba(243, 156, 18, 0.12) 0%, rgba(243, 156, 18, 0.16) 100%);
                    transform: translateX(4px) translateY(-2px);
                    box-shadow: 0 4px 12px rgba(243, 156, 18, 0.2);
                    
                    &::after {
                      opacity: 1;
                      transform: translateY(-50%) translateX(4px);
                    }
                  }

                  .recipe-icon {
                    font-size: 1.5rem;
                    flex-shrink: 0;
                    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
                  }

                  .recipe-info {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    gap: 0.25rem;

                    .recipe-name {
                      font-size: 1rem;
                      font-weight: 600;
                      color: #2c3e50;
                      margin-bottom: 0.25rem;
                    }

                    .recipe-desc {
                      font-size: 0.85rem;
                      color: #7f8c8d;
                      font-weight: 500;
                    }
                  }
                }
              }
            }
          }
        }

        // 图表卡片增强
        .chart-card {
        .chart-container {
          display: flex;
          justify-content: center;
          align-items: center;
          min-height: 400px;
          background: radial-gradient(circle at center, rgba(102, 126, 234, 0.05) 0%, transparent 70%);
          border-radius: 15px;

          .nutrition-chart {
            max-width: 100%;
            height: auto;
            filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.1));
          }
        }
      }

      // 底部操作区域增强
      .bottom-section {
        .action-card {
          text-align: center;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          
          &::before {
            background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
          }
          
          .regenerate-btn {
            padding: 1rem 3rem;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 50px;
            min-width: 250px;
            height: 60px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            color: #667eea;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
              0 8px 32px rgba(0, 0, 0, 0.2),
              inset 0 2px 8px rgba(255, 255, 255, 0.3);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);

            &:hover {
              transform: translateY(-4px) scale(1.05);
              box-shadow: 
                0 15px 50px rgba(0, 0, 0, 0.3),
                inset 0 2px 8px rgba(255, 255, 255, 0.4);
              background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            }

            &:active {
              transform: translateY(-2px) scale(1.02);
            }
          }
        }

        // 响应式设计增强
        @media (max-width: 768px) {
          .nutrition-analysis-redesigned {
            padding: 1rem;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);

            .analysis-container {
              gap: 1.5rem;
            }

            .user-info-card,
            .nutrition-overview-card,
            .chart-card,
            .ai-analysis-card,
            .action-card {
              padding: 1.5rem;
              border-radius: 16px;
            }

            .ai-analysis-section {
              .ai-modules-grid {
                gap: 1.5rem;
                grid-template-columns: 1fr;
              }

              .ai-module {
                padding: 1.5rem;
              }
            }
          }
        }

      // 动画效果
      @keyframes rotate {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @keyframes float {
        0%, 100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      // 为一些元素添加浮动动画
      .chart-card {
        animation: float 6s ease-in-out infinite;
      }

      .user-info-card {
        animation: float 6s ease-in-out infinite 1s;
      }

      .nutrition-overview-card {
        animation: float 6s ease-in-out infinite 2s;
      }
    }

    // 四模块营养分析样式
    .nutrition-analysis-modules {
      max-width: 1400px;
      margin: 0 auto;
      padding: 1rem;
      
      .modules-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
      }

      .analysis-module {
        background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 
          0 10px 40px rgba(0, 0, 0, 0.08),
          0 4px 25px rgba(0, 0, 0, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;

        &::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 4px;
          background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
          border-radius: 20px 20px 0 0;
        }

        &:hover {
          transform: translateY(-5px);
          box-shadow: 
            0 20px 60px rgba(0, 0, 0, 0.12),
            0 8px 40px rgba(0, 0, 0, 0.08);
        }

        .module-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
          padding-bottom: 1rem;
          border-bottom: 2px solid #f1f3f4;

          .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;

            .module-icon {
              font-size: 2rem;
              width: 60px;
              height: 60px;
              display: flex;
              align-items: center;
              justify-content: center;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              border-radius: 15px;
              color: white;
              box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            }

            .module-title {
              font-size: 1.5rem;
              font-weight: 700;
              color: #2c3e50;
              margin: 0;
            }
          }

          .edit-btn, .confidence-score, .balance-score, .ai-badge {
            .score-circle {
              display: flex;
              flex-direction: column;
              align-items: center;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              padding: 0.8rem;
              border-radius: 12px;
              min-width: 60px;

              .score-number {
                font-size: 1.2rem;
                font-weight: bold;
              }

              .score-unit {
                font-size: 0.8rem;
                opacity: 0.9;
              }
            }

            .score-label {
              font-size: 0.9rem;
              color: #7f8c8d;
              margin-top: 0.5rem;
            }

            .score-value {
              font-size: 1.2rem;
              font-weight: bold;
              color: #667eea;
            }

            .badge-text {
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              padding: 0.5rem 1rem;
              border-radius: 20px;
              font-size: 0.9rem;
              font-weight: 600;
            }
          }
        }

        .module-content {
          color: #2c3e50;
        }

        // 个人信息模块样式
        &.personal-info-module {
          &::before {
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
          }

          .module-icon {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%) !important;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3) !important;
          }

          .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;

            .info-item {
              display: flex;
              align-items: center;
              gap: 1rem;
              padding: 1.5rem;
              background: linear-gradient(135deg, rgba(79, 172, 254, 0.05) 0%, rgba(0, 242, 254, 0.05) 100%);
              border-radius: 15px;
              border: 1px solid rgba(79, 172, 254, 0.1);
              transition: all 0.3s ease;

              &:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(79, 172, 254, 0.15);
                background: linear-gradient(135deg, rgba(79, 172, 254, 0.08) 0%, rgba(0, 242, 254, 0.08) 100%);
              }

              .info-icon {
                font-size: 1.8rem;
                width: 50px;
                height: 50px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                border-radius: 12px;
                color: white;
                box-shadow: 0 4px 12px rgba(79, 172, 254, 0.3);
              }

              .info-details {
                flex: 1;

                .info-label {
                  display: block;
                  font-size: 0.9rem;
                  color: #7f8c8d;
                  margin-bottom: 0.5rem;
                }

                .info-value {
                  font-size: 1.1rem;
                  font-weight: 600;
                  color: #2c3e50;

                  .status-badge {
                    margin-left: 0.5rem;
                    padding: 0.3rem 0.8rem;
                    border-radius: 15px;
                    font-size: 0.8rem;
                    font-weight: 500;

                    &.normal {
                      background: #d4edda;
                      color: #155724;
                    }

                    &.underweight {
                      background: #fff3cd;
                      color: #856404;
                    }

                    &.overweight, &.obese {
                      background: #f8d7da;
                      color: #721c24;
                    }
                  }
                }
              }
            }
          }
        }

        // 营养概览模块样式
        &.nutrition-overview-module {
          &::before {
            background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);
          }

          .module-icon {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%) !important;
            box-shadow: 0 4px 15px rgba(67, 233, 123, 0.3) !important;
          }

          .nutrition-overview-grid {
            display: grid;
            gap: 2rem;

            .nutrition-category {
              background: linear-gradient(135deg, rgba(67, 233, 123, 0.05) 0%, rgba(56, 249, 215, 0.05) 100%);
              border-radius: 15px;
              padding: 1.5rem;
              border: 1px solid rgba(67, 233, 123, 0.1);

              .category-title {
                font-size: 1.2rem;
                font-weight: 600;
                color: #2c3e50;
                margin-bottom: 1rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
              }

              .nutrition-comparison {
                display: grid;
                grid-template-columns: 1fr auto 1fr auto;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
                background: white;
                border-radius: 12px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);

                .comparison-item {
                  text-align: center;

                  .item-label {
                    display: block;
                    font-size: 0.9rem;
                    color: #7f8c8d;
                    margin-bottom: 0.5rem;
                  }

                  .item-value {
                    display: block;
                    font-size: 1.3rem;
                    font-weight: bold;
                    color: #2c3e50;
                  }

                  .item-unit {
                    font-size: 0.9rem;
                    color: #7f8c8d;
                    margin-left: 0.2rem;
                  }

                  &.needs {
                    color: #43e97b;
                  }

                  &.current {
                    color: #38f9d7;
                  }
                }

                .comparison-arrow {
                  font-size: 1.5rem;
                  color: #43e97b;
                  font-weight: bold;
                }

                .comparison-status {
                  .status-indicator {
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-size: 0.9rem;
                    font-weight: 600;

                    &.low {
                      background: #fff3cd;
                      color: #856404;
                    }

                    &.normal {
                      background: #d4edda;
                      color: #155724;
                    }

                    &.high {
                      background: #f8d7da;
                      color: #721c24;
                    }
                  }
                }
              }

              .macronutrients-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;

                .macro-item {
                  background: white;
                  border-radius: 12px;
                  padding: 1rem;
                  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
                  transition: all 0.3s ease;

                  &:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
                  }

                  .macro-icon {
                    font-size: 2rem;
                    margin-bottom: 0.5rem;
                  }

                  .macro-details {
                    .macro-name {
                      display: block;
                      font-weight: 600;
                      color: #2c3e50;
                      margin-bottom: 0.5rem;
                    }

                    .macro-values {
                      display: flex;
                      align-items: center;
                      gap: 0.5rem;
                      margin-bottom: 0.8rem;

                      .current {
                        font-size: 1.2rem;
                        font-weight: bold;
                        color: #43e97b;
                      }

                      .divider {
                        color: #bdc3c7;
                      }

                      .needed {
                        color: #7f8c8d;
                      }
                    }

                    .macro-progress {
                      .progress-bar {
                        width: 100%;
                        height: 6px;
                        background: #ecf0f1;
                        border-radius: 3px;
                        overflow: hidden;

                        .progress-fill {
                          height: 100%;
                          background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);
                          border-radius: 3px;
                          transition: width 0.5s ease;
                        }
                      }
                    }
                  }
                }
              }

              .vitamins-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 1rem;

                .vitamin-item {
                  background: white;
                  border-radius: 12px;
                  padding: 1rem;
                  text-align: center;
                  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
                  transition: all 0.3s ease;

                  &:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
                  }

                  .vitamin-icon {
                    font-size: 1.5rem;
                    margin-bottom: 0.5rem;
                  }

                  .vitamin-name {
                    display: block;
                    font-size: 0.9rem;
                    color: #7f8c8d;
                    margin-bottom: 0.3rem;
                  }

                  .vitamin-value {
                    font-size: 1.1rem;
                    font-weight: bold;
                    color: #43e97b;
                  }
                }
              }
            }
          }
        }

        // 营养平衡分析模块样式
        &.nutrition-balance-module {
          &::before {
            background: linear-gradient(90deg, #fa709a 0%, #fee140 100%);
          }

          .module-icon {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%) !important;
            box-shadow: 0 4px 15px rgba(250, 112, 154, 0.3) !important;
          }

          .balance-analysis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;

            @media (max-width: 768px) {
              grid-template-columns: 1fr;
            }

            .chart-section {
              background: linear-gradient(135deg, rgba(250, 112, 154, 0.05) 0%, rgba(254, 225, 64, 0.05) 100%);
              border-radius: 15px;
              padding: 2rem;
              border: 1px solid rgba(250, 112, 154, 0.1);
              text-align: center;

              .chart-container {
                width: 100%;
                height: 300px;
                margin-bottom: 1rem;

                .nutrition-chart {
                  max-width: 100%;
                  max-height: 100%;
                }
              }

              .chart-legend {
                display: flex;
                justify-content: center;
                gap: 2rem;

                .legend-item {
                  display: flex;
                  align-items: center;
                  gap: 0.5rem;

                  .legend-color {
                    width: 16px;
                    height: 16px;
                    border-radius: 50%;

                    &.current {
                      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
                    }

                    &.recommended {
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    }
                  }

                  .legend-text {
                    font-size: 0.9rem;
                    color: #7f8c8d;
                  }
                }
              }
            }

            .nutrients-analysis {
              .analysis-title {
                font-size: 1.2rem;
                font-weight: 600;
                color: #2c3e50;
                margin-bottom: 1.5rem;
              }

              .nutrients-list {
                display: flex;
                flex-direction: column;
                gap: 1rem;

                .nutrient-item {
                  display: flex;
                  align-items: center;
                  gap: 1rem;
                  padding: 1rem;
                  border-radius: 12px;
                  transition: all 0.3s ease;

                  &:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                  }

                  .nutrient-status {
                    font-size: 1.5rem;
                    width: 40px;
                    text-align: center;
                  }

                  .nutrient-info {
                    flex: 1;

                    .nutrient-name {
                      display: block;
                      font-weight: 600;
                      color: #2c3e50;
                      margin-bottom: 0.3rem;
                    }

                    .nutrient-desc {
                      font-size: 0.9rem;
                      color: #7f8c8d;
                    }
                  }

                  &.excellent {
                    background: linear-gradient(135deg, rgba(76, 175, 80, 0.08) 0%, rgba(76, 175, 80, 0.12) 100%);
                    border: 1px solid rgba(76, 175, 80, 0.2);
                  }

                  &.good {
                    background: linear-gradient(135deg, rgba(33, 150, 243, 0.08) 0%, rgba(33, 150, 243, 0.12) 100%);
                    border: 1px solid rgba(33, 150, 243, 0.2);
                  }

                  &.attention {
                    background: linear-gradient(135deg, rgba(255, 152, 0, 0.08) 0%, rgba(255, 152, 0, 0.12) 100%);
                    border: 1px solid rgba(255, 152, 0, 0.2);
                  }

                  &.warning {
                    background: linear-gradient(135deg, rgba(244, 67, 54, 0.08) 0%, rgba(244, 67, 54, 0.12) 100%);
                    border: 1px solid rgba(244, 67, 54, 0.2);
                  }
                }
              }
            }
          }
        }

        // AI智能分析模块样式
        &.ai-analysis-module {
          &::before {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
          }

          .module-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3) !important;
          }

          .ai-analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;

            .ai-section {
              background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
              border-radius: 15px;
              padding: 1.5rem;
              border: 1px solid rgba(102, 126, 234, 0.1);
              transition: all 0.3s ease;

              &:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
              }

              .section-title {
                font-size: 1.1rem;
                font-weight: 600;
                color: #2c3e50;
                margin-bottom: 1.5rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;

                .title-icon {
                  font-size: 1.3rem;
                }
              }

              // 个性化建议样式
              &.recommendations {
                .recommendations-list {
                  display: flex;
                  flex-direction: column;
                  gap: 1rem;

                  .recommendation-item {
                    display: flex;
                    align-items: flex-start;
                    gap: 1rem;
                    padding: 1rem;
                    background: white;
                    border-radius: 12px;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
                    transition: all 0.3s ease;

                    &:hover {
                      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
                      transform: translateY(-2px);
                    }

                    .item-marker {
                      width: 30px;
                      height: 30px;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      color: white;
                      border-radius: 50%;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      font-weight: bold;
                      font-size: 0.9rem;
                      flex-shrink: 0;
                    }

                    .item-content {
                      flex: 1;
                      font-size: 0.95rem;
                      line-height: 1.5;
                      color: #2c3e50;
                    }
                  }
                }
              }

              // 健康风险评估样式
              &.risks {
                .risks-list {
                  display: flex;
                  flex-direction: column;
                  gap: 1rem;

                  .risk-item {
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                    padding: 1rem;
                    border-radius: 12px;
                    transition: all 0.3s ease;

                    &:hover {
                      transform: translateY(-2px);
                      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                    }

                    .risk-level {
                      font-size: 1.5rem;
                      width: 40px;
                      text-align: center;
                    }

                    .risk-content {
                      flex: 1;

                      .risk-title {
                        display: block;
                        font-weight: 600;
                        color: #2c3e50;
                        margin-bottom: 0.3rem;
                      }

                      .risk-desc {
                        font-size: 0.9rem;
                        color: #7f8c8d;
                      }
                    }

                    &.low {
                      background: linear-gradient(135deg, rgba(76, 175, 80, 0.08) 0%, rgba(76, 175, 80, 0.12) 100%);
                      border: 1px solid rgba(76, 175, 80, 0.2);
                    }

                    &.medium {
                      background: linear-gradient(135deg, rgba(255, 193, 7, 0.08) 0%, rgba(255, 193, 7, 0.12) 100%);
                      border: 1px solid rgba(255, 193, 7, 0.2);
                    }

                    &.high {
                      background: linear-gradient(135deg, rgba(255, 152, 0, 0.08) 0%, rgba(255, 152, 0, 0.12) 100%);
                      border: 1px solid rgba(255, 152, 0, 0.2);
                    }
                  }
                }
              }

              // 改进建议样式
              &.improvements {
                .improvements-list {
                  display: flex;
                  flex-direction: column;
                  gap: 1rem;

                  .improvement-item {
                    padding: 1rem;
                    background: white;
                    border-radius: 12px;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
                    transition: all 0.3s ease;

                    &:hover {
                      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
                      transform: translateY(-2px);
                    }

                    .improvement-category {
                      display: inline-block;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      color: white;
                      padding: 0.3rem 0.8rem;
                      border-radius: 15px;
                      font-size: 0.8rem;
                      font-weight: 600;
                      margin-bottom: 0.8rem;
                    }

                    .improvement-content {
                      font-size: 0.95rem;
                      line-height: 1.5;
                      color: #2c3e50;
                    }
                  }
                }
              }

              // 健康洞察样式
              &.insights {
                .insights-list {
                  display: flex;
                  flex-direction: column;
                  gap: 1rem;

                  .insight-item {
                    display: flex;
                    align-items: flex-start;
                    gap: 1rem;
                    padding: 1rem;
                    background: white;
                    border-radius: 12px;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
                    transition: all 0.3s ease;

                    &:hover {
                      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
                      transform: translateY(-2px);
                    }

                    .insight-icon {
                      font-size: 1.5rem;
                      color: #667eea;
                    }

                    .insight-content {
                      flex: 1;
                      font-size: 0.95rem;
                      line-height: 1.5;
                      color: #2c3e50;
                    }
                  }
                }
              }
            }
          }
        }

        // 响应式设计
        @media (max-width: 768px) {
          padding: 1.5rem;

          .module-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;

            .header-left {
              .module-title {
                font-size: 1.3rem;
              }
            }
          }

          &.nutrition-overview-module {
            .nutrition-overview-grid {
              .nutrition-category {
                .nutrition-comparison {
                  grid-template-columns: 1fr;
                  text-align: center;
                  gap: 1rem;

                  .comparison-arrow {
                    transform: rotate(90deg);
                  }
                }

                .macronutrients-grid {
                  grid-template-columns: 1fr;
                }

                .vitamins-grid {
                  grid-template-columns: repeat(2, 1fr);
                }
              }
            }
          }

          &.nutrition-balance-module {
            .balance-analysis-grid {
              grid-template-columns: 1fr;
            }
          }

          &.ai-analysis-module {
            .ai-analysis-grid {
              grid-template-columns: 1fr;
            }
          }
        }
      }
    }
  }
</style>
