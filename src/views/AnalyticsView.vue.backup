<template>
  <div class="analytics-view">
    <div class="container">
      <div class="analytics-header">
        <h1 class="page-title">
          <span class="title-icon">ğŸ“Š</span>
          è¥å…»åˆ†æä¸è†³é£ŸæŒ‡å¯¼
        </h1>
        <p class="page-subtitle">åŸºäºä¸­å›½å±…æ°‘è†³é£ŸæŒ‡å—çš„æ™ºèƒ½è¥å…»åˆ†æ</p>
      </div>

      <div class="analytics-dashboard">
        <!-- è†³é£ŸæŒ‡å—æ¦‚è§ˆ -->
        <div class="analytics-card guidelines-card">
          <h2 class="card-title">
            <span class="card-icon">ğŸ“‹</span>
            ä¸­å›½å±…æ°‘è†³é£ŸæŒ‡å—æ ¸å¿ƒæ¨è
          </h2>
          <div class="guidelines-grid">
            <div
              v-for="principle in dietaryGuidelines.principles.slice(0, 4)"
              :key="principle.id"
              class="guideline-item"
            >
              <div class="guideline-number">{{ principle.id }}</div>
              <div class="guideline-content">
                <h3 class="guideline-title">{{ principle.title }}</h3>
                <p class="guideline-desc">{{ principle.description }}</p>
              </div>
            </div>
          </div>
          <el-button type="primary" @click="showFullGuidelines = true" class="view-all-btn">
            æŸ¥çœ‹å®Œæ•´æŒ‡å—
          </el-button>
        </div>

        <!-- ä¸ªäººè¥å…»åˆ†æ -->
        <div class="analytics-card nutrition-card">
          <h2 class="card-title">
            <span class="card-icon">ğŸ¯</span>
            ä¸ªäººè¥å…»åˆ†æ
          </h2>

          <!-- æ•°æ®è¾“å…¥æç¤º -->
          <div v-if="!hasUserData" class="no-data-prompt">
            <div class="prompt-content">
              <div class="prompt-icon">ğŸ“</div>
              <h3 class="prompt-title">å¼€å§‹æ‚¨çš„ä¸ªæ€§åŒ–è¥å…»åˆ†æ</h3>
              <p class="prompt-desc">
                è¯·è¾“å…¥æ‚¨çš„ä¸ªäººä¿¡æ¯å’Œä»Šæ—¥é¥®é£Ÿè®°å½•ï¼ŒAIå°†ä¸ºæ‚¨æä¾›ä¸“ä¸šçš„è¥å…»åˆ†æå’Œä¸ªæ€§åŒ–å»ºè®®
              </p>
              <el-button
                type="primary"
                size="large"
                @click="showUserForm = true"
                class="start-analysis-btn"
              >
                <el-icon><Edit /></el-icon>
                å¼€å§‹è¾“å…¥æ•°æ®
              </el-button>
            </div>
          </div>

          <!-- è¥å…»åˆ†æç»“æœ - å››æ¨¡å—é‡æ„ç‰ˆæœ¬ -->
          <div v-else class="nutrition-analysis-modules">
            <div class="modules-container">
              
              <!-- æ¨¡å— 1: ä¸ªäººä¿¡æ¯ -->
              <div class="analysis-module personal-info-module">
                <div class="module-header">
                  <div class="header-left">
                    <div class="module-icon">ğŸ‘¤</div>
                    <h3 class="module-title">ä¸ªäººä¿¡æ¯</h3>
                  </div>
                  <el-button
                    type="primary"
                    size="small"
                    @click="showUserForm = true"
                    class="edit-btn"
                  >
                    <el-icon><Edit /></el-icon>
                    ä¿®æ”¹
                  </el-button>
                </div>
                <div class="module-content">
                  <div class="info-grid">
                    <div class="info-item">
                      <div class="info-icon">ğŸš»</div>
                      <div class="info-details">
                        <span class="info-label">æ€§åˆ«å¹´é¾„</span>
                        <span class="info-value">{{ userProfile?.gender === 'male' ? 'ç”·æ€§' : 'å¥³æ€§' }}ï¼Œ{{ userProfile?.age || 0 }}å²</span>
                      </div>
                    </div>
                    <div class="info-item">
                      <div class="info-icon">ğŸ“</div>
                      <div class="info-details">
                        <span class="info-label">èº«é«˜ä½“é‡</span>
                        <span class="info-value">{{ userProfile?.height || 0 }}cm / {{ userProfile?.weight || 0 }}kg</span>
                      </div>
                    </div>
                    <div class="info-item">
                      <div class="info-icon">âš–ï¸</div>
                      <div class="info-details">
                        <span class="info-label">BMIæŒ‡æ•°</span>
                        <span class="info-value">
                          {{ calculateBMI().toFixed(1) }}
                          <span :class="['status-badge', getBMIStatus()]">{{ getBMIStatusText() }}</span>
                        </span>
                      </div>
                    </div>
                    <div class="info-item">
                      <div class="info-icon">ğŸ¯</div>
                      <div class="info-details">
                        <span class="info-label">å¥åº·ç›®æ ‡</span>
                        <span class="info-value">{{ userProfile?.healthGoals?.join('ã€') || 'æœªè®¾ç½®' }}</span>
                      </div>
                    </div>
                    <div class="info-item">
                      <div class="info-icon">ğŸƒ</div>
                      <div class="info-details">
                        <span class="info-label">æ´»åŠ¨æ°´å¹³</span>
                        <span class="info-value">{{ getActivityLevelText(userProfile?.activityLevel || 'moderate') }}</span>
                      </div>
                    </div>
                    <div class="info-item">
                      <div class="info-icon">ğŸ</div>
                      <div class="info-details">
                        <span class="info-label">é¥®é£Ÿåå¥½</span>
                        <span class="info-value">{{ userProfile?.dietaryRestrictions?.join('ã€') || 'æ— ç‰¹æ®Šé™åˆ¶' }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- æ¨¡å— 2: è¥å…»æ¦‚è§ˆ -->
              <div class="analysis-module nutrition-overview-module">
                <div class="module-header">
                  <div class="header-left">
                    <div class="module-icon">ğŸ“Š</div>
                    <h3 class="module-title">è¥å…»æ¦‚è§ˆ</h3>
                  </div>
                  <div class="confidence-score">
                    <div class="score-circle">
                      <span class="score-number">{{ aiAnalysisResult?.confidenceScore?.toFixed(0) || '85' }}</span>
                      <span class="score-unit">åˆ†</span>
                    </div>
                    <span class="score-label">å¯ä¿¡åº¦</span>
                  </div>
                </div>
                <div class="module-content">
                  <div class="nutrition-overview-grid">
                    <!-- çƒ­é‡å¯¹æ¯” -->
                    <div class="nutrition-category">
                      <h4 class="category-title">ğŸ”¥ çƒ­é‡æ‘„å…¥</h4>
                      <div class="nutrition-comparison">
                        <div class="comparison-item needs">
                          <span class="item-label">æ¯æ—¥æ‰€éœ€</span>
                          <span class="item-value">{{ personalNutrition.dailyNeeds.calories.toFixed(0) }}</span>
                          <span class="item-unit">kcal</span>
                        </div>
                        <div class="comparison-arrow">â†’</div>
                        <div class="comparison-item current">
                          <span class="item-label">å½“å‰æ‘„å…¥</span>
                          <span class="item-value">{{ formatNumber(personalNutrition.currentIntake.calories, 0) }}</span>
                          <span class="item-unit">kcal</span>
                        </div>
                        <div class="comparison-status">
                          <span :class="['status-indicator', getCalorieStatus()]">
                            {{ getCalorieStatusText() }}
                          </span>
                        </div>
                      </div>
                    </div>

                    <!-- ä¸‰å¤§è¥å…»ç´  -->
                    <div class="nutrition-category">
                      <h4 class="category-title">ğŸ¥— ä¸‰å¤§è¥å…»ç´ </h4>
                      <div class="macronutrients-grid">
                        <div class="macro-item protein">
                          <div class="macro-icon">ğŸ¥©</div>
                          <div class="macro-details">
                            <span class="macro-name">è›‹ç™½è´¨</span>
                            <div class="macro-values">
                              <span class="current">{{ formatNumber(personalNutrition.currentIntake.protein, 1) }}g</span>
                              <span class="divider">/</span>
                              <span class="needed">{{ personalNutrition.dailyNeeds.protein.toFixed(1) }}g</span>
                            </div>
                            <div class="macro-progress">
                              <div class="progress-bar">
                                <div class="progress-fill" :style="{ width: getProteinProgress() + '%' }"></div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="macro-item carbs">
                          <div class="macro-icon">ğŸ</div>
                          <div class="macro-details">
                            <span class="macro-name">ç¢³æ°´åŒ–åˆç‰©</span>
                            <div class="macro-values">
                              <span class="current">{{ formatNumber(personalNutrition.currentIntake.carbs, 1) }}g</span>
                              <span class="divider">/</span>
                              <span class="needed">{{ personalNutrition.dailyNeeds.carbs.toFixed(1) }}g</span>
                            </div>
                            <div class="macro-progress">
                              <div class="progress-bar">
                                <div class="progress-fill" :style="{ width: getCarbsProgress() + '%' }"></div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="macro-item fat">
                          <div class="macro-icon">ğŸ¥‘</div>
                          <div class="macro-details">
                            <span class="macro-name">è„‚è‚ª</span>
                            <div class="macro-values">
                              <span class="current">{{ formatNumber(personalNutrition.currentIntake.fat, 1) }}g</span>
                              <span class="divider">/</span>
                              <span class="needed">{{ personalNutrition.dailyNeeds.fat.toFixed(1) }}g</span>
                            </div>
                            <div class="macro-progress">
                              <div class="progress-bar">
                                <div class="progress-fill" :style="{ width: getFatProgress() + '%' }"></div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- ç»´ç”Ÿç´ å’ŒçŸ¿ç‰©è´¨ -->
                    <div class="nutrition-category">
                      <h4 class="category-title">ğŸ’Š ç»´ç”Ÿç´ çŸ¿ç‰©è´¨</h4>
                      <div class="vitamins-grid">
                        <div class="vitamin-item">
                          <span class="vitamin-icon">ğŸŠ</span>
                          <span class="vitamin-name">ç»´ç”Ÿç´ C</span>
                          <span class="vitamin-value">{{ personalNutrition.currentIntake.vitaminC?.toFixed(1) || '65.2' }}mg</span>
                        </div>
                        <div class="vitamin-item">
                          <span class="vitamin-icon">ğŸ¥›</span>
                          <span class="vitamin-name">é’™</span>
                          <span class="vitamin-value">{{ personalNutrition.currentIntake.calcium?.toFixed(1) || '420.8' }}mg</span>
                        </div>
                        <div class="vitamin-item">
                          <span class="vitamin-icon">ğŸ¥©</span>
                          <span class="vitamin-name">é“</span>
                          <span class="vitamin-value">{{ personalNutrition.currentIntake.iron?.toFixed(1) || '12.5' }}mg</span>
                        </div>
                        <div class="vitamin-item">
                          <span class="vitamin-icon">ğŸ¥¬</span>
                          <span class="vitamin-name">è†³é£Ÿçº¤ç»´</span>
                          <span class="vitamin-value">{{ personalNutrition.currentIntake.fiber?.toFixed(1) || '18.6' }}g</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- æ¨¡å— 3: è¥å…»å¹³è¡¡åˆ†æ -->
              <div class="analysis-module nutrition-balance-module">
                <div class="module-header">
                  <div class="header-left">
                    <div class="module-icon">ğŸ¯</div>
                    <h3 class="module-title">è¥å…»å¹³è¡¡åˆ†æ</h3>
                  </div>
                  <div class="balance-score">
                    <span class="score-label">å¹³è¡¡åº¦</span>
                    <span class="score-value">{{ getNutritionBalanceScore() }}%</span>
                  </div>
                </div>
                <div class="module-content">
                  <div class="balance-analysis-grid">
                    <!-- é›·è¾¾å›¾ -->
                    <div class="chart-section">
                      <div class="chart-container">
                        <canvas ref="nutrientsChart" class="nutrition-chart"></canvas>
                      </div>
                      <div class="chart-legend">
                        <div class="legend-item">
                          <div class="legend-color current"></div>
                          <span class="legend-text">å½“å‰æ‘„å…¥</span>
                        </div>
                        <div class="legend-item">
                          <div class="legend-color recommended"></div>
                          <span class="legend-text">æ¨èæ‘„å…¥</span>
                        </div>
                      </div>
                    </div>
                    
                    <!-- è¥å…»ç´ è¯¦ç»†åˆ†æ -->
                    <div class="nutrients-analysis">
                      <h4 class="analysis-title">è¥å…»ç´ åˆ†æ</h4>
                      <div class="nutrients-list">
                        <div class="nutrient-item excellent">
                          <div class="nutrient-status">âœ…</div>
                          <div class="nutrient-info">
                            <span class="nutrient-name">è›‹ç™½è´¨</span>
                            <span class="nutrient-desc">æ‘„å…¥å……è¶³ï¼Œæœ‰åŠ©äºè‚Œè‚‰ç»´æŠ¤</span>
                          </div>
                        </div>
                        <div class="nutrient-item good">
                          <div class="nutrient-status">âš¡</div>
                          <div class="nutrient-info">
                            <span class="nutrient-name">ç¢³æ°´åŒ–åˆç‰©</span>
                            <span class="nutrient-desc">èƒ½é‡ä¾›åº”è‰¯å¥½</span>
                          </div>
                        </div>
                        <div class="nutrient-item attention">
                          <div class="nutrient-status">âš ï¸</div>
                          <div class="nutrient-info">
                            <span class="nutrient-name">è†³é£Ÿçº¤ç»´</span>
                            <span class="nutrient-desc">ç•¥æ˜¾ä¸è¶³ï¼Œå»ºè®®å¢åŠ è”¬æœæ‘„å…¥</span>
                          </div>
                        </div>
                        <div class="nutrient-item warning">
                          <div class="nutrient-status">â—</div>
                          <div class="nutrient-info">
                            <span class="nutrient-name">ç»´ç”Ÿç´ D</span>
                            <span class="nutrient-desc">æ˜æ˜¾ä¸è¶³ï¼Œå»ºè®®é€‚å½“è¡¥å……</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- æ¨¡å— 4: AIæ™ºèƒ½åˆ†æ -->
              <div class="analysis-module ai-analysis-module">
                <div class="module-header">
                  <div class="header-left">
                    <div class="module-icon">ğŸ¤–</div>
                    <h3 class="module-title">AIæ™ºèƒ½åˆ†æ</h3>
                  </div>
                  <div class="ai-badge">
                    <span class="badge-text">GPTåˆ†æ</span>
                  </div>
                </div>
                <div class="module-content">
                  <div class="ai-analysis-grid">
                    <!-- AIä¸ªæ€§åŒ–å»ºè®® -->
                    <div class="ai-section recommendations">
                      <h4 class="section-title">
                        <span class="title-icon">ğŸ’¡</span>
                        ä¸ªæ€§åŒ–å»ºè®®
                      </h4>
                      <div class="recommendations-list">
                        <div
                          v-for="(recommendation, index) in aiAnalysisResult?.personalizedRecommendations || defaultRecommendations"
                          :key="index"
                          class="recommendation-item"
                        >
                          <div class="item-marker">{{ index + 1 }}</div>
                          <div class="item-content">{{ recommendation }}</div>
                        </div>
                      </div>
                    </div>

                    <!-- å¥åº·é£é™©è¯„ä¼° -->
                    <div class="ai-section risks">
                      <h4 class="section-title">
                        <span class="title-icon">âš ï¸</span>
                        å¥åº·é£é™©è¯„ä¼°
                      </h4>
                      <div class="risks-list">
                        <div
                          v-for="(risk, index) in aiAnalysisResult?.riskAssessments || defaultRisks"
                          :key="index"
                          :class="['risk-item', risk.level]"
                        >
                          <div class="risk-level">{{ risk.icon }}</div>
                          <div class="risk-content">
                            <span class="risk-title">{{ risk.title }}</span>
                            <span class="risk-desc">{{ risk.description }}</span>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- æ”¹è¿›å»ºè®® -->
                    <div class="ai-section improvements">
                      <h4 class="section-title">
                        <span class="title-icon">ğŸ“ˆ</span>
                        è†³é£Ÿæ”¹è¿›å»ºè®®
                      </h4>
                      <div class="improvements-list">
                        <div
                          v-for="(improvement, index) in aiAnalysisResult?.improvementSuggestions || defaultImprovements"
                          :key="index"
                          class="improvement-item"
                        >
                          <div class="improvement-category">{{ improvement.category }}</div>
                          <div class="improvement-content">{{ improvement.suggestion }}</div>
                        </div>
                      </div>
                    </div>

                    <!-- å¥åº·æ´å¯Ÿ -->
                    <div class="ai-section insights">
                      <h4 class="section-title">
                        <span class="title-icon">ğŸ”</span>
                        å¥åº·æ´å¯Ÿ
                      </h4>
                      <div class="insights-list">
                        <div
                          v-for="(insight, index) in aiAnalysisResult?.healthInsights || defaultInsights"
                          :key="index"
                          class="insight-item"
                        >
                          <div class="insight-icon">ğŸ“Š</div>
                          <div class="insight-content">{{ insight }}</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- é£Ÿç‰©åˆ†ç»„æ‘„å…¥å»ºè®® -->
        <div class="analytics-card food-groups-card">
          <h2 class="card-title">
            <span class="card-icon">ğŸ¥—</span>
            é£Ÿç‰©åˆ†ç»„æ¯æ—¥æ‘„å…¥å»ºè®®
          </h2>

          <div class="food-groups-grid">
            <div
              v-for="group in dietaryGuidelines.foodGroups"
              :key="group.group"
              class="food-group-item"
            >
              <div class="group-header">
                <h3 class="group-name">{{ group.group }}</h3>
                <div class="group-amount">
                  {{ group.dailyIntake.amount }}{{ group.dailyIntake.unit }}
                  <span v-if="group.dailyIntake.range" class="amount-range">
                    ({{ group.dailyIntake.range.min }}-{{ group.dailyIntake.range.max
                    }}{{ group.dailyIntake.unit }})
                  </span>
                </div>
              </div>

              <div class="group-examples">
                <div class="examples-label">ä¸»è¦é£Ÿç‰©ï¼š</div>
                <div class="examples-list">
                  <span
                    v-for="example in group.examples.slice(0, 6)"
                    :key="example"
                    class="example-tag"
                  >
                    {{ example }}
                  </span>
                </div>
              </div>

              <div class="nutrition-focus">
                <div class="focus-label">è¥å…»é‡ç‚¹ï¼š</div>
                <div class="focus-list">
                  {{ group.nutritionFocus.join('ã€') }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- å­£èŠ‚æ€§æ¨è -->
        <div class="analytics-card seasonal-card">
          <h2 class="card-title">
            <span class="card-icon">ğŸŒ±</span>
            å½“å­£è¥å…»æ¨è
          </h2>

          <div class="seasonal-content">
            <div class="season-info">
              <div class="season-badge">{{ getSeasonName(seasonalRecommendation.season) }}</div>
              <div class="season-benefit">{{ seasonalRecommendation.seasonalBenefits[0] }}</div>
            </div>

            <div class="seasonal-foods">
              <h3 class="section-title">æ¨èé£Ÿæ</h3>
              <div class="foods-grid">
                <div
                  v-for="food in seasonalRecommendation.recommendedFoods.slice(0, 12)"
                  :key="food"
                  class="food-item"
                >
                  {{ food }}
                </div>
              </div>
            </div>

            <div class="seasonal-recipes">
              <h3 class="section-title">æ—¶ä»¤é£Ÿè°±</h3>
              <div class="recipes-list">
                <div
                  v-for="recipe in seasonalRecommendation.recipes"
                  :key="recipe"
                  class="recipe-item"
                >
                  <span class="recipe-icon">ğŸ³</span>
                  <span class="recipe-name">{{ recipe }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ä¸­åŒ»ä½“è´¨åˆ†æä¸ä¸ªäººè¥å…»è”åŠ¨ -->
        <div class="analytics-card tcm-card tcm-constitution-card">
          <h2 class="card-title">
            <span class="card-icon">ğŸ¥</span>
            ä¸­åŒ»ä½“è´¨åˆ†æä¸è†³é£Ÿè°ƒç†
          </h2>

          <div v-if="!hasUserData" class="no-data-prompt tcm-prompt">
            <div class="prompt-content">
              <div class="prompt-icon">ğŸ¥</div>
              <h3 class="prompt-title">å¼€å§‹æ‚¨çš„ä¸­åŒ»ä½“è´¨åˆ†æ</h3>
              <p class="prompt-desc">
                åŸºäºä¼ ç»Ÿä¸­åŒ»ç†è®ºï¼Œç»“åˆæ‚¨çš„ä¸ªäººä¿¡æ¯è¿›è¡Œä½“è´¨åˆ†æï¼Œæä¾›ä¸ªæ€§åŒ–è†³é£Ÿè°ƒç†å»ºè®®
              </p>
              <el-button
                type="primary"
                size="large"
                @click="showUserForm = true"
                class="start-analysis-btn"
              >
                <el-icon><Edit /></el-icon>
                å¼€å§‹ä½“è´¨åˆ†æ
              </el-button>
            </div>
          </div>

          <div v-else class="tcm-analysis-content">
            <!-- ä½“è´¨åˆ†æç»“æœ -->
            <div v-if="tcmAnalysisResult" class="constitution-analysis">
              <div class="constitution-header">
                <div class="constitution-main">
                  <div class="constitution-type">
                    <span class="constitution-name">{{
                      tcmAnalysisResult.primaryConstitution.name
                    }}</span>
                    <span class="constitution-confidence"
                      >ç½®ä¿¡åº¦ï¼š{{ tcmAnalysisResult.primaryConstitution.confidence }}%</span
                    >
                  </div>
                  <div
                    v-if="tcmAnalysisResult.secondaryConstitution"
                    class="secondary-constitution"
                  >
                    å…¼æœ‰ï¼š{{ tcmAnalysisResult.secondaryConstitution.name }}
                  </div>
                </div>
                <div class="health-score">
                  <div class="score-circle">
                    <div class="score-value">{{ tcmAnalysisResult.overallHealthScore }}</div>
                    <div class="score-label">å¥åº·è¯„åˆ†</div>
                  </div>
                </div>
              </div>

              <!-- ä½“è´¨ç‰¹å¾ -->
              <div class="constitution-characteristics">
                <h4 class="subsection-title">ä½“è´¨ç‰¹å¾</h4>
                <div class="characteristics-grid">
                  <div
                    v-for="(characteristic, index) in tcmAnalysisResult.primaryConstitution
                      .characteristics"
                    :key="index"
                    class="characteristic-item"
                  >
                    <span class="characteristic-icon">âœ“</span>
                    <span class="characteristic-text">{{ characteristic }}</span>
                  </div>
                </div>
              </div>

              <!-- è†³é£Ÿè°ƒç†å»ºè®®ï¼ˆç»“åˆè¥å…»åˆ†æï¼‰ -->
              <div class="dietary-guidance">
                <h4 class="subsection-title">ä¸ªæ€§åŒ–è†³é£Ÿè°ƒç†</h4>
                <div class="guidance-sections">
                  <!-- åŸºäºä½“è´¨çš„è¥å…»å»ºè®® -->
                  <div class="guidance-section">
                    <h5 class="guidance-title">ğŸ½ï¸ è¥å…»æ­é…å»ºè®®</h5>
                    <div class="guidance-list">
                      <div
                        v-for="(advice, index) in combinedNutritionAdvice"
                        :key="index"
                        class="guidance-item"
                      >
                        <span class="guidance-icon">ğŸ’¡</span>
                        <span class="guidance-text">{{ advice }}</span>
                      </div>
                    </div>
                  </div>

                  <!-- å­£èŠ‚æ€§è°ƒç† -->
                  <div class="guidance-section">
                    <h5 class="guidance-title">
                      ğŸŒ¸ {{ tcmAnalysisResult.seasonalDietPlan.currentSeason }}è°ƒç†
                    </h5>
                    <div class="guidance-list">
                      <div
                        v-for="(rec, index) in tcmAnalysisResult.seasonalDietPlan.recommendations"
                        :key="index"
                        class="guidance-item"
                      >
                        <span class="guidance-icon">ğŸŒ±</span>
                        <span class="guidance-text">{{ rec }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- AI ä½“è´¨æ´å¯Ÿ -->
              <div v-if="tcmAnalysisResult.aiInsights?.length" class="tcm-ai-insights">
                <h4 class="subsection-title">ğŸ¤– AI ä¸­åŒ»æ´å¯Ÿ</h4>
                <div class="insights-list">
                  <div
                    v-for="(insight, index) in tcmAnalysisResult.aiInsights"
                    :key="index"
                    class="insight-item"
                  >
                    <span class="insight-icon">ğŸ”</span>
                    <span class="insight-text">{{ insight }}</span>
                  </div>
                </div>
              </div>

              <!-- æ˜“æ‚£ç–¾ç—…æé†’ -->
              <div
                v-if="tcmAnalysisResult.primaryConstitution.susceptibleDiseases?.length"
                class="health-warnings"
              >
                <h4 class="subsection-title warning">âš ï¸ å¥åº·æé†’</h4>
                <div class="warnings-grid">
                  <div
                    v-for="(disease, index) in tcmAnalysisResult.primaryConstitution
                      .susceptibleDiseases"
                    :key="index"
                    class="warning-item"
                  >
                    <span class="warning-icon">âš ï¸</span>
                    <span class="warning-text">æ³¨æ„é¢„é˜²ï¼š{{ disease }}</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- åŠ è½½çŠ¶æ€ -->
            <div v-else-if="analyzingTCM" class="tcm-loading">
              <div class="loading-content">
                <div class="loading-spinner"></div>
                <p class="loading-text">AIæ­£åœ¨åˆ†ææ‚¨çš„ä¸­åŒ»ä½“è´¨...</p>
              </div>
            </div>

            <!-- åˆ†ææ“ä½œ -->
            <div class="tcm-analysis-actions">
              <el-button @click="regenerateTCMAnalysis" :loading="analyzingTCM" type="primary">
                <el-icon><Refresh /></el-icon>
                {{ analyzingTCM ? 'é‡æ–°åˆ†æä¸­...' : 'é‡æ–°AIä½“è´¨åˆ†æ' }}
              </el-button>
              <el-button @click="showUserForm = true" type="default">
                <el-icon><Edit /></el-icon>
                ä¿®æ”¹ä¸ªäººä¿¡æ¯
              </el-button>
            </div>
          </div>
        </div>
      </div>

      <!-- è†³é£ŸæŒ‡å—è¯¦æƒ…å¼¹çª— -->
      <el-dialog
        v-model="showFullGuidelines"
        title="ä¸­å›½å±…æ°‘è†³é£ŸæŒ‡å— (2022ç‰ˆ)"
        width="80%"
        class="guidelines-dialog"
      >
        <div class="full-guidelines">
          <div
            v-for="principle in dietaryGuidelines.principles"
            :key="principle.id"
            class="guideline-detail"
          >
            <h3 class="detail-title">{{ principle.id }}. {{ principle.title }}</h3>
            <p class="detail-description">{{ principle.description }}</p>
            <ul class="detail-recommendations">
              <li v-for="rec in principle.recommendations" :key="rec">{{ rec }}</li>
            </ul>
          </div>
        </div>
      </el-dialog>

      <!-- ç”¨æˆ·ä¿¡æ¯è¾“å…¥å¼¹çª— -->
      <el-dialog
        v-model="showUserForm"
        title="ä¸ªäººä¿¡æ¯ä¸é¥®é£Ÿè®°å½•"
        width="90%"
        :close-on-click-modal="false"
        class="user-form-dialog"
      >
        <UserProfileForm @submit="handleUserFormSubmit" @cancel="showUserForm = false" />
      </el-dialog>
    </div>
  </div>
</template>

<script setup lang="ts">
  import { ref, onMounted, onUnmounted, computed } from 'vue'
  import { ElMessage } from 'element-plus'
  import { Edit, Refresh } from '@element-plus/icons-vue'
  import Chart from 'chart.js/auto'
  import { nutritionAnalysisService } from '@/services/nutritionAnalysisService'
  import { aiPersonalizedNutritionService } from '@/services/aiPersonalizedNutritionService'
  import { tcmConstitutionService } from '@/services/tcmConstitutionService'
  import UserProfileForm from '@/components/analytics/UserProfileForm.vue'
  import type { NutrientAnalysis } from '@/services/nutritionAnalysisService'
  import type {
    ExtendedUserProfile,
    AIAnalysisResult,
  } from '@/services/aiPersonalizedNutritionService'
  import type { TCMAnalysisResult } from '@/services/tcmConstitutionService'

  // å›¾è¡¨å¼•ç”¨
  const nutrientsChart = ref<HTMLCanvasElement | null>(null)
  const constitutionChart = ref<HTMLCanvasElement | null>(null)

  // å›¾è¡¨å®ä¾‹å­˜å‚¨
  let nutrientsChartInstance: Chart | null = null
  let constitutionChartInstance: Chart | null = null

  // å“åº”å¼æ•°æ®
  const showFullGuidelines = ref(false)
  const showUserForm = ref(false)
  const analyzingData = ref(false)
  const analyzingTCM = ref(false)

  // ç”¨æˆ·æ•°æ®å’Œåˆ†æç»“æœ
  const userProfile = ref<ExtendedUserProfile | null>({
    age: 28,
    gender: 'female',
    weight: 58,
    height: 165,
    activityLevel: 'moderate',
    healthGoals: ['å‡è„‚', 'å¥åº·é¥®é£Ÿ', 'å¢å¼ºä½“è´¨'],
    dietaryRestrictions: ['ç´ é£Ÿä¸»ä¹‰'],
    meals: [
      {
        name: 'æ—©é¤',
        foods: ['ç‡•éº¦ç²¥', 'ç‰›å¥¶', 'é¦™è•‰', 'åšæœ'],
        time: '08:00'
      },
      {
        name: 'åˆé¤', 
        foods: ['ç³™ç±³é¥­', 'è’¸è›‹ç¾¹', 'è¥¿å…°èŠ±', 'èƒ¡èåœ'],
        time: '12:30'
      },
      {
        name: 'æ™šé¤',
        foods: ['è”¬èœæ²™æ‹‰', 'çƒ¤é¸¡èƒ¸è‚‰', 'çº¢è–¯'],
        time: '18:30'
      }
    ],
    medicalConditions: [],
    allergies: [],
    dietaryPreferences: ['ä½ç›', 'å°‘æ²¹', 'é«˜è›‹ç™½']
  })
  const aiAnalysisResult = ref<AIAnalysisResult | null>(null)
  const tcmAnalysisResult = ref<TCMAnalysisResult | null>(null)

  // è·å–è†³é£ŸæŒ‡å—æ•°æ®
  const dietaryGuidelines = computed(() => nutritionAnalysisService.getChineseDietaryGuidelines())

  // æ£€æŸ¥æ˜¯å¦æœ‰ç”¨æˆ·æ•°æ®
  const hasUserData = computed(() => !!userProfile.value)

  // è¾…åŠ©å‡½æ•°ï¼šå®‰å…¨åœ°æ ¼å¼åŒ–æ•°å€¼
  const formatNumber = (value: any, decimals: number = 1): string => {
    if (typeof value === 'number') {
      return value.toFixed(decimals)
    } else if (typeof value === 'string' && /^\d+(\.\d+)?$/.test(value)) {
      return parseFloat(value).toFixed(decimals)
    }
    return value || '0'
  }

  // æ¨¡æ‹Ÿå½“å‰è¥å…»æ‘„å…¥ï¼ˆå¦‚æœæ²¡æœ‰AIåˆ†æç»“æœï¼Œä½¿ç”¨é»˜è®¤å€¼ï¼‰
  const currentIntake = computed<NutrientAnalysis>(() => {
    if (aiAnalysisResult.value?.nutritionAnalysis) {
      return aiAnalysisResult.value.nutritionAnalysis
    }

    // é»˜è®¤å€¼
    return {
      calories: 1800,
      protein: 50,
      carbs: 200,
      fat: 60,
      fiber: 18,
      sodium: 2200,
      calcium: 600,
      iron: 15,
      vitaminC: 80,
      sugar: 40,
    }
  })

  // ä¸ªäººè¥å…»åˆ†æ
  const personalNutrition = computed(() => {
    if (!userProfile.value) {
      // è¿”å›é»˜è®¤åˆ†æç»“æœ
      return {
        dailyNeeds: {
          calories: 2000,
          protein: 60,
          carbs: 250,
          fat: 67,
          fiber: 25,
          sodium: 2000,
          calcium: 800,
          iron: 12,
          vitaminC: 100,
          sugar: 50,
        },
        currentIntake: currentIntake.value,
        balanceScore: 85,
        recommendations: ['å¼€å§‹è¾“å…¥æ‚¨çš„ä¸ªäººä¿¡æ¯ä»¥è·å–ä¸ªæ€§åŒ–å»ºè®®'],
        deficiencies: [],
        excesses: [],
      }
    }

    const basicProfile = {
      age: userProfile.value.age,
      gender: userProfile.value.gender,
      weight: userProfile.value.weight,
      height: userProfile.value.height,
      activityLevel: userProfile.value.activityLevel,
      healthGoals: userProfile.value.healthGoals,
    }

    return nutritionAnalysisService.generatePersonalizedRecommendations(
      basicProfile,
      currentIntake.value
    )
  })

  // å­£èŠ‚æ€§æ¨è
  const seasonalRecommendation = computed(() =>
    nutritionAnalysisService.getSeasonalRecommendations()
  )

  // ä¸­åŒ»ä½“è´¨åˆ†æå’Œè¥å…»å»ºè®®çš„è”åˆæ¨è
  const combinedNutritionAdvice = computed(() => {
    const advice: string[] = []

    // åŸºç¡€è¥å…»å»ºè®®
    if (personalNutrition.value.recommendations) {
      advice.push(...personalNutrition.value.recommendations)
    }

    // åŸºäºä¸­åŒ»ä½“è´¨çš„è¥å…»å»ºè®®
    if (tcmAnalysisResult.value?.nutritionalGuidance) {
      advice.push(...tcmAnalysisResult.value.nutritionalGuidance)
    }

    // åŸºäºä½“è´¨çš„ç‰¹æ®Šè¥å…»å»ºè®®
    if (tcmAnalysisResult.value?.primaryConstitution) {
      const constitutionAdvice = tcmConstitutionService.getConstitutionBasedNutritionAdvice(
        tcmAnalysisResult.value.primaryConstitution
      )
      advice.push(...constitutionAdvice)
    }

    // å»é‡å¹¶é™åˆ¶æ•°é‡
    return [...new Set(advice)].slice(0, 6)
  })

  // ä¸­åŒ»ä½“è´¨åˆ†æï¼ˆä¿ç•™å…¼å®¹æ€§ï¼‰
  const tcmAnalysis = computed(() =>
    nutritionAnalysisService.analyzeTCMConstitution(['æ­£å¸¸'], ['æ¸…æ·¡'])
  )

  // è®¡ç®—BMI
  const calculateBMI = () => {
    if (!userProfile.value) return 0
    const heightInMeters = userProfile.value.height / 100
    return userProfile.value.weight / (heightInMeters * heightInMeters)
  }

  // è·å–BMIçŠ¶æ€
  const getBMIStatus = () => {
    const bmi = calculateBMI()
    if (bmi < 18.5) return 'underweight'
    if (bmi < 24) return 'normal'
    if (bmi < 28) return 'overweight'
    return 'obese'
  }

  // è·å–BMIçŠ¶æ€æ–‡æœ¬
  const getBMIStatusText = () => {
    const status = getBMIStatus()
    const statusTexts = {
      underweight: 'åç˜¦',
      normal: 'æ­£å¸¸',
      overweight: 'è¶…é‡',
      obese: 'è‚¥èƒ–',
    }
    return statusTexts[status as keyof typeof statusTexts] || 'æœªçŸ¥'
  }

  // è·å–æ´»åŠ¨æ°´å¹³æ–‡æœ¬
  const getActivityLevelText = (level: string) => {
    const levelTexts = {
      sedentary: 'ä¹…åå°‘åŠ¨',
      light: 'è½»åº¦æ´»åŠ¨',
      moderate: 'ä¸­åº¦æ´»åŠ¨',
      active: 'é«˜åº¦æ´»åŠ¨',
      very_active: 'æé«˜æ´»åŠ¨'
    }
    return levelTexts[level as keyof typeof levelTexts] || level
  }

  // è·å–çƒ­é‡çŠ¶æ€
  const getCalorieStatus = () => {
    const current = personalNutrition.value.currentIntake.calories
    const needed = personalNutrition.value.dailyNeeds.calories
    const ratio = current / needed
    
    if (ratio < 0.8) return 'low'
    if (ratio > 1.2) return 'high'
    return 'normal'
  }

  // è·å–çƒ­é‡çŠ¶æ€æ–‡æœ¬
  const getCalorieStatusText = () => {
    const status = getCalorieStatus()
    const statusTexts = {
      low: 'æ‘„å…¥ä¸è¶³',
      normal: 'æ‘„å…¥é€‚ä¸­',
      high: 'æ‘„å…¥è¿‡é‡'
    }
    return statusTexts[status as keyof typeof statusTexts] || 'æ­£å¸¸'
  }

  // è·å–è›‹ç™½è´¨æ‘„å…¥è¿›åº¦
  const getProteinProgress = () => {
    const current = personalNutrition.value.currentIntake.protein
    const needed = personalNutrition.value.dailyNeeds.protein
    return Math.min((current / needed) * 100, 100)
  }

  // è·å–ç¢³æ°´åŒ–åˆç‰©æ‘„å…¥è¿›åº¦
  const getCarbsProgress = () => {
    const current = personalNutrition.value.currentIntake.carbs
    const needed = personalNutrition.value.dailyNeeds.carbs
    return Math.min((current / needed) * 100, 100)
  }

  // è·å–è„‚è‚ªæ‘„å…¥è¿›åº¦
  const getFatProgress = () => {
    const current = personalNutrition.value.currentIntake.fat
    const needed = personalNutrition.value.dailyNeeds.fat
    return Math.min((current / needed) * 100, 100)
  }

  // è·å–è¥å…»å¹³è¡¡è¯„åˆ†
  const getNutritionBalanceScore = () => {
    const proteinScore = Math.min(getProteinProgress(), 100)
    const carbsScore = Math.min(getCarbsProgress(), 100)
    const fatScore = Math.min(getFatProgress(), 100)
    
    return Math.round((proteinScore + carbsScore + fatScore) / 3)
  }

  // é»˜è®¤æ¨èæ•°æ®
  const defaultRecommendations = [
    'å¢åŠ æ·±è‰²è”¬èœæ‘„å…¥ï¼Œå»ºè®®æ¯æ—¥300-500å…‹ï¼Œæä¾›ä¸°å¯Œçš„ç»´ç”Ÿç´ å’ŒçŸ¿ç‰©è´¨',
    'é€‚é‡è¡¥å……ä¼˜è´¨è›‹ç™½è´¨ï¼Œå¦‚é±¼ç±»ã€ç˜¦è‚‰ã€è±†åˆ¶å“ï¼Œæ¯æ—¥1.2g/kgä½“é‡',
    'æ§åˆ¶ç²¾åˆ¶ç³–å’Œé«˜ç›é£Ÿç‰©ï¼Œé€‰æ‹©ä½é’ é£Ÿå“ï¼Œæ¯æ—¥ç›æ‘„å…¥ä¸è¶…è¿‡6å…‹',
    'ä¿æŒè§„å¾‹ç”¨é¤æ—¶é—´ï¼Œé¿å…æš´é¥®æš´é£Ÿï¼Œå°‘é£Ÿå¤šé¤æœ‰ç›Šæ¶ˆåŒ–',
    'å¢åŠ è†³é£Ÿçº¤ç»´æ‘„å…¥ï¼Œå…¨è°·ç‰©ã€æœè”¬èƒ½æ”¹å–„è‚ é“å¥åº·'
  ]

  // é»˜è®¤é£é™©æ•°æ®
  const defaultRisks = [
    { 
      icon: 'ğŸŸ¢', 
      level: 'low', 
      title: 'å¿ƒè¡€ç®¡é£é™©', 
      description: 'å½“å‰é¥®é£Ÿç»“æ„å¯¹å¿ƒè¡€ç®¡å¥åº·è¾ƒä¸ºå‹å¥½' 
    },
    { 
      icon: 'ğŸŸ¡', 
      level: 'medium', 
      title: 'è¥å…»ä¸å‡è¡¡', 
      description: 'éƒ¨åˆ†è¥å…»ç´ æ‘„å…¥å¯èƒ½ä¸è¶³ï¼Œéœ€è¦è°ƒæ•´é¥®é£Ÿç»“æ„' 
    },
    { 
      icon: 'ğŸŸ ', 
      level: 'high', 
      title: 'è†³é£Ÿçº¤ç»´ä¸è¶³', 
      description: 'è†³é£Ÿçº¤ç»´æ‘„å…¥åä½ï¼Œå¯èƒ½å½±å“è‚ é“å¥åº·' 
    }
  ]

  // é»˜è®¤æ”¹è¿›å»ºè®®
  const defaultImprovements = [
    { category: 'è”¬æœç±»', suggestion: 'æ¯æ—¥è‡³å°‘5ç§ä¸åŒé¢œè‰²çš„è”¬æœï¼Œä¿è¯ç»´ç”Ÿç´ å¤šæ ·æ€§' },
    { category: 'è›‹ç™½è´¨', suggestion: 'é€‚å½“å¢åŠ é±¼ç±»å’Œè±†åˆ¶å“æ¯”ä¾‹ï¼Œå‡å°‘çº¢è‚‰æ‘„å…¥' },
    { category: 'ä¸»é£Ÿç±»', suggestion: 'ç”¨ç²—ç²®æ›¿ä»£éƒ¨åˆ†ç²¾åˆ¶ç±³é¢ï¼Œå¢åŠ Bæ—ç»´ç”Ÿç´ ' },
    { category: 'æ²¹è„‚ç±»', suggestion: 'é€‰æ‹©å¯Œå«ä¸é¥±å’Œè„‚è‚ªé…¸çš„æ¤ç‰©æ²¹ï¼Œæ§åˆ¶æ€»é‡' }
  ]

  // é»˜è®¤å¥åº·æ´å¯Ÿ
  const defaultInsights = [
    'æ‚¨çš„è›‹ç™½è´¨æ‘„å…¥æ¯”ä¾‹åˆç†ï¼Œæœ‰åŠ©äºç»´æŒè‚Œè‚‰é‡å’ŒåŸºç¡€ä»£è°¢',
    'å»ºè®®å¢åŠ Ï‰-3è„‚è‚ªé…¸æ‘„å…¥ï¼Œå¯é€šè¿‡æ·±æµ·é±¼ç±»æˆ–äºšéº»ç±½æ²¹è¡¥å……',
    'å½“å‰é’™è´¨æ‘„å…¥ç•¥æ˜¾ä¸è¶³ï¼Œå»ºè®®é€‚é‡å¢åŠ å¥¶åˆ¶å“æˆ–æ·±ç»¿è‰²è”¬èœ',
    'è†³é£Ÿçº¤ç»´æ‘„å…¥æœ‰å¾…æé«˜ï¼Œæœ‰åŠ©äºæ”¹å–„è‚ é“å¾®ç”Ÿæ€å¹³è¡¡'
  ]

  // æ–¹æ³•
  const getSeasonName = (season: string) => {
    const seasonNames = {
      spring: 'æ˜¥å­£',
      summer: 'å¤å­£',
      autumn: 'ç§‹å­£',
      winter: 'å†¬å­£',
    }
    return seasonNames[season as keyof typeof seasonNames] || season
  }

  // å¤„ç†ç”¨æˆ·è¡¨å•æäº¤
  const handleUserFormSubmit = async (formData: any) => {
    analyzingData.value = true
    analyzingTCM.value = true
    showUserForm.value = false

    try {
      // è½¬æ¢è¡¨å•æ•°æ®ä¸ºExtendedUserProfileæ ¼å¼
      const extendedProfile: ExtendedUserProfile = {
        age: formData.age,
        gender: formData.gender,
        weight: formData.weight,
        height: formData.height,
        activityLevel: formData.activityLevel,
        healthGoals: formData.healthGoals,
        meals: formData.meals,
        medicalConditions: formData.medicalConditions,
        allergies: formData.allergies,
        dietaryPreferences: formData.dietaryPreferences,
      }

      userProfile.value = extendedProfile

      // å¹¶è¡Œæ‰§è¡Œè¥å…»åˆ†æå’Œä¸­åŒ»ä½“è´¨åˆ†æ
      const [nutritionResult, tcmResult] = await Promise.allSettled([
        aiPersonalizedNutritionService.analyzeUserNutrition({
          userProfile: extendedProfile,
          analysisType: 'comprehensive' as const,
          includeSeasonalRecommendations: true,
          includeTCMAnalysis: true,
        }),
        tcmConstitutionService.analyzeConstitution(extendedProfile),
      ])

      // å¤„ç†è¥å…»åˆ†æç»“æœ
      if (nutritionResult.status === 'fulfilled') {
        aiAnalysisResult.value = nutritionResult.value
      } else {
        console.error('è¥å…»åˆ†æå¤±è´¥:', nutritionResult.reason)
        ElMessage.warning('è¥å…»åˆ†æéƒ¨åˆ†å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
      }

      // å¤„ç†ä¸­åŒ»ä½“è´¨åˆ†æç»“æœ
      if (tcmResult.status === 'fulfilled') {
        tcmAnalysisResult.value = tcmResult.value
      } else {
        console.error('ä¸­åŒ»ä½“è´¨åˆ†æå¤±è´¥:', tcmResult.reason)
        ElMessage.warning('ä¸­åŒ»ä½“è´¨åˆ†æéƒ¨åˆ†å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
      }

      ElMessage.success('ä¸ªäººåˆ†æå·²å®Œæˆï¼')

      // å»¶è¿Ÿæ›´æ–°å›¾è¡¨
      setTimeout(() => {
        destroyCharts()
        initCharts()
      }, 500)
    } catch (error) {
      console.error('åˆ†æå¤±è´¥:', error)
      ElMessage.error('åˆ†æå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
    } finally {
      analyzingData.value = false
      analyzingTCM.value = false
    }
  }

  // é‡æ–°ç”Ÿæˆåˆ†æ
  const regenerateAnalysis = async () => {
    if (!userProfile.value) return

    analyzingData.value = true

    try {
      const analysisRequest = {
        userProfile: userProfile.value,
        analysisType: 'comprehensive' as const,
        includeSeasonalRecommendations: true,
        includeTCMAnalysis: true,
      }

      const result = await aiPersonalizedNutritionService.analyzeUserNutrition(analysisRequest)
      aiAnalysisResult.value = result

      ElMessage.success('AIåˆ†æå·²æ›´æ–°ï¼')

      // é‡æ–°åˆå§‹åŒ–å›¾è¡¨
      setTimeout(() => {
        destroyCharts()
        initCharts()
      }, 300)
    } catch (error) {
      console.error('é‡æ–°åˆ†æå¤±è´¥:', error)
      ElMessage.error('é‡æ–°åˆ†æå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
    } finally {
      analyzingData.value = false
    }
  }

  // é‡æ–°ç”Ÿæˆä¸­åŒ»ä½“è´¨åˆ†æ
  const regenerateTCMAnalysis = async () => {
    if (!userProfile.value) {
      ElMessage.warning('è¯·å…ˆè¾“å…¥ä¸ªäººä¿¡æ¯')
      return
    }

    try {
      analyzingTCM.value = true

      const result = await tcmConstitutionService.analyzeConstitution(userProfile.value)
      tcmAnalysisResult.value = result

      ElMessage.success('ä¸­åŒ»ä½“è´¨åˆ†æå·²æ›´æ–°ï¼')
    } catch (error) {
      console.error('é‡æ–°ç”Ÿæˆä¸­åŒ»ä½“è´¨åˆ†æå¤±è´¥:', error)
      ElMessage.error('ä½“è´¨åˆ†æå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
    } finally {
      analyzingTCM.value = false
    }
  }

  // åˆå§‹åŒ–é»˜è®¤åˆ†ææ•°æ®
  const initializeDefaultData = () => {
    // è®¾ç½®é»˜è®¤ç”¨æˆ·é…ç½®æ–‡ä»¶
    userProfile.value = {
      age: 28,
      gender: 'female',
      weight: 55,
      height: 165,
      activityLevel: 'moderate',
      healthGoals: ['å‡é‡', 'å¢å¼ºå…ç–«'],
      meals: [
        {
          name: 'æ—©é¤',
          items: ['ç‡•éº¦ç²¥', 'é¦™è•‰', 'é…¸å¥¶'],
          calories: 450
        },
        {
          name: 'åˆé¤',
          items: ['é¸¡èƒ¸è‚‰æ²™æ‹‰', 'ç³™ç±³é¥­', 'è”¬èœæ±¤'],
          calories: 650
        },
        {
          name: 'æ™šé¤',
          items: ['è’¸é±¼', 'è¥¿å…°èŠ±', 'çº¢è–¯'],
          calories: 550
        }
      ],
      medicalConditions: [],
      allergies: [],
      dietaryPreferences: ['å°‘ç›', 'å°‘ç³–']
    }

    // è®¾ç½®é»˜è®¤AIåˆ†æç»“æœ
    aiAnalysisResult.value = {
      confidenceScore: 87,
      personalizedRecommendations: [
        'å»ºè®®å¢åŠ è›‹ç™½è´¨æ‘„å…¥ï¼Œæ¯é¤ä¿è¯ä¼˜è´¨è›‹ç™½è´¨æ¥æº',
        'å¤šæ‘„å…¥å¯Œå«ç»´ç”Ÿç´ Cçš„æ°´æœï¼Œå¦‚æ©™å­ã€çŒ•çŒ´æ¡ƒç­‰',
        'é€‚é‡å¢åŠ å¥åº·è„‚è‚ªæ‘„å…¥ï¼Œå¦‚åšæœã€ç‰›æ²¹æœ',
        'ä¿æŒè§„å¾‹çš„ä¸‰é¤æ—¶é—´ï¼Œé¿å…æš´é¥®æš´é£Ÿ',
        'ç¡å‰3å°æ—¶é¿å…è¿›é£Ÿï¼Œæœ‰åŠ©äºæ¶ˆåŒ–å’Œå‡é‡'
      ],
      healthInsights: [
        'æ‚¨çš„æ•´ä½“è¥å…»æ­é…è¾ƒä¸ºå‡è¡¡ï¼Œè›‹ç™½è´¨æ‘„å…¥ç¬¦åˆéœ€æ±‚',
        'ç»´ç”Ÿç´ Cæ‘„å…¥ç•¥æ˜¾ä¸è¶³ï¼Œå»ºè®®å¢åŠ æ–°é²œæ°´æœæ‘„å…¥',
        'è†³é£Ÿçº¤ç»´æ‘„å…¥è‰¯å¥½ï¼Œæœ‰åŠ©äºæ¶ˆåŒ–ç³»ç»Ÿå¥åº·',
        'é’™è´¨æ‘„å…¥éœ€è¦å…³æ³¨ï¼Œå»ºè®®é€‚é‡è¡¥å……ä¹³åˆ¶å“'
      ],
      riskAssessments: [
        'å½“å‰ä½“é‡å¤„äºå¥åº·èŒƒå›´ï¼Œä½†éœ€æ³¨æ„ç»´æŒ',
        'é•¿æœŸç¼ºä¹ç»´ç”Ÿç´ Då¯èƒ½å½±å“é’™å¸æ”¶',
        'å·¥ä½œå‹åŠ›å¯èƒ½å½±å“é¥®é£Ÿè§„å¾‹æ€§',
        'ç¼ºä¹è¿åŠ¨å¯èƒ½å½±å“æ•´ä½“å¥åº·æ°´å¹³'
      ],
      improvementSuggestions: [
        'åˆ¶å®šå‘¨æœŸæ€§çš„è¥å…»è¯„ä¼°è®¡åˆ’ï¼Œæ¯æœˆæ£€æŸ¥ä¸€æ¬¡',
        'å¢åŠ æˆ·å¤–æ´»åŠ¨æ—¶é—´ï¼Œä¿ƒè¿›ç»´ç”Ÿç´ Dåˆæˆ',
        'å­¦ä¹ å¥åº·çƒ¹é¥ªæ–¹æ³•ï¼Œå‡å°‘è¥å…»æµå¤±',
        'å»ºç«‹é¥®æ°´æé†’ï¼Œä¿è¯æ¯æ—¥å……è¶³æ°´åˆ†æ‘„å…¥'
      ],
      nutritionAnalysis: {
        calories: 1650,
        protein: 52,
        carbs: 180,
        fat: 58,
        fiber: 22,
        sodium: 1800,
        calcium: 650,
        iron: 14,
        vitaminC: 75,
        sugar: 35
      }
    }

    // è®¾ç½®é»˜è®¤ä¸­åŒ»ä½“è´¨åˆ†æç»“æœ
    tcmAnalysisResult.value = {
      primaryConstitution: {
        name: 'å¹³å’Œè´¨',
        confidence: 85,
        characteristics: [
          'ä½“å½¢åŒ€ç§°å¥å£®',
          'é¢è‰²æ¶¦æ³½',
          'ç²¾åŠ›å……æ²›',
          'ç¡çœ è‰¯å¥½',
          'é£Ÿæ¬²æ­£å¸¸'
        ],
        susceptibleDiseases: []
      },
      secondaryConstitution: {
        name: 'æ°”è™šè´¨',
        confidence: 25,
        characteristics: [
          'å¶æœ‰ç–²å€¦æ„Ÿ',
          'è¿åŠ¨åæ˜“å‡ºæ±—'
        ],
        susceptibleDiseases: ['æ„Ÿå†’']
      },
      overallHealthScore: 88,
      seasonalDietPlan: {
        currentSeason: 'æ˜¥å­£',
        recommendations: [
          'å¤šé£Ÿç”¨ç»¿å¶è”¬èœï¼Œå¦‚è èœã€éŸ­èœç­‰',
          'é€‚é‡è¿›é£Ÿæ¸©æ€§é£Ÿç‰©ï¼Œå¦‚ç”Ÿå§œã€å¤§æ£',
          'å‡å°‘å¯’å‡‰é£Ÿç‰©æ‘„å…¥ï¼Œé¿å…æŸä¼¤è„¾èƒƒ',
          'ä¿æŒé¥®é£Ÿæ¸…æ·¡ï¼Œé¿å…è¿‡äºæ²¹è…»'
        ]
      },
      aiInsights: [
        'æ‚¨çš„ä½“è´¨æ•´ä½“åå‘å¹³å’Œï¼Œæ˜¯è¾ƒä¸ºç†æƒ³çš„ä½“è´¨ç±»å‹',
        'ç•¥æœ‰æ°”è™šå€¾å‘ï¼Œå»ºè®®é€‚å½“è¿›è¡¥ç›Šæ°”é£Ÿç‰©',
        'æ˜¥å­£å…»ç”Ÿé‡åœ¨å…»è‚ï¼Œå®œé£Ÿç”¨é’è‰²é£Ÿç‰©',
        'ä¿æŒè‰¯å¥½çš„ä½œæ¯ä¹ æƒ¯ï¼Œæœ‰åŠ©äºä½“è´¨è°ƒç†'
      ]
    }
  }

  // åˆå§‹åŒ–å›¾è¡¨
  const initCharts = () => {
    // è¥å…»ç´ é›·è¾¾å›¾
    if (nutrientsChart.value && hasUserData.value) {
      const ctx = nutrientsChart.value.getContext('2d')
      if (ctx) {
        const daily = personalNutrition.value.dailyNeeds
        const current = personalNutrition.value.currentIntake

        nutrientsChartInstance = new Chart(ctx, {
          type: 'radar',
          data: {
            labels: ['è›‹ç™½è´¨', 'é’™', 'é“', 'ç»´ç”Ÿç´ C', 'è†³é£Ÿçº¤ç»´'],
            datasets: [
              {
                label: 'å½“å‰æ‘„å…¥',
                data: [
                  (current.protein / daily.protein) * 100,
                  (current.calcium / daily.calcium) * 100,
                  (current.iron / daily.iron) * 100,
                  (current.vitaminC / daily.vitaminC) * 100,
                  (current.fiber / daily.fiber) * 100,
                ],
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2,
              },
              {
                label: 'æ¨èæ‘„å…¥',
                data: [100, 100, 100, 100, 100],
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              r: {
                min: 0,
                max: 150,
                ticks: {
                  stepSize: 25,
                },
              },
            },
          },
        })
      }
    }

    // ä½“è´¨åˆ†æé¥¼å›¾
    if (constitutionChart.value) {
      const ctx = constitutionChart.value.getContext('2d')
      if (ctx) {
        const balance = tcmAnalysis.value.foodNatureBalance

        constitutionChartInstance = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: ['çƒ­æ€§', 'æ¸©æ€§', 'å¹³æ€§', 'å‡‰æ€§', 'å¯’æ€§'],
            datasets: [
              {
                data: [balance.hot, balance.warm, balance.neutral, balance.cool, balance.cold],
                backgroundColor: ['#ff6b6b', '#ffa726', '#66bb6a', '#42a5f5', '#7e57c2'],
                borderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
              },
            },
          },
        })
      }
    }
  }

  // æ¸…ç†å›¾è¡¨
  const destroyCharts = () => {
    if (nutrientsChartInstance) {
      nutrientsChartInstance.destroy()
      nutrientsChartInstance = null
    }
    if (constitutionChartInstance) {
      constitutionChartInstance.destroy()
      constitutionChartInstance = null
    }
  }

  // ç”Ÿå‘½å‘¨æœŸ
  onMounted(() => {
    // åˆå§‹åŒ–é»˜è®¤æ•°æ®
    initializeDefaultData()
    
    setTimeout(() => {
      initCharts()
    }, 100)
  })

  // åœ¨ç»„ä»¶å¸è½½æ—¶æ¸…ç†å›¾è¡¨
  onUnmounted(() => {
    destroyCharts()
  })
</script>

<style lang="scss" scoped>
  @import '@/styles/variables.scss';

  .analytics-view {
    min-height: 100vh;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    padding: 2rem 0;

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    .analytics-header {
      text-align: center;
      margin-bottom: 3rem;

      .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;

        .title-icon {
          font-size: 3rem;
        }
      }

      .page-subtitle {
        font-size: 1.2rem;
        color: #7f8c8d;
        margin: 0;
      }
    }

    .analytics-dashboard {
      display: grid;
      grid-template-columns: 1fr;
      gap: 2rem;
      
      // ç¡®ä¿æ‰€æœ‰æ¨¡å—éƒ½æœ‰ä¸€è‡´çš„å¸ƒå±€å®½åº¦
      @media (min-width: 768px) {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }
    }

    .analytics-card {
      background: white;
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;

      &:hover {
        transform: translateY(-5px);
      }

      // æ‰€æœ‰æ¨¡å—éƒ½é‡‡ç”¨ç»Ÿä¸€çš„å¸ƒå±€å®½åº¦ï¼Œç¡®ä¿ä¸€è‡´æ€§
      &.nutrition-card {
        min-width: 100%;
        max-width: 100%;
      }

        // å†…éƒ¨å¸ƒå±€ä¼˜åŒ–ï¼šé‡æ–°è®¾è®¡ä¸ºå·¦å³ä¸¤æ å¼
        .analysis-main-layout {
          display: flex;
          flex-direction: column;
          gap: 2rem;
        }

        // ä¸»ç½‘æ ¼å¸ƒå±€ï¼šé‡‡ç”¨æ›´å‡è¡¡çš„ç©ºé—´åˆ†é…
        .analysis-main-grid {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 1.5rem;
          align-items: start;
          
          // ç§»åŠ¨ç«¯å•åˆ—å¸ƒå±€
          @media (max-width: 768px) {
            grid-template-columns: 1fr;
            gap: 1.5rem;
          }
        }

        // å·¦ä¾§åŒºåŸŸï¼šè¥å…»å›¾è¡¨å’Œä¸‹æ–¹AIæ¨¡å—
        .analysis-left-section {
          display: flex;
          flex-direction: column;
          gap: 1.5rem;
        }

        // è¥å…»å›¾è¡¨åŒºåŸŸ
        .nutrition-chart-section {
          background: white;
          border-radius: 12px;
          padding: 1.5rem;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        // å·¦ä¾§ä¸‹æ–¹AIæ¨¡å—ï¼šä½¿ç”¨flexå¸ƒå±€ä¼˜åŒ–ç©ºé—´åˆ©ç”¨
        .analysis-left-bottom {
          display: flex;
          gap: 1rem;
          margin-top: 1.5rem;
          
          // å­æ¨¡å—è‡ªé€‚åº”å®½åº¦
          > .analysis-module {
            flex: 1;
            min-width: 0;
          }
          
          // ç§»åŠ¨ç«¯å•åˆ—å¸ƒå±€
          @media (max-width: 768px) {
            grid-template-columns: 1fr;
            gap: 1rem;
          }
        }

        // å³ä¾§AIæ¨¡å—å®¹å™¨ï¼šä½¿ç”¨flexå¸ƒå±€è‡ªé€‚åº”ç©ºé—´
        .analysis-right-section {
          display: flex;
          gap: 1rem;
          height: fit-content;
          width: 100%;
          
          // å­æ¨¡å—è‡ªé€‚åº”å®½åº¦ï¼Œç¡®ä¿å……åˆ†åˆ©ç”¨ç©ºé—´
          > .analysis-module {
            flex: 1;
            min-width: 0; // å…è®¸æ”¶ç¼©
            max-width: none; // ç§»é™¤æœ€å¤§å®½åº¦é™åˆ¶
          }
          
          // ç§»åŠ¨ç«¯å•åˆ—å¸ƒå±€
          @media (max-width: 768px) {
            flex-direction: column;
            gap: 1rem;
          }
        }

        // åˆ†ææ“ä½œæŒ‰é’®åŒºåŸŸï¼šä½äºå·¦ä¾§AIæ¨¡å—ä¸‹æ–¹
        .analysis-actions {
          display: flex;
          justify-content: center;
          align-items: center;
          margin-top: 1.5rem;
          padding-top: 1rem;
          border-top: 1px solid #ebeef5;
          width: 100%;
          
          .el-button {
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: 25px;
            font-weight: 600;
            
            &:hover {
              transform: translateY(-2px);
              box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            }
          }
        }

        // åˆ†ææ¨¡å—ç»Ÿä¸€æ ·å¼ - ä¼˜åŒ–ç©ºé—´åˆ©ç”¨
        .analysis-module {
          background: #f8f9fa;
          border-radius: 12px;
          padding: 1rem;
          border-left: 4px solid #3498db;
          width: 100%;
          box-sizing: border-box;
          
          .section-title {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.6rem;
            color: #2c3e50;
            
            &.warning {
              color: #e74c3c;
            }
          }
          
          // å·¦ä¾§ä¸‹æ–¹æ¨¡å—å’Œå³ä¾§æ¨¡å—æ ·å¼ä¼˜åŒ–ï¼ˆæ›´ç´§å‡‘ï¼‰
          .analysis-left-bottom &,
          .analysis-right-section & {
            min-height: auto;
            padding: 0.8rem;
            
            .section-title {
              font-size: 0.9rem;
              margin-bottom: 0.5rem;
            }
          }
          
          // AIä¸ªæ€§åŒ–å»ºè®®æ¨¡å—
          &.nutrition-recommendations {
            border-left-color: #28a745;
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
            
            .recommendation-item {
              display: flex;
              align-items: flex-start;
              gap: 0.4rem;
              padding: 0.4rem;
              margin-bottom: 0.4rem;
              background: rgba(255, 255, 255, 0.7);
              border-radius: 6px;
              font-size: 0.8rem;
              line-height: 1.3;
              
              .recommendation-icon {
                font-size: 0.9rem;
                flex-shrink: 0;
              }
              
              // åœ¨å·¦ä¾§ä¸‹æ–¹å’Œå³ä¾§æ¨¡å—æ—¶æ›´ç´§å‡‘
              .analysis-left-bottom &,
              .analysis-right-section & {
                padding: 0.5rem;
                margin-bottom: 0.5rem;
                font-size: 0.8rem;
              }
            }
          }
          
          // å¥åº·æ´å¯Ÿæ¨¡å—
          &.health-insights {
            border-left-color: #17a2b8;
            background: linear-gradient(135deg, #e3f2fd 0%, #f0f8ff 100%);
            
            .insight-item {
              display: flex;
              align-items: flex-start;
              gap: 0.4rem;
              padding: 0.4rem;
              margin-bottom: 0.4rem;
              background: rgba(255, 255, 255, 0.7);
              border-radius: 6px;
              font-size: 0.8rem;
              line-height: 1.3;
              
              .insight-icon {
                font-size: 0.9rem;
                flex-shrink: 0;
              }
              
              // åœ¨å·¦ä¾§ä¸‹æ–¹å’Œå³ä¾§æ¨¡å—æ—¶æ›´ç´§å‡‘
              .analysis-left-bottom &,
              .analysis-right-section & {
                padding: 0.5rem;
                margin-bottom: 0.5rem;
                font-size: 0.8rem;
              }
            }
          }
          
          // é£é™©è¯„ä¼°æ¨¡å—
          &.risk-assessments {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            
            .risk-item {
              display: flex;
              align-items: flex-start;
              gap: 0.4rem;
              padding: 0.4rem;
              margin-bottom: 0.4rem;
              background: rgba(255, 255, 255, 0.7);
              border-radius: 6px;
              font-size: 0.8rem;
              line-height: 1.3;
              
              .risk-icon {
                font-size: 0.9rem;
                flex-shrink: 0;
              }
            }
          }
          
          // æ”¹å–„å»ºè®®æ¨¡å—
          &.improvement-suggestions {
            border-left-color: #ffc107;
            background: linear-gradient(135deg, #fff3cd 0%, #fefefe 100%);
            
            .improvement-item {
              display: flex;
              align-items: flex-start;
              gap: 0.4rem;
              padding: 0.4rem;
              margin-bottom: 0.4rem;
              background: rgba(255, 255, 255, 0.7);
              border-radius: 6px;
              font-size: 0.8rem;
              line-height: 1.3;
              
              .improvement-icon {
                font-size: 0.9rem;
                flex-shrink: 0;
              }
            }
          }
        }

        .analysis-left {
          min-height: 500px;
        }

        // è¥å…»é›·è¾¾å›¾å®¹å™¨
        .nutrients-chart {
          min-height: 400px;
          width: 100%;
        }
      }

      // æ‰€æœ‰æ¨¡å—éƒ½é‡‡ç”¨ç»Ÿä¸€çš„å¸ƒå±€å®½åº¦ï¼Œç¡®ä¿ä¸€è‡´æ€§
      &.tcm-card {
        min-width: 100%;
        max-width: 100%;
      }

      // æ‰€æœ‰æ¨¡å—éƒ½é‡‡ç”¨ç»Ÿä¸€çš„å¸ƒå±€å®½åº¦ï¼Œç¡®ä¿ä¸€è‡´æ€§  
      &.seasonal-card {
        min-width: 100%;
        max-width: 100%;
      }

      .card-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;

        .card-icon {
          font-size: 1.8rem;
        }
      }

      .section-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #34495e;
        margin-bottom: 1rem;

        &.warning {
          color: #f39c12;
        }

        &.danger {
          color: #e74c3c;
        }
      }
    }

    .guidelines-card {
      // æ‰€æœ‰æ¨¡å—éƒ½é‡‡ç”¨ç»Ÿä¸€çš„å¸ƒå±€å®½åº¦ï¼Œç¡®ä¿ä¸€è‡´æ€§
      min-width: 100%;
      max-width: 100%;

      .guidelines-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.2rem;
        margin-bottom: 1.5rem;
      }

      .guideline-item {
        display: flex;
        gap: 0.8rem;
        padding: 1.2rem;
        background: #f8f9fa;
        border-radius: 15px;
        border-left: 4px solid #3498db;

        .guideline-number {
          width: 36px;
          height: 36px;
          background: #3498db;
          color: white;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: 600;
          font-size: 1.1rem;
          flex-shrink: 0;
        }

        .guideline-content {
          flex: 1;

          .guideline-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.5rem;
          }

          .guideline-desc {
            color: #7f8c8d;
            line-height: 1.5;
            margin: 0;
          }
        }
      }

      .view-all-btn {
        border-radius: 25px;
        padding: 0.8rem 2rem;
      }
    }

    .nutrition-card {
      .no-data-prompt {
        text-align: center;
        padding: 3rem 2rem;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 20px;
        border: 2px dashed #dee2e6;

        .prompt-content {
          max-width: 500px;
          margin: 0 auto;

          .prompt-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.8;
          }

          .prompt-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1rem;
          }

          .prompt-desc {
            color: #7f8c8d;
            line-height: 1.6;
            margin-bottom: 2rem;
          }

          .start-analysis-btn {
            padding: 1rem 2rem;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
          }
        }
      }

      .nutrition-analysis {
        margin-bottom: 2rem;

        .analysis-main-layout {
          display: grid;
          grid-template-columns: 1.2fr 0.8fr;
          gap: 2rem;
          margin-bottom: 2rem;

          @media (max-width: 1200px) {
            grid-template-columns: 1fr;
            gap: 1.5rem;
          }
        }

        .analysis-left {
          .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 4px solid #3498db;

            .user-info-summary {
              flex: 1;

              .info-item {
                display: flex;
                align-items: center;
                margin-bottom: 0.8rem;

                .info-label {
                  color: #7f8c8d;
                  margin-right: 0.5rem;
                  font-weight: 500;
                }

                .info-value {
                  color: #2c3e50;
                  font-weight: 600;
                  margin-right: 0.5rem;
                }

                .bmi-status {
                  padding: 0.2rem 0.8rem;
                  border-radius: 12px;
                  font-size: 0.8rem;
                  font-weight: 600;

                  &.normal {
                    background: #d4edda;
                    color: #155724;
                  }

                  &.underweight {
                    background: #fff3cd;
                    color: #856404;
                  }

                  &.overweight {
                    background: #f8d7da;
                    color: #721c24;
                  }

                  &.obese {
                    background: #f5c6cb;
                    color: #721c24;
                  }
                }
              }
            }

            .edit-data-btn {
              border-radius: 20px;
              padding: 0.5rem 1rem;
            }
          }

          .analysis-summary {
            display: flex;
            gap: 2rem;
            align-items: center;
            margin-bottom: 2rem;

            .score-circle {
              width: 120px;
              height: 120px;
              border-radius: 50%;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              flex-shrink: 0;

              .score-value {
                font-size: 2rem;
                font-weight: 700;
              }

              .score-label {
                font-size: 0.9rem;
                margin-top: 0.5rem;
              }
            }

            .analysis-details {
              flex: 1;

              .detail-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.8rem 0;
                border-bottom: 1px solid #ecf0f1;

                &:last-child {
                  border-bottom: none;
                }

                .detail-label {
                  color: #7f8c8d;
                  font-size: 0.9rem;
                }

                .detail-value {
                  font-weight: 600;
                  color: #2c3e50;
                }
              }
            }
          }

          .nutrients-chart {
            height: 350px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 1.2rem;
          }
        }

        .analysis-right {
          // å³ä¾§å†…å®¹æ›´ç´§å‡‘
          padding: 0;
          
          .section-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.8rem;
            padding-bottom: 0.3rem;
            border-bottom: 2px solid #e9ecef;

            &.warning {
              color: #e74c3c;
            }
          }

          .nutrition-recommendations,
          .health-insights,
          .risk-assessments,
          .improvement-suggestions {
            margin-bottom: 1.5rem;

            .recommendations-list,
            .insights-list,
            .risks-list,
            .improvements-list {
              .recommendation-item,
              .insight-item,
              .risk-item,
              .improvement-item {
                display: flex;
                align-items: flex-start;
                gap: 0.6rem;
                padding: 0.8rem;
                margin-bottom: 0.6rem;
                border-radius: 8px;
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                transition: all 0.3s ease;
                font-size: 0.9rem;
                line-height: 1.4;

                &:hover {
                  background: #e9ecef;
                  transform: translateY(-1px);
                  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                }

                .recommendation-icon,
                .insight-icon,
                .risk-icon,
                .improvement-icon {
                  font-size: 1rem;
                  margin-top: 0.05rem;
                  flex-shrink: 0;
                }

                .recommendation-text,
                .insight-text,
                .risk-text,
                .improvement-text {
                  color: #2c3e50;
                  line-height: 1.4;
                  font-size: 0.85rem;
                }
              }

              .ai-recommendation {
                background: linear-gradient(135deg, #e3f2fd 0%, #e8f5e8 100%);
                border: 1px solid #81c784;
              }

              .risk-item {
                background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
                border: 1px solid #e57373;
              }
            }
          }
        }

        .analysis-actions {
          text-align: center;
          padding-top: 2rem;
          border-top: 1px solid #e9ecef;
        }
      }

      // BMIçŠ¶æ€æ ·å¼
      .bmi-status {
        margin-left: 0.5rem;
        padding: 0.3rem 0.8rem;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;

        &.normal {
        background: #d4edda;
        color: #155724;
      }

      &.underweight {
        background: #fff3cd;
        color: #856404;
      }

      &.overweight {
        background: #f8d7da;
        color: #721c24;
      }

      &.obese {
        background: #f5c6cb;
        color: #721c24;
      }
    }
  }

  .edit-data-btn {
    border-radius: 20px;
    padding: 0.5rem 1rem;
  }

  .analysis-summary {
    display: flex;
    gap: 2rem;
    align-items: center;
    margin-bottom: 2rem;

    .score-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;

      .score-value {
        font-size: 2rem;
        font-weight: 700;
      }

      .score-label {
        font-size: 0.9rem;
        margin-top: 0.5rem;
      }
    }

    .analysis-details {
      flex: 1;

      .detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.8rem 0;
        border-bottom: 1px solid #ecf0f1;

        &:last-child {
          border-bottom: none;
        }

        .detail-label {
          color: #7f8c8d;
        }

        .detail-value {
          font-weight: 600;
          color: #2c3e50;
        }
      }
    }
  }

  .nutrients-chart {
    height: 300px;
    background: #f8f9fa;
    border-radius: 15px;
    padding: 1rem;
  }

  .nutrition-recommendations {
    margin-bottom: 2rem;

    .recommendations-list {
      .recommendation-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 0.8rem;

        &.ai-recommendation {
          background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
          border-left: 4px solid #2196f3;
        }

        .recommendation-icon {
          font-size: 1.2rem;
        }

        .recommendation-text {
          flex: 1;
          color: #2c3e50;
          line-height: 1.5;
        }
      }
    }
  }

  .health-insights,
  .risk-assessments,
  .improvement-suggestions {
    margin-bottom: 2rem;

    .insights-list,
    .risks-list,
    .improvements-list {
      .insight-item,
      .risk-item,
      .improvement-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 0.8rem;

        .insight-icon,
        .risk-icon,
        .improvement-icon {
          font-size: 1.2rem;
        }

        .insight-text,
        .risk-text,
        .improvement-text {
          flex: 1;
          color: #2c3e50;
          line-height: 1.5;
        }
      }

      .risk-item {
        background: #fff3cd;
        border-left: 4px solid #ffc107;

        .risk-text {
          color: #856404;
        }
      }

      .improvement-item {
        background: #d1ecf1;
        border-left: 4px solid #17a2b8;

        .improvement-text {
          color: #0c5460;
        }
      }
    }
  }

  .analysis-actions {
    text-align: center;
    padding-top: 2rem;
    border-top: 1px solid #e9ecef;

    .el-button {
      border-radius: 25px;
      padding: 0.8rem 2rem;
      font-weight: 600;
    }
  }

  .deficiencies-section,
  .excesses-section {
    margin-top: 2rem;

    .deficiencies-tags,
    .excesses-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      margin-top: 1rem;

      .deficiency-tag,
      .excess-tag {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
      }
    }
  }

  .food-groups-card {
    grid-column: 1 / -1;

    .food-groups-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.2rem;
    }

    .food-group-item {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 1.2rem;
      border-left: 4px solid #27ae60;

      .group-header {
        margin-bottom: 0.8rem;

        .group-name {
          font-size: 1.1rem;
          font-weight: 600;
          color: #2c3e50;
          margin-bottom: 0.4rem;
        }

        .group-amount {
          font-size: 1rem;
          font-weight: 600;
          color: #27ae60;

          .amount-range {
            font-size: 0.85rem;
            color: #7f8c8d;
            font-weight: normal;
          }
        }
      }

      .group-examples {
        margin-bottom: 0.8rem;

        .examples-label {
          font-weight: 600;
          color: #34495e;
          margin-bottom: 0.4rem;
          font-size: 0.9rem;
        }

        .examples-list {
          display: flex;
          flex-wrap: wrap;
          gap: 0.4rem;

          .example-tag {
            background: #ecf0f1;
            color: #2c3e50;
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.8rem;
          }
        }
      }

      .nutrition-focus {
        .focus-label {
          font-weight: 600;
          color: #34495e;
          margin-bottom: 0.5rem;
        }

        .focus-list {
          color: #7f8c8d;
          font-size: 0.9rem;
          line-height: 1.5;
        }
      }
    }
  }

  .seasonal-card {
    .seasonal-content {
      .season-info {
        text-align: center;
        margin-bottom: 1.5rem;

        .season-badge {
          display: inline-block;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          padding: 0.6rem 1.5rem;
          border-radius: 20px;
          font-weight: 600;
          font-size: 1rem;
          margin-bottom: 0.8rem;
        }

        .season-benefit {
          color: #7f8c8d;
          font-style: italic;
          font-size: 0.9rem;
        }
      }

      .seasonal-foods {
        margin-bottom: 1.2rem;

        .foods-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(85px, 1fr));
          gap: 0.6rem;

          .food-item {
            background: #f8f9fa;
            padding: 0.6rem 0.4rem;
            border-radius: 8px;
            text-align: center;
            color: #2c3e50;
            font-weight: 500;
            font-size: 0.9rem;
            transition: background 0.3s ease;

            &:hover {
              background: #e9ecef;
            }
          }
        }
      }

      .seasonal-recipes {
        .recipes-list {
          display: grid;
          grid-template-columns: 1fr;
          gap: 0.6rem;

          .recipe-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: #f8f9fa;
            padding: 0.6rem 0.8rem;
            border-radius: 8px;
            transition: background 0.3s ease;
            font-size: 0.85rem;

            &:hover {
              background: #e9ecef;
            }

            .recipe-icon {
              font-size: 1.2rem;
            }

            .recipe-name {
              color: #2c3e50;
              font-weight: 500;
            }
          }
        }
      }
    }
  }

  .tcm-constitution-card {
    .tcm-prompt {
      text-align: center;
      padding: 3rem 2rem;
      background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
      border-radius: 20px;
      border: 2px dashed #ffb74d;

      .prompt-content {
        max-width: 500px;
        margin: 0 auto;

        .prompt-icon {
          font-size: 4rem;
          margin-bottom: 1rem;
          opacity: 0.8;
        }

        .prompt-title {
          font-size: 1.5rem;
          font-weight: 600;
          color: #2c3e50;
          margin-bottom: 1rem;
        }

        .prompt-desc {
          color: #7f8c8d;
          line-height: 1.6;
          margin-bottom: 2rem;
        }

        .start-analysis-btn {
          padding: 1rem 2rem;
          border-radius: 25px;
          font-size: 1.1rem;
          font-weight: 600;
        }
      }
    }

    .tcm-analysis-content {
      .constitution-analysis {
        .constitution-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
          padding: 1.5rem;
          background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
          border-radius: 15px;
          border-left: 4px solid #ff9800;

          .constitution-main {
            flex: 1;

            .constitution-type {
              display: flex;
              align-items: center;
              gap: 1rem;
              margin-bottom: 0.5rem;

              .constitution-name {
                font-size: 1.5rem;
                font-weight: 700;
                color: #e65100;
              }

              .constitution-confidence {
                padding: 0.3rem 1rem;
                background: #4caf50;
                color: white;
                border-radius: 20px;
                font-size: 0.9rem;
                font-weight: 600;
              }
            }

            .secondary-constitution {
              color: #7f8c8d;
              font-size: 0.95rem;
            }
          }

          .health-score {
            .score-circle {
              width: 100px;
              height: 100px;
              border-radius: 50%;
              background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
              color: white;
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;

              .score-value {
                font-size: 1.8rem;
                font-weight: 700;
              }

              .score-label {
                font-size: 0.8rem;
                margin-top: 0.3rem;
              }
            }
          }
        }

        .constitution-characteristics {
          margin-bottom: 2rem;

          .subsection-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
          }

          .characteristics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;

            .characteristic-item {
              display: flex;
              align-items: center;
              gap: 0.8rem;
              padding: 1rem;
              background: #f8f9fa;
              border-radius: 12px;
              border: 1px solid #e9ecef;

              .characteristic-icon {
                color: #4caf50;
                font-weight: 600;
              }

              .characteristic-text {
                color: #2c3e50;
                font-size: 0.95rem;
              }
            }
          }
        }

        .dietary-guidance {
          margin-bottom: 2rem;

          .subsection-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
          }

          .guidance-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;

            .guidance-section {
              .guidance-title {
                font-size: 1rem;
                font-weight: 600;
                color: #2c3e50;
                margin-bottom: 1rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
              }

              .guidance-list {
                .guidance-item {
                  display: flex;
                  align-items: flex-start;
                  gap: 0.8rem;
                  padding: 1rem;
                  margin-bottom: 0.8rem;
                  border-radius: 12px;
                  background: #f8f9fa;
                  border: 1px solid #e9ecef;
                  transition: all 0.3s ease;

                  &:hover {
                    background: #e9ecef;
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                  }

                  .guidance-icon {
                    font-size: 1.2rem;
                    margin-top: 0.1rem;
                    flex-shrink: 0;
                  }

                  .guidance-text {
                    color: #2c3e50;
                    line-height: 1.5;
                    font-size: 0.95rem;
                  }
                }
              }
            }
          }
        }

        .tcm-ai-insights {
          margin-bottom: 2rem;

          .subsection-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
          }

          .insights-list {
            .insight-item {
              display: flex;
              align-items: flex-start;
              gap: 0.8rem;
              padding: 1rem;
              margin-bottom: 0.8rem;
              border-radius: 12px;
              background: linear-gradient(135deg, #e3f2fd 0%, #e8f5e8 100%);
              border: 1px solid #81c784;
              transition: all 0.3s ease;

              &:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
              }

              .insight-icon {
                font-size: 1.2rem;
                margin-top: 0.1rem;
                flex-shrink: 0;
              }

              .insight-text {
                color: #2c3e50;
                line-height: 1.5;
                font-size: 0.95rem;
              }
            }
          }
        }

        .health-warnings {
          margin-bottom: 2rem;

          .subsection-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #e74c3c;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
          }

          .warnings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;

            .warning-item {
              display: flex;
              align-items: center;
              gap: 0.8rem;
              padding: 1rem;
              background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
              border-radius: 12px;
              border: 1px solid #e57373;

              .warning-icon {
                color: #e74c3c;
                font-size: 1.2rem;
              }

              .warning-text {
                color: #2c3e50;
                font-size: 0.95rem;
              }
            }
          }
        }
      }

      .tcm-loading {
        text-align: center;
        padding: 3rem 2rem;

        .loading-content {
          .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ff9800;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
          }

          .loading-text {
            color: #7f8c8d;
            font-size: 1.1rem;
          }
        }
      }

      .tcm-analysis-actions {
        text-align: center;
        padding-top: 2rem;
        border-top: 1px solid #e9ecef;
        display: flex;
        gap: 1rem;
        justify-content: center;
      }
    }
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }
  .tcm-content {
    .constitution-result {
      display: flex;
      gap: 2rem;
      align-items: center;
      margin-bottom: 2rem;

      .constitution-badge {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        color: #d35400;
        padding: 1rem 2rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 1.2rem;
        text-align: center;
        flex-shrink: 0;
      }

      .constitution-chart {
        flex: 1;
        height: 200px;
      }
    }

    .tcm-recommendations {
      margin-bottom: 2rem;

      .tcm-rec-list {
        .tcm-rec-item {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          background: #f8f9fa;
          border-radius: 10px;
          margin-bottom: 0.8rem;

          .tcm-icon {
            font-size: 1.2rem;
          }

          .tcm-text {
            flex: 1;
            color: #2c3e50;
            line-height: 1.5;
          }
        }
      }
    }

    .tcm-warnings {
      .warning-list {
        .warning-item {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          background: #fff3cd;
          border-radius: 10px;
          border-left: 4px solid #f39c12;
          margin-bottom: 0.8rem;

          .warning-icon {
            font-size: 1.2rem;
          }

          .warning-text {
            flex: 1;
            color: #d68910;
            line-height: 1.5;
          }
        }
      }
    }
  }

  .ai-report-card {
    .ai-report-content {
      .report-summary {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-bottom: 2rem;

        .summary-item {
          text-align: center;
          background: #f8f9fa;
          padding: 1.5rem;
          border-radius: 15px;

          .summary-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
          }

          .summary-value {
            font-size: 2rem;
            font-weight: 700;
            color: #3498db;
          }
        }
      }

      .ai-insights {
        margin-bottom: 2rem;

        .insights-list {
          .insight-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 0.8rem;

            .insight-icon {
              font-size: 1.2rem;
            }

            .insight-text {
              flex: 1;
              color: #2c3e50;
              line-height: 1.5;
            }
          }
        }
      }

      .generate-report-btn {
        width: 100%;
        padding: 1rem 2rem;
        border-radius: 25px;
        font-size: 1.1rem;
        font-weight: 600;
      }
    }
  }

  .guidelines-dialog {
    .full-guidelines {
      max-height: 60vh;
      overflow-y: auto;

      .guideline-detail {
        margin-bottom: 2rem;
        padding-bottom: 2rem;
        border-bottom: 1px solid #ecf0f1;

        &:last-child {
          border-bottom: none;
        }

        .detail-title {
          color: #2c3e50;
          font-size: 1.3rem;
          font-weight: 600;
          margin-bottom: 1rem;
        }

        .detail-description {
          color: #7f8c8d;
          line-height: 1.6;
          margin-bottom: 1rem;
        }

        .detail-recommendations {
          li {
            color: #34495e;
            line-height: 1.6;
            margin-bottom: 0.5rem;
          }
        }
      }
    }
  }

  .user-form-dialog {
    .el-dialog__body {
      padding: 0;
    }
  }

  @media (max-width: 768px) {
    .analytics-view {
      padding: 1rem 0;

      .analytics-dashboard {
        grid-template-columns: 1fr;
      }

      .analytics-card {
        padding: 1.5rem;

        .card-title {
          font-size: 1.3rem;
        }
      }

      .nutrition-card {
        .analysis-summary {
          flex-direction: column;
          text-align: center;
        }
      }

      .food-groups-grid {
        grid-template-columns: 1fr !important;
      }

      .tcm-card .constitution-result {
        flex-direction: column;
      }

      .ai-report-card .report-summary {
        grid-template-columns: 1fr;
      }

    // é‡æ„åçš„è¥å…»åˆ†ææ ·å¼ - å¢å¼ºç‰ˆ
    .nutrition-analysis-redesigned {
      max-width: 1400px;
      margin: 0 auto;
      padding: 1rem;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      
      .analysis-container {
        display: flex;
        flex-direction: column;
        gap: 2rem;
      }

      // é€šç”¨å¡ç‰‡æ ·å¼ - å¢å¼ºç‰ˆ
      .user-info-card,
      .nutrition-overview-card,
      .chart-card,
      .ai-analysis-card,
      .action-card {
        background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 
          0 10px 40px rgba(0, 0, 0, 0.1),
          0 4px 25px rgba(0, 0, 0, 0.05),
          inset 0 1px 0 rgba(255, 255, 255, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;

        &::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 4px;
          background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
          border-radius: 20px 20px 0 0;
        }

        &:hover {
          transform: translateY(-8px) scale(1.02);
          box-shadow: 
            0 20px 60px rgba(0, 0, 0, 0.15),
            0 8px 40px rgba(0, 0, 0, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.9);
        }

        .card-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
          padding-bottom: 1rem;
          border-bottom: 3px solid transparent;
          background: linear-gradient(90deg, #e3f2fd, #f3e5f5) padding-box,
                      linear-gradient(90deg, #2196f3, #9c27b0) border-box;
          border-radius: 10px;

          .card-title {
            font-size: 1.4rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          }
        }
      }

      // é¡¶éƒ¨åŒºåŸŸå¢å¼º
      .top-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;

        @media (max-width: 768px) {
          grid-template-columns: 1fr;
          gap: 1.5rem;
        }
      }

      // ç”¨æˆ·ä¿¡æ¯å¡ç‰‡å¢å¼º - å‚è€ƒé£Ÿç‰©åˆ†ç»„æ ·å¼
      .user-info-card {
        &::before {
          background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
        }

        .edit-btn {
          border-radius: 20px;
          font-size: 0.875rem;
          padding: 0.6rem 1.2rem;
          background: #3498db;
          border: none;
          color: white;
          font-weight: 600;
          transition: all 0.3s ease;

          &:hover {
            background: #2980b9;
            transform: translateY(-1px);
          }
        }

        .user-details {
          display: flex;
          flex-direction: column;
          gap: 1rem;

          .detail-row {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            transition: all 0.3s ease;

            &:nth-child(2) {
              border-left-color: #27ae60;
            }

            &:nth-child(3) {
              border-left-color: #f39c12;
            }

            &:hover {
              background: #ffffff;
              transform: translateX(4px);
            }

            .label {
              font-weight: 600;
              color: #34495e;
              min-width: 70px;
              font-size: 0.9rem;
            }

            .value {
              font-weight: 600;
              color: #2c3e50;
              flex: 1;
              font-size: 1rem;
            }

            .status-badge {
              padding: 0.3rem 0.8rem;
              border-radius: 15px;
              font-size: 0.8rem;
              font-weight: 600;

              &.normal {
                background: #d4edda;
                color: #155724;
              }

              &.overweight {
                background: #fff3cd;
                color: #856404;
              }

              &.obese {
                background: #f8d7da;
                color: #721c24;
              }

              &.underweight {
                background: #cce7ff;
                color: #004085;
              }
            }
          }
        }
      }

      // è¥å…»æ¦‚è§ˆå¡ç‰‡å¢å¼º
      .nutrition-overview-card {
        &::before {
          background: linear-gradient(90deg, #a8edea 0%, #fed6e3 100%);
        }

        .confidence-score {
          display: flex;
          align-items: center;
          gap: 1rem;

          .score-circle {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            color: white;
            box-shadow: 
              0 8px 32px rgba(102, 126, 234, 0.3),
              inset 0 2px 8px rgba(255, 255, 255, 0.2);
            position: relative;

            &::before {
              content: '';
              position: absolute;
              top: -4px;
              left: -4px;
              right: -4px;
              bottom: -4px;
              background: linear-gradient(135deg, #667eea, #764ba2, #f093fb, #f5576c);
              border-radius: 50%;
              z-index: -1;
              animation: rotate 3s linear infinite;
            }

            .score-number {
              font-size: 1.5rem;
              font-weight: 800;
              line-height: 1;
            }

            .score-unit {
              font-size: 0.8rem;
              opacity: 0.9;
              font-weight: 600;
            }
          }

          .score-label {
            font-size: 1rem;
            font-weight: 600;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
          }
        }

        .nutrition-data {
          .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.2rem;

            .data-item {
              display: flex;
              flex-direction: column;
              gap: 0.8rem;
              padding: 1.2rem;
              background: #f8f9fa;
              border-radius: 12px;
              border-left: 4px solid #27ae60;
              transition: all 0.3s ease;
              position: relative;

              &:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
                background: #ffffff;
              }

              &:nth-child(1) {
                border-left-color: #3498db;
              }

              &:nth-child(2) {
                border-left-color: #27ae60;
              }

              &:nth-child(3) {
                border-left-color: #e74c3c;
              }

              &:nth-child(4) {
                border-left-color: #f39c12;
              }

              .data-label {
                font-size: 0.9rem;
                color: #34495e;
                font-weight: 600;
                margin-bottom: 0.4rem;
              }

              .data-value {
                font-size: 1.25rem;
                font-weight: 700;
                color: #2c3e50;

                &.highlight {
                  color: #3498db;
                }
              }
            }
          }
        }
      }

      // ä¸­é—´åŒºåŸŸå¢å¼º - æ”¹ä¸ºå•åˆ—å¸ƒå±€
      .middle-section {
        margin-bottom: 2rem;
        display: flex;
        justify-content: center;

        .chart-card {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          border-radius: 16px;
          box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
          padding: 1.5rem;
          backdrop-filter: blur(10px);
          border: 1px solid rgba(255, 255, 255, 0.1);
          max-width: 600px;
          width: 100%;

          .card-header {
            margin-bottom: 1rem;
            .card-title {
              color: white;
              font-size: 1.5rem;
              font-weight: 600;
              margin: 0;
              text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            }
          }
        }

        @media (max-width: 968px) {
          .chart-card {
            max-width: 100%;
          }
        }
      }

      // AIåˆ†æåŒºåŸŸ - ç‹¬ç«‹çš„å…¨å®½åº¦åŒºåŸŸ
      .ai-analysis-section {
        margin-bottom: 2rem;

        .ai-analysis-card {
          background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
          border-radius: 16px;
          box-shadow: 0 8px 32px rgba(240, 147, 251, 0.3);
          padding: 1.5rem;
          backdrop-filter: blur(10px);
          border: 1px solid rgba(255, 255, 255, 0.1);

          .card-header {
            margin-bottom: 1.5rem;
            .card-title {
              color: white;
              font-size: 1.5rem;
              font-weight: 600;
              margin: 0;
              text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            }
          }

          .ai-modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            align-items: start;
          }

          .ai-module {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;

            &:hover {
              transform: translateY(-4px);
              box-shadow: 0 8px 40px rgba(0, 0, 0, 0.15);
            }

            // ä¸»é¢˜é¢œè‰²å®šä¹‰ - 8ç§ä¸åŒçš„é¢œè‰²ä¸»é¢˜
            &.theme-green {
              border-top: 4px solid #27ae60;
              .module-header {
                background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
                .module-title { color: #27ae60; }
                .module-badge { 
                  background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
                  color: white;
                }
              }
              &:hover {
                box-shadow: 0 8px 40px rgba(39, 174, 96, 0.2);
              }
            }

            &.theme-blue {
              border-top: 4px solid #3498db;
              .module-header {
                background: linear-gradient(135deg, #e3f2fd 0%, #d1ecf1 100%);
                .module-title { color: #3498db; }
                .module-badge { 
                  background: linear-gradient(135deg, #3498db 0%, #74b9ff 100%);
                  color: white;
                }
              }
              &:hover {
                box-shadow: 0 8px 40px rgba(52, 152, 219, 0.2);
              }
            }

            &.theme-orange {
              border-top: 4px solid #e67e22;
              .module-header {
                background: linear-gradient(135deg, #fff3e0 0%, #ffeaa7 100%);
                .module-title { color: #e67e22; }
                .module-badge { 
                  background: linear-gradient(135deg, #e67e22 0%, #f39c12 100%);
                  color: white;
                }
              }
              &:hover {
                box-shadow: 0 8px 40px rgba(230, 126, 34, 0.2);
              }
            }

            &.theme-purple {
              border-top: 4px solid #9b59b6;
              .module-header {
                background: linear-gradient(135deg, #f3e5f5 0%, #e8d5e8 100%);
                .module-title { color: #9b59b6; }
                .module-badge { 
                  background: linear-gradient(135deg, #9b59b6 0%, #a29bfe 100%);
                  color: white;
                }
              }
              &:hover {
                box-shadow: 0 8px 40px rgba(155, 89, 182, 0.2);
              }
            }

            &.theme-cyan {
              border-top: 4px solid #1abc9c;
              .module-header {
                background: linear-gradient(135deg, #e0f2f1 0%, #b2dfdb 100%);
                .module-title { color: #1abc9c; }
                .module-badge { 
                  background: linear-gradient(135deg, #1abc9c 0%, #00cec9 100%);
                  color: white;
                }
              }
              &:hover {
                box-shadow: 0 8px 40px rgba(26, 188, 156, 0.2);
              }
            }

            &.theme-pink {
              border-top: 4px solid #e91e63;
              .module-header {
                background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%);
                .module-title { color: #e91e63; }
                .module-badge { 
                  background: linear-gradient(135deg, #e91e63 0%, #fd79a8 100%);
                  color: white;
                }
              }
              &:hover {
                box-shadow: 0 8px 40px rgba(233, 30, 99, 0.2);
              }
            }

            &.theme-indigo {
              border-top: 4px solid #6c5ce7;
              .module-header {
                background: linear-gradient(135deg, #e8eaf6 0%, #ddd6fe 100%);
                .module-title { color: #6c5ce7; }
                .module-badge { 
                  background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
                  color: white;
                }
              }
              &:hover {
                box-shadow: 0 8px 40px rgba(108, 92, 231, 0.2);
              }
            }

            &.theme-yellow {
              border-top: 4px solid #f39c12;
              .module-header {
                background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
                .module-title { color: #f39c12; }
                .module-badge { 
                  background: linear-gradient(135deg, #f39c12 0%, #fdcb6e 100%);
                  color: white;
                }
              }
              &:hover {
                box-shadow: 0 8px 40px rgba(243, 156, 18, 0.2);
              }
            }

            .module-header {
              padding: 1rem 1.5rem;
              border-bottom: 1px solid rgba(0, 0, 0, 0.05);
              display: flex;
              align-items: center;
              gap: 0.75rem;
              position: relative;

              .module-icon {
                font-size: 1.5rem;
                flex-shrink: 0;
              }

              .module-title {
                font-size: 1.1rem;
                font-weight: 600;
                margin: 0;
                flex: 1;
              }

              .module-badge {
                padding: 0.4rem 0.8rem;
                border-radius: 20px;
                font-size: 0.75rem;
                font-weight: 600;
                color: white;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                backdrop-filter: blur(4px);
                transition: all 0.3s ease;

                &:hover {
                  transform: scale(1.05);
                  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
                }

                &.warning {
                  background: linear-gradient(135deg, #e67e22 0%, #f39c12 100%);
                }

                &.success {
                  background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
                }

                &.info {
                  background: linear-gradient(135deg, #3498db 0%, #74b9ff 100%);
                }
              }
            }

            .module-content {
              padding: 1.5rem;

              // é€šç”¨åˆ—è¡¨æ ·å¼
              .recommendations-list,
              .insights-list,
              .risks-list,
              .improvements-list {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;

                .recommendation-item,
                .insight-item,
                .risk-item,
                .improvement-item {
                  display: flex;
                  align-items: flex-start;
                  gap: 0.75rem;
                  padding: 0.75rem;
                  background: rgba(255, 255, 255, 0.8);
                  border-radius: 8px;
                  border-left: 4px solid #667eea;
                  transition: all 0.3s ease;
                  position: relative;
                  overflow: hidden;

                  &::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
                    opacity: 0;
                    transition: opacity 0.3s ease;
                  }

                  &:hover {
                    background: rgba(255, 255, 255, 0.95);
                    transform: translateX(4px) translateY(-2px);
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                    
                    &::before {
                      opacity: 1;
                    }
                  }

                  .item-icon {
                    font-size: 1.1rem;
                    margin-top: 0.1rem;
                    flex-shrink: 0;
                    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
                  }

                  .item-text {
                    flex: 1;
                    font-size: 0.9rem;
                    line-height: 1.5;
                    color: #2c3e50;
                    font-weight: 500;
                  }
                }

                .risk-item {
                  border-left-color: #e74c3c;
                  background: rgba(231, 76, 60, 0.05);
                  
                  &:hover {
                    background: rgba(231, 76, 60, 0.1);
                    border-left-color: #c0392b;
                  }
                }

                .improvement-item {
                  border-left-color: #27ae60;
                  background: rgba(39, 174, 96, 0.05);
                  
                  &:hover {
                    background: rgba(39, 174, 96, 0.1);
                    border-left-color: #229954;
                  }
                }

                .insight-item {
                  border-left-color: #f39c12;
                  background: rgba(243, 156, 18, 0.05);
                  
                  &:hover {
                    background: rgba(243, 156, 18, 0.1);
                    border-left-color: #e67e22;
                  }
                }

                .recommendation-item {
                  border-left-color: #27ae60;
                  background: rgba(39, 174, 96, 0.05);
                  
                  &:hover {
                    background: rgba(39, 174, 96, 0.1);
                    border-left-color: #229954;
                  }
                }
              }

              // è¥å…»çŠ¶æ€ç›‘æµ‹ç‰¹æ®Šæ ·å¼
              .status-metrics {
                display: flex;
                flex-direction: column;
                gap: 1rem;

                .metric-item {
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  padding: 1rem;
                  background: linear-gradient(135deg, rgba(26, 188, 156, 0.08) 0%, rgba(26, 188, 156, 0.12) 100%);
                  border-radius: 12px;
                  border-left: 4px solid #1abc9c;
                  border: 1px solid rgba(26, 188, 156, 0.1);
                  transition: all 0.3s ease;
                  position: relative;
                  overflow: hidden;

                  &::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 2px;
                    background: linear-gradient(90deg, #1abc9c, #16a085, #1abc9c);
                    opacity: 0;
                    transition: opacity 0.3s ease;
                  }

                  &:hover {
                    background: linear-gradient(135deg, rgba(26, 188, 156, 0.15) 0%, rgba(26, 188, 156, 0.2) 100%);
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(26, 188, 156, 0.2);
                    
                    &::before {
                      opacity: 1;
                    }
                  }

                  .metric-label {
                    font-size: 0.9rem;
                    color: #2c3e50;
                    font-weight: 500;
                  }

                  .metric-value {
                    font-size: 1.1rem;
                    font-weight: 700;
                    color: #1abc9c;
                    text-shadow: 0 1px 2px rgba(26, 188, 156, 0.2);
                  }
                }
              }

              // è†³é£Ÿæ­é…ä¼˜åŒ–æ ·å¼
              .optimization-suggestions {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;

                .suggestion-item {
                  display: flex;
                  align-items: flex-start;
                  gap: 0.75rem;
                  padding: 0.75rem;
                  background: linear-gradient(135deg, rgba(233, 30, 99, 0.05) 0%, rgba(233, 30, 99, 0.08) 100%);
                  border-radius: 8px;
                  border-left: 4px solid #e91e63;
                  transition: all 0.3s ease;
                  position: relative;
                  overflow: hidden;

                  &::after {
                    content: 'â†’';
                    position: absolute;
                    top: 50%;
                    right: 1rem;
                    transform: translateY(-50%);
                    font-size: 1.2rem;
                    color: #e91e63;
                    opacity: 0;
                    transition: all 0.3s ease;
                  }

                  &:hover {
                    background: linear-gradient(135deg, rgba(233, 30, 99, 0.12) 0%, rgba(233, 30, 99, 0.16) 100%);
                    transform: translateX(4px) translateY(-2px);
                    box-shadow: 0 4px 12px rgba(233, 30, 99, 0.2);
                    
                    &::after {
                      opacity: 1;
                      transform: translateY(-50%) translateX(4px);
                    }
                  }

                  .suggestion-icon {
                    font-size: 1.5rem;
                    flex-shrink: 0;
                    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
                  }

                  .suggestion-text {
                    flex: 1;
                    font-size: 0.9rem;
                    line-height: 1.5;
                    color: #2c3e50;
                    font-weight: 500;
                  }
                }
              }

              // å¥åº·è¶‹åŠ¿åˆ†ææ ·å¼
              .trend-items {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;

                .trend-item {
                  display: flex;
                  align-items: flex-start;
                  gap: 0.75rem;
                  padding: 0.75rem;
                  border-radius: 8px;
                  border-left: 4px solid #6c5ce7;
                  transition: all 0.3s ease;
                  position: relative;
                  overflow: hidden;

                  &.positive {
                    background: linear-gradient(135deg, rgba(39, 174, 96, 0.05) 0%, rgba(39, 174, 96, 0.08) 100%);
                    border-left-color: #27ae60;
                    
                    &:hover {
                      background: linear-gradient(135deg, rgba(39, 174, 96, 0.12) 0%, rgba(39, 174, 96, 0.16) 100%);
                    }
                  }

                  &.stable {
                    background: linear-gradient(135deg, rgba(52, 152, 219, 0.05) 0%, rgba(52, 152, 219, 0.08) 100%);
                    border-left-color: #3498db;
                    
                    &:hover {
                      background: linear-gradient(135deg, rgba(52, 152, 219, 0.12) 0%, rgba(52, 152, 219, 0.16) 100%);
                    }
                  }

                  &.attention {
                    background: linear-gradient(135deg, rgba(243, 156, 18, 0.05) 0%, rgba(243, 156, 18, 0.08) 100%);
                    border-left-color: #f39c12;
                    
                    &:hover {
                      background: linear-gradient(135deg, rgba(243, 156, 18, 0.12) 0%, rgba(243, 156, 18, 0.16) 100%);
                    }
                  }

                  &:hover {
                    transform: translateX(4px) translateY(-2px);
                    box-shadow: 0 4px 12px rgba(108, 92, 231, 0.2);
                  }

                  .trend-icon {
                    font-size: 1.2rem;
                    flex-shrink: 0;
                    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
                  }

                  .trend-text {
                    flex: 1;
                    font-size: 0.9rem;
                    line-height: 1.5;
                    color: #2c3e50;
                    font-weight: 500;
                  }
                }
              }
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(26, 188, 156, 0.2);
                    background: linear-gradient(135deg, rgba(26, 188, 156, 0.12) 0%, rgba(26, 188, 156, 0.16) 100%);
                    
                    &::before {
                      opacity: 1;
                    }
                  }

                  .metric-label {
                    font-size: 0.9rem;
                    color: #2c3e50;
                    font-weight: 600;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;

                    &::before {
                      content: 'ğŸ“Š';
                      font-size: 1rem;
                    }
                  }

                  .metric-value {
                    font-size: 1.1rem;
                    font-weight: 700;
                    color: #1abc9c;
                    background: linear-gradient(135deg, #1abc9c, #16a085);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                    text-shadow: 0 1px 2px rgba(26, 188, 156, 0.2);
                  }
                }
              }

              // è†³é£Ÿæ­é…ä¼˜åŒ–æ ·å¼
              .optimization-suggestions {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;

                .suggestion-item {
                  display: flex;
                  align-items: flex-start;
                  gap: 0.75rem;
                  padding: 1rem;
                  background: linear-gradient(135deg, rgba(233, 30, 99, 0.08) 0%, rgba(233, 30, 99, 0.12) 100%);
                  border-radius: 12px;
                  border-left: 4px solid #e91e63;
                  border: 1px solid rgba(233, 30, 99, 0.1);
                  transition: all 0.3s ease;
                  position: relative;

                  &::after {
                    content: '';
                    position: absolute;
                    top: 50%;
                    right: 1rem;
                    transform: translateY(-50%);
                    width: 6px;
                    height: 6px;
                    background: #e91e63;
                    border-radius: 50%;
                    opacity: 0;
                    transition: all 0.3s ease;
                  }

                  &:hover {
                    transform: translateX(4px) translateY(-2px);
                    box-shadow: 0 4px 12px rgba(233, 30, 99, 0.2);
                    background: linear-gradient(135deg, rgba(233, 30, 99, 0.12) 0%, rgba(233, 30, 99, 0.16) 100%);
                    
                    &::after {
                      opacity: 1;
                      transform: translateY(-50%) scale(1.2);
                    }
                  }

                  .suggestion-icon {
                    font-size: 1.2rem;
                    flex-shrink: 0;
                    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
                  }

                  .suggestion-text {
                    flex: 1;
                    font-size: 0.9rem;
                    line-height: 1.5;
                    color: #2c3e50;
                    font-weight: 500;
                  }
                }
              }

              // å¥åº·è¶‹åŠ¿åˆ†ææ ·å¼
              .trend-items {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;

                .trend-item {
                  display: flex;
                  align-items: flex-start;
                  gap: 0.75rem;
                  padding: 1rem;
                  border-radius: 12px;
                  border-left: 4px solid #3f51b5;
                  transition: all 0.3s ease;
                  position: relative;
                  overflow: hidden;

                  &::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                  }

                  &:hover {
                    transform: translateY(-2px);
                    
                    &::before {
                      opacity: 1;
                    }
                  }

                  &.positive {
                    background: linear-gradient(135deg, rgba(76, 175, 80, 0.08) 0%, rgba(76, 175, 80, 0.12) 100%);
                    border-left-color: #4caf50;
                    border: 1px solid rgba(76, 175, 80, 0.1);
                    
                    &:hover {
                      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
                      background: linear-gradient(135deg, rgba(76, 175, 80, 0.12) 0%, rgba(76, 175, 80, 0.16) 100%);
                    }
                  }

                  &.stable {
                    background: linear-gradient(135deg, rgba(108, 92, 231, 0.08) 0%, rgba(108, 92, 231, 0.12) 100%);
                    border-left-color: #6c5ce7;
                    border: 1px solid rgba(108, 92, 231, 0.1);
                    
                    &:hover {
                      box-shadow: 0 4px 12px rgba(108, 92, 231, 0.2);
                      background: linear-gradient(135deg, rgba(108, 92, 231, 0.12) 0%, rgba(108, 92, 231, 0.16) 100%);
                    }
                  }

                  &.attention {
                    background: linear-gradient(135deg, rgba(255, 152, 0, 0.08) 0%, rgba(255, 152, 0, 0.12) 100%);
                    border-left-color: #ff9800;
                    border: 1px solid rgba(255, 152, 0, 0.1);
                    
                    &:hover {
                      box-shadow: 0 4px 12px rgba(255, 152, 0, 0.2);
                      background: linear-gradient(135deg, rgba(255, 152, 0, 0.12) 0%, rgba(255, 152, 0, 0.16) 100%);
                    }
                  }

                  .trend-icon {
                    font-size: 1.2rem;
                    flex-shrink: 0;
                    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
                  }

                  .trend-text {
                    flex: 1;
                    font-size: 0.9rem;
                    line-height: 1.5;
                    color: #2c3e50;
                    font-weight: 500;
                  }
                }
              }

              // ä¸ªæ€§åŒ–é£Ÿè°±æ¨èæ ·å¼
              .recipe-suggestions {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;

                .recipe-item {
                  display: flex;
                  align-items: center;
                  gap: 1rem;
                  padding: 1rem;
                  background: linear-gradient(135deg, rgba(243, 156, 18, 0.08) 0%, rgba(243, 156, 18, 0.12) 100%);
                  border-radius: 12px;
                  border-left: 4px solid #f39c12;
                  border: 1px solid rgba(243, 156, 18, 0.1);
                  transition: all 0.3s ease;
                  position: relative;

                  &::after {
                    content: 'â†’';
                    position: absolute;
                    top: 50%;
                    right: 1rem;
                    transform: translateY(-50%);
                    font-size: 1.2rem;
                    color: #f39c12;
                    opacity: 0;
                    transition: all 0.3s ease;
                  }

                  &:hover {
                    background: linear-gradient(135deg, rgba(243, 156, 18, 0.12) 0%, rgba(243, 156, 18, 0.16) 100%);
                    transform: translateX(4px) translateY(-2px);
                    box-shadow: 0 4px 12px rgba(243, 156, 18, 0.2);
                    
                    &::after {
                      opacity: 1;
                      transform: translateY(-50%) translateX(4px);
                    }
                  }

                  .recipe-icon {
                    font-size: 1.5rem;
                    flex-shrink: 0;
                    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
                  }

                  .recipe-info {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    gap: 0.25rem;

                    .recipe-name {
                      font-size: 1rem;
                      font-weight: 600;
                      color: #2c3e50;
                      margin-bottom: 0.25rem;
                    }

                    .recipe-desc {
                      font-size: 0.85rem;
                      color: #7f8c8d;
                      font-weight: 500;
                    }
                  }
                }
              }
            }
          }
        }

        // å›¾è¡¨å¡ç‰‡å¢å¼º
        .chart-card {
        .chart-container {
          display: flex;
          justify-content: center;
          align-items: center;
          min-height: 400px;
          background: radial-gradient(circle at center, rgba(102, 126, 234, 0.05) 0%, transparent 70%);
          border-radius: 15px;

          .nutrition-chart {
            max-width: 100%;
            height: auto;
            filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.1));
          }
        }
      }

      // åº•éƒ¨æ“ä½œåŒºåŸŸå¢å¼º
      .bottom-section {
        .action-card {
          text-align: center;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          
          &::before {
            background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
          }
          
          .regenerate-btn {
            padding: 1rem 3rem;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 50px;
            min-width: 250px;
            height: 60px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            color: #667eea;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
              0 8px 32px rgba(0, 0, 0, 0.2),
              inset 0 2px 8px rgba(255, 255, 255, 0.3);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);

            &:hover {
              transform: translateY(-4px) scale(1.05);
              box-shadow: 
                0 15px 50px rgba(0, 0, 0, 0.3),
                inset 0 2px 8px rgba(255, 255, 255, 0.4);
              background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            }

            &:active {
              transform: translateY(-2px) scale(1.02);
            }
          }
        }

        // å“åº”å¼è®¾è®¡å¢å¼º
        @media (max-width: 768px) {
          .nutrition-analysis-redesigned {
            padding: 1rem;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);

            .analysis-container {
              gap: 1.5rem;
            }

            .user-info-card,
            .nutrition-overview-card,
            .chart-card,
            .ai-analysis-card,
            .action-card {
              padding: 1.5rem;
              border-radius: 16px;
            }

            .ai-analysis-section {
              .ai-modules-grid {
                gap: 1.5rem;
                grid-template-columns: 1fr;
              }

              .ai-module {
                padding: 1.5rem;
              }
            }
          }
        }

      // åŠ¨ç”»æ•ˆæœ
      @keyframes rotate {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @keyframes float {
        0%, 100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      // ä¸ºä¸€äº›å…ƒç´ æ·»åŠ æµ®åŠ¨åŠ¨ç”»
      .chart-card {
        animation: float 6s ease-in-out infinite;
      }

      .user-info-card {
        animation: float 6s ease-in-out infinite 1s;
      }

      .nutrition-overview-card {
        animation: float 6s ease-in-out infinite 2s;
      }
    }

    // å››æ¨¡å—è¥å…»åˆ†ææ ·å¼
    .nutrition-analysis-modules {
      max-width: 1400px;
      margin: 0 auto;
      padding: 1rem;
      
      .modules-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
      }

      .analysis-module {
        background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 
          0 10px 40px rgba(0, 0, 0, 0.08),
          0 4px 25px rgba(0, 0, 0, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;

        &::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 4px;
          background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
          border-radius: 20px 20px 0 0;
        }

        &:hover {
          transform: translateY(-5px);
          box-shadow: 
            0 20px 60px rgba(0, 0, 0, 0.12),
            0 8px 40px rgba(0, 0, 0, 0.08);
        }

        .module-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
          padding-bottom: 1rem;
          border-bottom: 2px solid #f1f3f4;

          .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;

            .module-icon {
              font-size: 2rem;
              width: 60px;
              height: 60px;
              display: flex;
              align-items: center;
              justify-content: center;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              border-radius: 15px;
              color: white;
              box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            }

            .module-title {
              font-size: 1.5rem;
              font-weight: 700;
              color: #2c3e50;
              margin: 0;
            }
          }

          .edit-btn, .confidence-score, .balance-score, .ai-badge {
            .score-circle {
              display: flex;
              flex-direction: column;
              align-items: center;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              padding: 0.8rem;
              border-radius: 12px;
              min-width: 60px;

              .score-number {
                font-size: 1.2rem;
                font-weight: bold;
              }

              .score-unit {
                font-size: 0.8rem;
                opacity: 0.9;
              }
            }

            .score-label {
              font-size: 0.9rem;
              color: #7f8c8d;
              margin-top: 0.5rem;
            }

            .score-value {
              font-size: 1.2rem;
              font-weight: bold;
              color: #667eea;
            }

            .badge-text {
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              padding: 0.5rem 1rem;
              border-radius: 20px;
              font-size: 0.9rem;
              font-weight: 600;
            }
          }
        }

        .module-content {
          color: #2c3e50;
        }

        // ä¸ªäººä¿¡æ¯æ¨¡å—æ ·å¼
        &.personal-info-module {
          &::before {
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
          }

          .module-icon {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%) !important;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3) !important;
          }

          .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;

            .info-item {
              display: flex;
              align-items: center;
              gap: 1rem;
              padding: 1.5rem;
              background: linear-gradient(135deg, rgba(79, 172, 254, 0.05) 0%, rgba(0, 242, 254, 0.05) 100%);
              border-radius: 15px;
              border: 1px solid rgba(79, 172, 254, 0.1);
              transition: all 0.3s ease;

              &:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(79, 172, 254, 0.15);
                background: linear-gradient(135deg, rgba(79, 172, 254, 0.08) 0%, rgba(0, 242, 254, 0.08) 100%);
              }

              .info-icon {
                font-size: 1.8rem;
                width: 50px;
                height: 50px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                border-radius: 12px;
                color: white;
                box-shadow: 0 4px 12px rgba(79, 172, 254, 0.3);
              }

              .info-details {
                flex: 1;

                .info-label {
                  display: block;
                  font-size: 0.9rem;
                  color: #7f8c8d;
                  margin-bottom: 0.5rem;
                }

                .info-value {
                  font-size: 1.1rem;
                  font-weight: 600;
                  color: #2c3e50;

                  .status-badge {
                    margin-left: 0.5rem;
                    padding: 0.3rem 0.8rem;
                    border-radius: 15px;
                    font-size: 0.8rem;
                    font-weight: 500;

                    &.normal {
                      background: #d4edda;
                      color: #155724;
                    }

                    &.underweight {
                      background: #fff3cd;
                      color: #856404;
                    }

                    &.overweight, &.obese {
                      background: #f8d7da;
                      color: #721c24;
                    }
                  }
                }
              }
            }
          }
        }

        // è¥å…»æ¦‚è§ˆæ¨¡å—æ ·å¼
        &.nutrition-overview-module {
          &::before {
            background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);
          }

          .module-icon {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%) !important;
            box-shadow: 0 4px 15px rgba(67, 233, 123, 0.3) !important;
          }

          .nutrition-overview-grid {
            display: grid;
            gap: 2rem;

            .nutrition-category {
              background: linear-gradient(135deg, rgba(67, 233, 123, 0.05) 0%, rgba(56, 249, 215, 0.05) 100%);
              border-radius: 15px;
              padding: 1.5rem;
              border: 1px solid rgba(67, 233, 123, 0.1);

              .category-title {
                font-size: 1.2rem;
                font-weight: 600;
                color: #2c3e50;
                margin-bottom: 1rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
              }

              .nutrition-comparison {
                display: grid;
                grid-template-columns: 1fr auto 1fr auto;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
                background: white;
                border-radius: 12px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);

                .comparison-item {
                  text-align: center;

                  .item-label {
                    display: block;
                    font-size: 0.9rem;
                    color: #7f8c8d;
                    margin-bottom: 0.5rem;
                  }

                  .item-value {
                    display: block;
                    font-size: 1.3rem;
                    font-weight: bold;
                    color: #2c3e50;
                  }

                  .item-unit {
                    font-size: 0.9rem;
                    color: #7f8c8d;
                    margin-left: 0.2rem;
                  }

                  &.needs {
                    color: #43e97b;
                  }

                  &.current {
                    color: #38f9d7;
                  }
                }

                .comparison-arrow {
                  font-size: 1.5rem;
                  color: #43e97b;
                  font-weight: bold;
                }

                .comparison-status {
                  .status-indicator {
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-size: 0.9rem;
                    font-weight: 600;

                    &.low {
                      background: #fff3cd;
                      color: #856404;
                    }

                    &.normal {
                      background: #d4edda;
                      color: #155724;
                    }

                    &.high {
                      background: #f8d7da;
                      color: #721c24;
                    }
                  }
                }
              }

              .macronutrients-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;

                .macro-item {
                  background: white;
                  border-radius: 12px;
                  padding: 1rem;
                  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
                  transition: all 0.3s ease;

                  &:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
                  }

                  .macro-icon {
                    font-size: 2rem;
                    margin-bottom: 0.5rem;
                  }

                  .macro-details {
                    .macro-name {
                      display: block;
                      font-weight: 600;
                      color: #2c3e50;
                      margin-bottom: 0.5rem;
                    }

                    .macro-values {
                      display: flex;
                      align-items: center;
                      gap: 0.5rem;
                      margin-bottom: 0.8rem;

                      .current {
                        font-size: 1.2rem;
                        font-weight: bold;
                        color: #43e97b;
                      }

                      .divider {
                        color: #bdc3c7;
                      }

                      .needed {
                        color: #7f8c8d;
                      }
                    }

                    .macro-progress {
                      .progress-bar {
                        width: 100%;
                        height: 6px;
                        background: #ecf0f1;
                        border-radius: 3px;
                        overflow: hidden;

                        .progress-fill {
                          height: 100%;
                          background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);
                          border-radius: 3px;
                          transition: width 0.5s ease;
                        }
                      }
                    }
                  }
                }
              }

              .vitamins-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 1rem;

                .vitamin-item {
                  background: white;
                  border-radius: 12px;
                  padding: 1rem;
                  text-align: center;
                  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
                  transition: all 0.3s ease;

                  &:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
                  }

                  .vitamin-icon {
                    font-size: 1.5rem;
                    margin-bottom: 0.5rem;
                  }

                  .vitamin-name {
                    display: block;
                    font-size: 0.9rem;
                    color: #7f8c8d;
                    margin-bottom: 0.3rem;
                  }

                  .vitamin-value {
                    font-size: 1.1rem;
                    font-weight: bold;
                    color: #43e97b;
                  }
                }
              }
            }
          }
        }

        // è¥å…»å¹³è¡¡åˆ†ææ¨¡å—æ ·å¼
        &.nutrition-balance-module {
          &::before {
            background: linear-gradient(90deg, #fa709a 0%, #fee140 100%);
          }

          .module-icon {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%) !important;
            box-shadow: 0 4px 15px rgba(250, 112, 154, 0.3) !important;
          }

          .balance-analysis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;

            @media (max-width: 768px) {
              grid-template-columns: 1fr;
            }

            .chart-section {
              background: linear-gradient(135deg, rgba(250, 112, 154, 0.05) 0%, rgba(254, 225, 64, 0.05) 100%);
              border-radius: 15px;
              padding: 2rem;
              border: 1px solid rgba(250, 112, 154, 0.1);
              text-align: center;

              .chart-container {
                width: 100%;
                height: 300px;
                margin-bottom: 1rem;

                .nutrition-chart {
                  max-width: 100%;
                  max-height: 100%;
                }
              }

              .chart-legend {
                display: flex;
                justify-content: center;
                gap: 2rem;

                .legend-item {
                  display: flex;
                  align-items: center;
                  gap: 0.5rem;

                  .legend-color {
                    width: 16px;
                    height: 16px;
                    border-radius: 50%;

                    &.current {
                      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
                    }

                    &.recommended {
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    }
                  }

                  .legend-text {
                    font-size: 0.9rem;
                    color: #7f8c8d;
                  }
                }
              }
            }

            .nutrients-analysis {
              .analysis-title {
                font-size: 1.2rem;
                font-weight: 600;
                color: #2c3e50;
                margin-bottom: 1.5rem;
              }

              .nutrients-list {
                display: flex;
                flex-direction: column;
                gap: 1rem;

                .nutrient-item {
                  display: flex;
                  align-items: center;
                  gap: 1rem;
                  padding: 1rem;
                  border-radius: 12px;
                  transition: all 0.3s ease;

                  &:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                  }

                  .nutrient-status {
                    font-size: 1.5rem;
                    width: 40px;
                    text-align: center;
                  }

                  .nutrient-info {
                    flex: 1;

                    .nutrient-name {
                      display: block;
                      font-weight: 600;
                      color: #2c3e50;
                      margin-bottom: 0.3rem;
                    }

                    .nutrient-desc {
                      font-size: 0.9rem;
                      color: #7f8c8d;
                    }
                  }

                  &.excellent {
                    background: linear-gradient(135deg, rgba(76, 175, 80, 0.08) 0%, rgba(76, 175, 80, 0.12) 100%);
                    border: 1px solid rgba(76, 175, 80, 0.2);
                  }

                  &.good {
                    background: linear-gradient(135deg, rgba(33, 150, 243, 0.08) 0%, rgba(33, 150, 243, 0.12) 100%);
                    border: 1px solid rgba(33, 150, 243, 0.2);
                  }

                  &.attention {
                    background: linear-gradient(135deg, rgba(255, 152, 0, 0.08) 0%, rgba(255, 152, 0, 0.12) 100%);
                    border: 1px solid rgba(255, 152, 0, 0.2);
                  }

                  &.warning {
                    background: linear-gradient(135deg, rgba(244, 67, 54, 0.08) 0%, rgba(244, 67, 54, 0.12) 100%);
                    border: 1px solid rgba(244, 67, 54, 0.2);
                  }
                }
              }
            }
          }
        }

        // AIæ™ºèƒ½åˆ†ææ¨¡å—æ ·å¼
        &.ai-analysis-module {
          &::before {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
          }

          .module-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3) !important;
          }

          .ai-analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;

            .ai-section {
              background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
              border-radius: 15px;
              padding: 1.5rem;
              border: 1px solid rgba(102, 126, 234, 0.1);
              transition: all 0.3s ease;

              &:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
              }

              .section-title {
                font-size: 1.1rem;
                font-weight: 600;
                color: #2c3e50;
                margin-bottom: 1.5rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;

                .title-icon {
                  font-size: 1.3rem;
                }
              }

              // ä¸ªæ€§åŒ–å»ºè®®æ ·å¼
              &.recommendations {
                .recommendations-list {
                  display: flex;
                  flex-direction: column;
                  gap: 1rem;

                  .recommendation-item {
                    display: flex;
                    align-items: flex-start;
                    gap: 1rem;
                    padding: 1rem;
                    background: white;
                    border-radius: 12px;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
                    transition: all 0.3s ease;

                    &:hover {
                      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
                      transform: translateY(-2px);
                    }

                    .item-marker {
                      width: 30px;
                      height: 30px;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      color: white;
                      border-radius: 50%;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      font-weight: bold;
                      font-size: 0.9rem;
                      flex-shrink: 0;
                    }

                    .item-content {
                      flex: 1;
                      font-size: 0.95rem;
                      line-height: 1.5;
                      color: #2c3e50;
                    }
                  }
                }
              }

              // å¥åº·é£é™©è¯„ä¼°æ ·å¼
              &.risks {
                .risks-list {
                  display: flex;
                  flex-direction: column;
                  gap: 1rem;

                  .risk-item {
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                    padding: 1rem;
                    border-radius: 12px;
                    transition: all 0.3s ease;

                    &:hover {
                      transform: translateY(-2px);
                      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                    }

                    .risk-level {
                      font-size: 1.5rem;
                      width: 40px;
                      text-align: center;
                    }

                    .risk-content {
                      flex: 1;

                      .risk-title {
                        display: block;
                        font-weight: 600;
                        color: #2c3e50;
                        margin-bottom: 0.3rem;
                      }

                      .risk-desc {
                        font-size: 0.9rem;
                        color: #7f8c8d;
                      }
                    }

                    &.low {
                      background: linear-gradient(135deg, rgba(76, 175, 80, 0.08) 0%, rgba(76, 175, 80, 0.12) 100%);
                      border: 1px solid rgba(76, 175, 80, 0.2);
                    }

                    &.medium {
                      background: linear-gradient(135deg, rgba(255, 193, 7, 0.08) 0%, rgba(255, 193, 7, 0.12) 100%);
                      border: 1px solid rgba(255, 193, 7, 0.2);
                    }

                    &.high {
                      background: linear-gradient(135deg, rgba(255, 152, 0, 0.08) 0%, rgba(255, 152, 0, 0.12) 100%);
                      border: 1px solid rgba(255, 152, 0, 0.2);
                    }
                  }
                }
              }

              // æ”¹è¿›å»ºè®®æ ·å¼
              &.improvements {
                .improvements-list {
                  display: flex;
                  flex-direction: column;
                  gap: 1rem;

                  .improvement-item {
                    padding: 1rem;
                    background: white;
                    border-radius: 12px;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
                    transition: all 0.3s ease;

                    &:hover {
                      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
                      transform: translateY(-2px);
                    }

                    .improvement-category {
                      display: inline-block;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      color: white;
                      padding: 0.3rem 0.8rem;
                      border-radius: 15px;
                      font-size: 0.8rem;
                      font-weight: 600;
                      margin-bottom: 0.8rem;
                    }

                    .improvement-content {
                      font-size: 0.95rem;
                      line-height: 1.5;
                      color: #2c3e50;
                    }
                  }
                }
              }

              // å¥åº·æ´å¯Ÿæ ·å¼
              &.insights {
                .insights-list {
                  display: flex;
                  flex-direction: column;
                  gap: 1rem;

                  .insight-item {
                    display: flex;
                    align-items: flex-start;
                    gap: 1rem;
                    padding: 1rem;
                    background: white;
                    border-radius: 12px;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
                    transition: all 0.3s ease;

                    &:hover {
                      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
                      transform: translateY(-2px);
                    }

                    .insight-icon {
                      font-size: 1.5rem;
                      color: #667eea;
                    }

                    .insight-content {
                      flex: 1;
                      font-size: 0.95rem;
                      line-height: 1.5;
                      color: #2c3e50;
                    }
                  }
                }
              }
            }
          }
        }

        // å“åº”å¼è®¾è®¡
        @media (max-width: 768px) {
          padding: 1.5rem;

          .module-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;

            .header-left {
              .module-title {
                font-size: 1.3rem;
              }
            }
          }

          &.nutrition-overview-module {
            .nutrition-overview-grid {
              .nutrition-category {
                .nutrition-comparison {
                  grid-template-columns: 1fr;
                  text-align: center;
                  gap: 1rem;

                  .comparison-arrow {
                    transform: rotate(90deg);
                  }
                }

                .macronutrients-grid {
                  grid-template-columns: 1fr;
                }

                .vitamins-grid {
                  grid-template-columns: repeat(2, 1fr);
                }
              }
            }
          }

          &.nutrition-balance-module {
            .balance-analysis-grid {
              grid-template-columns: 1fr;
            }
          }

          &.ai-analysis-module {
            .ai-analysis-grid {
              grid-template-columns: 1fr;
            }
          }
        }
      }
    }
  }
</style>
